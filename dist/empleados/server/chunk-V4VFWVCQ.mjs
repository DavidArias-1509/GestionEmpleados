import './polyfills.server.mjs';
import{$ as xe,A as he,B as U_,C as Kn,D as Wt,Da as eS,E as Qn,Ea as tS,F as pp,G as z_,Ga as nS,H as j_,Ha as io,I as mp,Ia as Tp,J as gp,K as el,L as ro,M as G_,N as Ft,O as We,P as yp,Q as $r,R as Kr,S as tl,T as Qr,U as vp,V as fe,W as ge,X as $t,Y as H_,Z as An,_ as wp,a as to,aa as Tr,b as eu,ba as nl,c as tu,ca as W_,d as P_,da as bp,e as ns,ea as _p,f as no,fa as Sp,g as Wn,ga as $_,h as Wr,i as Dt,ia as K_,j as F_,k as L_,l as Xa,m as B_,n as V_,na as Cp,o as nu,p as ru,pa as Ep,q as hp,r as iu,ra as Q_,s as rs,sa as ou,t as fp,ta as Y_,u as q_,ua as au,v as su,va as J_,w as Za,wa as X_,x as $n,y as Ht,z as Xe,za as Z_}from"./chunk-ZI24QC2E.mjs";import{a as rS,b as Ap,c as iS,d as rl,e as Ip,f as lu,g as sS,h as oS,i as Dp,j as $e,k as is,l as Yn,m as cu,n as il,o as aS,p as lS,q as Yr,r as Kt}from"./chunk-YRCVLWG5.mjs";import{a as gt,b as Gt,c as Ie,f as F,h as Zc,i as dp,j as I}from"./chunk-DUUSM3KX.mjs";var Rp=F((Jn,kp)=>{"use strict";(function(n,e){typeof Jn=="object"&&typeof kp<"u"?kp.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis<"u"?globalThis:n||self,n.Sweetalert2=e())})(Jn,function(){"use strict";function n(f,c){(c==null||c>f.length)&&(c=f.length);for(var u=0,h=Array(c);u<c;u++)h[u]=f[u];return h}function e(f){if(Array.isArray(f))return f}function t(f){if(Array.isArray(f))return n(f)}function r(f,c,u){if(typeof f=="function"?f===c:f.has(c))return arguments.length<3?c:u;throw new TypeError("Private element is not present on this object")}function i(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function s(f,c,u){return c=k(c),T(f,P()?Reflect.construct(c,u||[],k(f).constructor):c.apply(f,u))}function o(f,c){if(c.has(f))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(f,c){if(!(f instanceof c))throw new TypeError("Cannot call a class as a function")}function l(f,c){return f.get(r(f,c))}function d(f,c,u){o(f,c),c.set(f,u)}function p(f,c,u){return f.set(r(f,c),u),u}function m(f,c,u){if(P())return Reflect.construct.apply(null,arguments);var h=[null];h.push.apply(h,c);var b=new(f.bind.apply(f,h));return b}function y(f,c){for(var u=0;u<c.length;u++){var h=c[u];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(f,g(h.key),h)}}function C(f,c,u){return c&&y(f.prototype,c),Object.defineProperty(f,"prototype",{writable:!1}),f}function x(f,c){var u=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(!u){if(Array.isArray(f)||(u=H(f))||c){u&&(f=u);var h=0,b=function(){};return{s:b,n:function(){return h>=f.length?{done:!0}:{done:!1,value:f[h++]}},e:function(ae){throw ae},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var N,K=!0,ue=!1;return{s:function(){u=u.call(f)},n:function(){var ae=u.next();return K=ae.done,ae},e:function(ae){ue=!0,N=ae},f:function(){try{K||u.return==null||u.return()}finally{if(ue)throw N}}}}function O(){return O=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(f,c,u){var h=E(f,c);if(h){var b=Object.getOwnPropertyDescriptor(h,c);return b.get?b.get.call(arguments.length<3?f:u):b.value}},O.apply(null,arguments)}function k(f){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},k(f)}function q(f,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(c&&c.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),c&&_(f,c)}function P(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(P=function(){return!!f})()}function U(f){if(typeof Symbol<"u"&&f[Symbol.iterator]!=null||f["@@iterator"]!=null)return Array.from(f)}function j(f,c){var u=f==null?null:typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(u!=null){var h,b,N,K,ue=[],ae=!0,Je=!1;try{if(N=(u=u.call(f)).next,c!==0)for(;!(ae=(h=N.call(u)).done)&&(ue.push(h.value),ue.length!==c);ae=!0);}catch(Ja){Je=!0,b=Ja}finally{try{if(!ae&&u.return!=null&&(K=u.return(),Object(K)!==K))return}finally{if(Je)throw b}}return ue}}function Y(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(f,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i(f)}function _(f,c){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,h){return u.__proto__=h,u},_(f,c)}function S(f,c){return e(f)||j(f,c)||H(f,c)||Y()}function E(f,c){for(;!{}.hasOwnProperty.call(f,c)&&(f=k(f))!==null;);return f}function w(f){return t(f)||U(f)||H(f)||ie()}function A(f,c){if(typeof f!="object"||!f)return f;var u=f[Symbol.toPrimitive];if(u!==void 0){var h=u.call(f,c);if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}function g(f){var c=A(f,"string");return typeof c=="symbol"?c:c+""}function v(f){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},v(f)}function H(f,c){if(f){if(typeof f=="string")return n(f,c);var u={}.toString.call(f).slice(8,-1);return u==="Object"&&f.constructor&&(u=f.constructor.name),u==="Map"||u==="Set"?Array.from(f):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?n(f,c):void 0}}var me=100,Z={},Ee=function(){Z.previousActiveElement instanceof HTMLElement?(Z.previousActiveElement.focus(),Z.previousActiveElement=null):document.body&&document.body.focus()},je=function(c){return new Promise(function(u){if(!c)return u();var h=window.scrollX,b=window.scrollY;Z.restoreFocusTimeout=setTimeout(function(){Ee(),u()},me),window.scrollTo(h,b)})},Ae="swal2-",It=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"],D=It.reduce(function(f,c){return f[c]=Ae+c,f},{}),Ve=["success","warning","info","question","error"],Ye=Ve.reduce(function(f,c){return f[c]=Ae+c,f},{}),Ge="SweetAlert2:",pt=function(c){return c.charAt(0).toUpperCase()+c.slice(1)},nt=function(c){console.warn("".concat(Ge," ").concat(v(c)==="object"?c.join(" "):c))},qe=function(c){console.error("".concat(Ge," ").concat(c))},B=[],V=function(c){B.includes(c)||(B.push(c),nt(c))},G=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;V('"'.concat(c,'" is deprecated and will be removed in the next major release.').concat(u?' Use "'.concat(u,'" instead.'):""))},ee=function(c){return typeof c=="function"?c():c},X=function(c){return c&&typeof c.toPromise=="function"},se=function(c){return X(c)?c.toPromise():Promise.resolve(c)},Re=function(c){return c&&Promise.resolve(c)===c},He=function(){return document.body.querySelector(".".concat(D.container))},mt=function(c){var u=He();return u?u.querySelector(c):null},wt=function(c){return mt(".".concat(c))},Te=function(){return wt(D.popup)},Cr=function(){return wt(D.icon)},ax=function(){return wt(D["icon-content"])},B0=function(){return wt(D.title)},Yf=function(){return wt(D["html-container"])},V0=function(){return wt(D.image)},Jf=function(){return wt(D["progress-steps"])},jc=function(){return wt(D["validation-message"])},jn=function(){return mt(".".concat(D.actions," .").concat(D.confirm))},Ks=function(){return mt(".".concat(D.actions," .").concat(D.cancel))},Ji=function(){return mt(".".concat(D.actions," .").concat(D.deny))},lx=function(){return wt(D["input-label"])},Qs=function(){return mt(".".concat(D.loader))},$a=function(){return wt(D.actions)},q0=function(){return wt(D.footer)},Gc=function(){return wt(D["timer-progress-bar"])},Xf=function(){return wt(D.close)},cx=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Zf=function(){var c=Te();if(!c)return[];var u=c.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),h=Array.from(u).sort(function(K,ue){var ae=parseInt(K.getAttribute("tabindex")||"0"),Je=parseInt(ue.getAttribute("tabindex")||"0");return ae>Je?1:ae<Je?-1:0}),b=c.querySelectorAll(cx),N=Array.from(b).filter(function(K){return K.getAttribute("tabindex")!=="-1"});return w(new Set(h.concat(N))).filter(function(K){return jt(K)})},ep=function(){return Er(document.body,D.shown)&&!Er(document.body,D["toast-shown"])&&!Er(document.body,D["no-backdrop"])},Hc=function(){var c=Te();return c?Er(c,D.toast):!1},ux=function(){var c=Te();return c?c.hasAttribute("data-loading"):!1},tn=function(c,u){if(c.textContent="",u){var h=new DOMParser,b=h.parseFromString(u,"text/html"),N=b.querySelector("head");N&&Array.from(N.childNodes).forEach(function(ue){c.appendChild(ue)});var K=b.querySelector("body");K&&Array.from(K.childNodes).forEach(function(ue){ue instanceof HTMLVideoElement||ue instanceof HTMLAudioElement?c.appendChild(ue.cloneNode(!0)):c.appendChild(ue)})}},Er=function(c,u){if(!u)return!1;for(var h=u.split(/\s+/),b=0;b<h.length;b++)if(!c.classList.contains(h[b]))return!1;return!0},dx=function(c,u){Array.from(c.classList).forEach(function(h){!Object.values(D).includes(h)&&!Object.values(Ye).includes(h)&&!Object.values(u.showClass||{}).includes(h)&&c.classList.remove(h)})},un=function(c,u,h){if(dx(c,u),!!u.customClass){var b=u.customClass[h];if(b){if(typeof b!="string"&&!b.forEach){nt("Invalid type of customClass.".concat(h,'! Expected string or iterable object, got "').concat(v(b),'"'));return}be(c,b)}}},Wc=function(c,u){if(!u)return null;switch(u){case"select":case"textarea":case"file":return c.querySelector(".".concat(D.popup," > .").concat(D[u]));case"checkbox":return c.querySelector(".".concat(D.popup," > .").concat(D.checkbox," input"));case"radio":return c.querySelector(".".concat(D.popup," > .").concat(D.radio," input:checked"))||c.querySelector(".".concat(D.popup," > .").concat(D.radio," input:first-child"));case"range":return c.querySelector(".".concat(D.popup," > .").concat(D.range," input"));default:return c.querySelector(".".concat(D.popup," > .").concat(D.input))}},U0=function(c){if(c.focus(),c.type!=="file"){var u=c.value;c.value="",c.value=u}},z0=function(c,u,h){!c||!u||(typeof u=="string"&&(u=u.split(/\s+/).filter(Boolean)),u.forEach(function(b){Array.isArray(c)?c.forEach(function(N){h?N.classList.add(b):N.classList.remove(b)}):h?c.classList.add(b):c.classList.remove(b)}))},be=function(c,u){z0(c,u,!0)},Gn=function(c,u){z0(c,u,!1)},Gr=function(c,u){for(var h=Array.from(c.children),b=0;b<h.length;b++){var N=h[b];if(N instanceof HTMLElement&&Er(N,u))return N}},Xi=function(c,u,h){h==="".concat(parseInt(h))&&(h=parseInt(h)),h||parseInt(h)===0?c.style.setProperty(u,typeof h=="number"?"".concat(h,"px"):h):c.style.removeProperty(u)},bt=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";c&&(c.style.display=u)},Rt=function(c){c&&(c.style.display="none")},tp=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"block";c&&new MutationObserver(function(){Ka(c,c.innerHTML,u)}).observe(c,{childList:!0,subtree:!0})},j0=function(c,u,h,b){var N=c.querySelector(u);N&&N.style.setProperty(h,b)},Ka=function(c,u){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";u?bt(c,h):Rt(c)},jt=function(c){return!!(c&&(c.offsetWidth||c.offsetHeight||c.getClientRects().length))},hx=function(){return!jt(jn())&&!jt(Ji())&&!jt(Ks())},G0=function(c){return c.scrollHeight>c.clientHeight},H0=function(c){var u=window.getComputedStyle(c),h=parseFloat(u.getPropertyValue("animation-duration")||"0"),b=parseFloat(u.getPropertyValue("transition-duration")||"0");return h>0||b>0},np=function(c){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,h=Gc();h&&jt(h)&&(u&&(h.style.transition="none",h.style.width="100%"),setTimeout(function(){h.style.transition="width ".concat(c/1e3,"s linear"),h.style.width="0%"},10))},fx=function(){var c=Gc();if(c){var u=parseInt(window.getComputedStyle(c).width);c.style.removeProperty("transition"),c.style.width="100%";var h=parseInt(window.getComputedStyle(c).width),b=u/h*100;c.style.width="".concat(b,"%")}},W0=function(){return typeof window>"u"||typeof document>"u"},px=`
 <div aria-labelledby="`.concat(D.title,'" aria-describedby="').concat(D["html-container"],'" class="').concat(D.popup,`" tabindex="-1">
   <button type="button" class="`).concat(D.close,`"></button>
   <ul class="`).concat(D["progress-steps"],`"></ul>
   <div class="`).concat(D.icon,`"></div>
   <img class="`).concat(D.image,`" />
   <h2 class="`).concat(D.title,'" id="').concat(D.title,`"></h2>
   <div class="`).concat(D["html-container"],'" id="').concat(D["html-container"],`"></div>
   <input class="`).concat(D.input,'" id="').concat(D.input,`" />
   <input type="file" class="`).concat(D.file,`" />
   <div class="`).concat(D.range,`">
     <input type="range" />
     <output></output>
   </div>
   <select class="`).concat(D.select,'" id="').concat(D.select,`"></select>
   <div class="`).concat(D.radio,`"></div>
   <label class="`).concat(D.checkbox,`">
     <input type="checkbox" id="`).concat(D.checkbox,`" />
     <span class="`).concat(D.label,`"></span>
   </label>
   <textarea class="`).concat(D.textarea,'" id="').concat(D.textarea,`"></textarea>
   <div class="`).concat(D["validation-message"],'" id="').concat(D["validation-message"],`"></div>
   <div class="`).concat(D.actions,`">
     <div class="`).concat(D.loader,`"></div>
     <button type="button" class="`).concat(D.confirm,`"></button>
     <button type="button" class="`).concat(D.deny,`"></button>
     <button type="button" class="`).concat(D.cancel,`"></button>
   </div>
   <div class="`).concat(D.footer,`"></div>
   <div class="`).concat(D["timer-progress-bar-container"],`">
     <div class="`).concat(D["timer-progress-bar"],`"></div>
   </div>
 </div>
`).replace(/(^|\n)\s*/g,""),mx=function(){var c=He();return c?(c.remove(),Gn([document.documentElement,document.body],[D["no-backdrop"],D["toast-shown"],D["has-column"]]),!0):!1},Zi=function(){Z.currentInstance.resetValidationMessage()},gx=function(){var c=Te(),u=Gr(c,D.input),h=Gr(c,D.file),b=c.querySelector(".".concat(D.range," input")),N=c.querySelector(".".concat(D.range," output")),K=Gr(c,D.select),ue=c.querySelector(".".concat(D.checkbox," input")),ae=Gr(c,D.textarea);u.oninput=Zi,h.onchange=Zi,K.onchange=Zi,ue.onchange=Zi,ae.oninput=Zi,b.oninput=function(){Zi(),N.value=b.value},b.onchange=function(){Zi(),N.value=b.value}},yx=function(c){return typeof c=="string"?document.querySelector(c):c},vx=function(c){var u=Te();u.setAttribute("role",c.toast?"alert":"dialog"),u.setAttribute("aria-live",c.toast?"polite":"assertive"),c.toast||u.setAttribute("aria-modal","true")},wx=function(c){window.getComputedStyle(c).direction==="rtl"&&be(He(),D.rtl)},bx=function(c){var u=mx();if(W0()){qe("SweetAlert2 requires document to initialize");return}var h=document.createElement("div");h.className=D.container,u&&be(h,D["no-transition"]),tn(h,px);var b=yx(c.target);b.appendChild(h),vx(c),wx(b),gx()},rp=function(c,u){c instanceof HTMLElement?u.appendChild(c):v(c)==="object"?_x(c,u):c&&tn(u,c)},_x=function(c,u){c.jquery?Sx(u,c):tn(u,c.toString())},Sx=function(c,u){if(c.textContent="",0 in u)for(var h=0;h in u;h++)c.appendChild(u[h].cloneNode(!0));else c.appendChild(u.cloneNode(!0))},es=function(){if(W0())return!1;var f=document.createElement("div");return typeof f.style.webkitAnimation<"u"?"webkitAnimationEnd":typeof f.style.animation<"u"?"animationend":!1}(),Cx=function(c,u){var h=$a(),b=Qs();!h||!b||(!u.showConfirmButton&&!u.showDenyButton&&!u.showCancelButton?Rt(h):bt(h),un(h,u,"actions"),Ex(h,b,u),tn(b,u.loaderHtml||""),un(b,u,"loader"))};function Ex(f,c,u){var h=jn(),b=Ji(),N=Ks();!h||!b||!N||(ip(h,"confirm",u),ip(b,"deny",u),ip(N,"cancel",u),Tx(h,b,N,u),u.reverseButtons&&(u.toast?(f.insertBefore(N,h),f.insertBefore(b,h)):(f.insertBefore(N,c),f.insertBefore(b,c),f.insertBefore(h,c))))}function Tx(f,c,u,h){if(!h.buttonsStyling){Gn([f,c,u],D.styled);return}be([f,c,u],D.styled),h.confirmButtonColor&&(f.style.backgroundColor=h.confirmButtonColor,be(f,D["default-outline"])),h.denyButtonColor&&(c.style.backgroundColor=h.denyButtonColor,be(c,D["default-outline"])),h.cancelButtonColor&&(u.style.backgroundColor=h.cancelButtonColor,be(u,D["default-outline"]))}function ip(f,c,u){var h=pt(c);Ka(f,u["show".concat(h,"Button")],"inline-block"),tn(f,u["".concat(c,"ButtonText")]||""),f.setAttribute("aria-label",u["".concat(c,"ButtonAriaLabel")]||""),f.className=D[c],un(f,u,"".concat(c,"Button"))}var Ax=function(c,u){var h=Xf();h&&(tn(h,u.closeButtonHtml||""),un(h,u,"closeButton"),Ka(h,u.showCloseButton),h.setAttribute("aria-label",u.closeButtonAriaLabel||""))},Ix=function(c,u){var h=He();h&&(Dx(h,u.backdrop),kx(h,u.position),Rx(h,u.grow),un(h,u,"container"))};function Dx(f,c){typeof c=="string"?f.style.background=c:c||be([document.documentElement,document.body],D["no-backdrop"])}function kx(f,c){c&&(c in D?be(f,D[c]):(nt('The "position" parameter is not valid, defaulting to "center"'),be(f,D.center)))}function Rx(f,c){c&&be(f,D["grow-".concat(c)])}var Me={innerParams:new WeakMap,domCache:new WeakMap},xx=["input","file","range","select","radio","checkbox","textarea"],Ox=function(c,u){var h=Te();if(h){var b=Me.innerParams.get(c),N=!b||u.input!==b.input;xx.forEach(function(K){var ue=Gr(h,D[K]);ue&&(Px(K,u.inputAttributes),ue.className=D[K],N&&Rt(ue))}),u.input&&(N&&Mx(u),Fx(u))}},Mx=function(c){if(c.input){if(!rt[c.input]){qe("Unexpected type of input! Expected ".concat(Object.keys(rt).join(" | "),', got "').concat(c.input,'"'));return}var u=$0(c.input),h=rt[c.input](u,c);bt(u),c.inputAutoFocus&&setTimeout(function(){U0(h)})}},Nx=function(c){for(var u=0;u<c.attributes.length;u++){var h=c.attributes[u].name;["id","type","value","style"].includes(h)||c.removeAttribute(h)}},Px=function(c,u){var h=Wc(Te(),c);if(h){Nx(h);for(var b in u)h.setAttribute(b,u[b])}},Fx=function(c){var u=$0(c.input);v(c.customClass)==="object"&&be(u,c.customClass.input)},sp=function(c,u){(!c.placeholder||u.inputPlaceholder)&&(c.placeholder=u.inputPlaceholder)},Qa=function(c,u,h){if(h.inputLabel){var b=document.createElement("label"),N=D["input-label"];b.setAttribute("for",c.id),b.className=N,v(h.customClass)==="object"&&be(b,h.customClass.inputLabel),b.innerText=h.inputLabel,u.insertAdjacentElement("beforebegin",b)}},$0=function(c){return Gr(Te(),D[c]||D.input)},$c=function(c,u){["string","number"].includes(v(u))?c.value="".concat(u):Re(u)||nt('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(v(u),'"'))},rt={};rt.text=rt.email=rt.password=rt.number=rt.tel=rt.url=rt.search=rt.date=rt["datetime-local"]=rt.time=rt.week=rt.month=function(f,c){return $c(f,c.inputValue),Qa(f,f,c),sp(f,c),f.type=c.input,f},rt.file=function(f,c){return Qa(f,f,c),sp(f,c),f},rt.range=function(f,c){var u=f.querySelector("input"),h=f.querySelector("output");return $c(u,c.inputValue),u.type=c.input,$c(h,c.inputValue),Qa(u,f,c),f},rt.select=function(f,c){if(f.textContent="",c.inputPlaceholder){var u=document.createElement("option");tn(u,c.inputPlaceholder),u.value="",u.disabled=!0,u.selected=!0,f.appendChild(u)}return Qa(f,f,c),f},rt.radio=function(f){return f.textContent="",f},rt.checkbox=function(f,c){var u=Wc(Te(),"checkbox");u.value="1",u.checked=!!c.inputValue;var h=f.querySelector("span");return tn(h,c.inputPlaceholder),u},rt.textarea=function(f,c){$c(f,c.inputValue),sp(f,c),Qa(f,f,c);var u=function(b){return parseInt(window.getComputedStyle(b).marginLeft)+parseInt(window.getComputedStyle(b).marginRight)};return setTimeout(function(){if("MutationObserver"in window){var h=parseInt(window.getComputedStyle(Te()).width),b=function(){if(document.body.contains(f)){var K=f.offsetWidth+u(f);K>h?Te().style.width="".concat(K,"px"):Xi(Te(),"width",c.width)}};new MutationObserver(b).observe(f,{attributes:!0,attributeFilter:["style"]})}}),f};var Lx=function(c,u){var h=Yf();h&&(tp(h),un(h,u,"htmlContainer"),u.html?(rp(u.html,h),bt(h,"block")):u.text?(h.textContent=u.text,bt(h,"block")):Rt(h),Ox(c,u))},Bx=function(c,u){var h=q0();h&&(tp(h),Ka(h,u.footer,"block"),u.footer&&rp(u.footer,h),un(h,u,"footer"))},Vx=function(c,u){var h=Me.innerParams.get(c),b=Cr();if(b){if(h&&u.icon===h.icon){Q0(b,u),K0(b,u);return}if(!u.icon&&!u.iconHtml){Rt(b);return}if(u.icon&&Object.keys(Ye).indexOf(u.icon)===-1){qe('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(u.icon,'"')),Rt(b);return}bt(b),Q0(b,u),K0(b,u),be(b,u.showClass&&u.showClass.icon)}},K0=function(c,u){for(var h=0,b=Object.entries(Ye);h<b.length;h++){var N=S(b[h],2),K=N[0],ue=N[1];u.icon!==K&&Gn(c,ue)}be(c,u.icon&&Ye[u.icon]),jx(c,u),qx(),un(c,u,"icon")},qx=function(){var c=Te();if(c)for(var u=window.getComputedStyle(c).getPropertyValue("background-color"),h=c.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix"),b=0;b<h.length;b++)h[b].style.backgroundColor=u},Ux=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,zx=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,Q0=function(c,u){if(!(!u.icon&&!u.iconHtml)){var h=c.innerHTML,b="";if(u.iconHtml)b=Y0(u.iconHtml);else if(u.icon==="success")b=Ux,h=h.replace(/ style=".*?"/g,"");else if(u.icon==="error")b=zx;else if(u.icon){var N={question:"?",warning:"!",info:"i"};b=Y0(N[u.icon])}h.trim()!==b.trim()&&tn(c,b)}},jx=function(c,u){if(u.iconColor){c.style.color=u.iconColor,c.style.borderColor=u.iconColor;for(var h=0,b=[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"];h<b.length;h++){var N=b[h];j0(c,N,"background-color",u.iconColor)}j0(c,".swal2-success-ring","border-color",u.iconColor)}},Y0=function(c){return'<div class="'.concat(D["icon-content"],'">').concat(c,"</div>")},Gx=function(c,u){var h=V0();if(h){if(!u.imageUrl){Rt(h);return}bt(h,""),h.setAttribute("src",u.imageUrl),h.setAttribute("alt",u.imageAlt||""),Xi(h,"width",u.imageWidth),Xi(h,"height",u.imageHeight),h.className=D.image,un(h,u,"image")}},Hx=function(c,u){var h=He(),b=Te();if(!(!h||!b)){if(u.toast){Xi(h,"width",u.width),b.style.width="100%";var N=Qs();N&&b.insertBefore(N,Cr())}else Xi(b,"width",u.width);Xi(b,"padding",u.padding),u.color&&(b.style.color=u.color),u.background&&(b.style.background=u.background),Rt(jc()),Wx(b,u)}},Wx=function(c,u){var h=u.showClass||{};c.className="".concat(D.popup," ").concat(jt(c)?h.popup:""),u.toast?(be([document.documentElement,document.body],D["toast-shown"]),be(c,D.toast)):be(c,D.modal),un(c,u,"popup"),typeof u.customClass=="string"&&be(c,u.customClass),u.icon&&be(c,D["icon-".concat(u.icon)])},$x=function(c,u){var h=Jf();if(h){var b=u.progressSteps,N=u.currentProgressStep;if(!b||b.length===0||N===void 0){Rt(h);return}bt(h),h.textContent="",N>=b.length&&nt("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),b.forEach(function(K,ue){var ae=Kx(K);if(h.appendChild(ae),ue===N&&be(ae,D["active-progress-step"]),ue!==b.length-1){var Je=Qx(u);h.appendChild(Je)}})}},Kx=function(c){var u=document.createElement("li");return be(u,D["progress-step"]),tn(u,c),u},Qx=function(c){var u=document.createElement("li");return be(u,D["progress-step-line"]),c.progressStepsDistance&&Xi(u,"width",c.progressStepsDistance),u},Yx=function(c,u){var h=B0();h&&(tp(h),Ka(h,u.title||u.titleText,"block"),u.title&&rp(u.title,h),u.titleText&&(h.innerText=u.titleText),un(h,u,"title"))},J0=function(c,u){Hx(c,u),Ix(c,u),$x(c,u),Vx(c,u),Gx(c,u),Yx(c,u),Ax(c,u),Lx(c,u),Cx(c,u),Bx(c,u);var h=Te();typeof u.didRender=="function"&&h&&u.didRender(h)},Jx=function(){return jt(Te())},X0=function(){var c;return(c=jn())===null||c===void 0?void 0:c.click()},Xx=function(){var c;return(c=Ji())===null||c===void 0?void 0:c.click()},Zx=function(){var c;return(c=Ks())===null||c===void 0?void 0:c.click()},Ys=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Z0=function(c){c.keydownTarget&&c.keydownHandlerAdded&&(c.keydownTarget.removeEventListener("keydown",c.keydownHandler,{capture:c.keydownListenerCapture}),c.keydownHandlerAdded=!1)},eO=function(c,u,h){Z0(c),u.toast||(c.keydownHandler=function(b){return nO(u,b,h)},c.keydownTarget=u.keydownListenerCapture?window:Te(),c.keydownListenerCapture=u.keydownListenerCapture,c.keydownTarget.addEventListener("keydown",c.keydownHandler,{capture:c.keydownListenerCapture}),c.keydownHandlerAdded=!0)},op=function(c,u){var h,b=Zf();if(b.length){c=c+u,c===b.length?c=0:c===-1&&(c=b.length-1),b[c].focus();return}(h=Te())===null||h===void 0||h.focus()},e_=["ArrowRight","ArrowDown"],tO=["ArrowLeft","ArrowUp"],nO=function(c,u,h){c&&(u.isComposing||u.keyCode===229||(c.stopKeydownPropagation&&u.stopPropagation(),u.key==="Enter"?rO(u,c):u.key==="Tab"?iO(u):[].concat(e_,tO).includes(u.key)?sO(u.key):u.key==="Escape"&&oO(u,c,h)))},rO=function(c,u){if(ee(u.allowEnterKey)){var h=Wc(Te(),u.input);if(c.target&&h&&c.target instanceof HTMLElement&&c.target.outerHTML===h.outerHTML){if(["textarea","file"].includes(u.input))return;X0(),c.preventDefault()}}},iO=function(c){for(var u=c.target,h=Zf(),b=-1,N=0;N<h.length;N++)if(u===h[N]){b=N;break}c.shiftKey?op(b,-1):op(b,1),c.stopPropagation(),c.preventDefault()},sO=function(c){var u=$a(),h=jn(),b=Ji(),N=Ks();if(!(!u||!h||!b||!N)){var K=[h,b,N];if(!(document.activeElement instanceof HTMLElement&&!K.includes(document.activeElement))){var ue=e_.includes(c)?"nextElementSibling":"previousElementSibling",ae=document.activeElement;if(ae){for(var Je=0;Je<u.children.length;Je++){if(ae=ae[ue],!ae)return;if(ae instanceof HTMLButtonElement&&jt(ae))break}ae instanceof HTMLButtonElement&&ae.focus()}}}},oO=function(c,u,h){ee(u.allowEscapeKey)&&(c.preventDefault(),h(Ys.esc))},Js={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap},aO=function(){var c=He(),u=Array.from(document.body.children);u.forEach(function(h){h.contains(c)||(h.hasAttribute("aria-hidden")&&h.setAttribute("data-previous-aria-hidden",h.getAttribute("aria-hidden")||""),h.setAttribute("aria-hidden","true"))})},t_=function(){var c=Array.from(document.body.children);c.forEach(function(u){u.hasAttribute("data-previous-aria-hidden")?(u.setAttribute("aria-hidden",u.getAttribute("data-previous-aria-hidden")||""),u.removeAttribute("data-previous-aria-hidden")):u.removeAttribute("aria-hidden")})},n_=typeof window<"u"&&!!window.GestureEvent,lO=function(){if(n_&&!Er(document.body,D.iosfix)){var c=document.body.scrollTop;document.body.style.top="".concat(c*-1,"px"),be(document.body,D.iosfix),cO()}},cO=function(){var c=He();if(c){var u;c.ontouchstart=function(h){u=uO(h)},c.ontouchmove=function(h){u&&(h.preventDefault(),h.stopPropagation())}}},uO=function(c){var u=c.target,h=He(),b=Yf();return!h||!b||dO(c)||hO(c)?!1:u===h||!G0(h)&&u instanceof HTMLElement&&u.tagName!=="INPUT"&&u.tagName!=="TEXTAREA"&&!(G0(b)&&b.contains(u))},dO=function(c){return c.touches&&c.touches.length&&c.touches[0].touchType==="stylus"},hO=function(c){return c.touches&&c.touches.length>1},fO=function(){if(Er(document.body,D.iosfix)){var c=parseInt(document.body.style.top,10);Gn(document.body,D.iosfix),document.body.style.top="",document.body.scrollTop=c*-1}},pO=function(){var c=document.createElement("div");c.className=D["scrollbar-measure"],document.body.appendChild(c);var u=c.getBoundingClientRect().width-c.clientWidth;return document.body.removeChild(c),u},Xs=null,mO=function(c){Xs===null&&(document.body.scrollHeight>window.innerHeight||c==="scroll")&&(Xs=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(Xs+pO(),"px"))},gO=function(){Xs!==null&&(document.body.style.paddingRight="".concat(Xs,"px"),Xs=null)};function r_(f,c,u,h){Hc()?s_(f,h):(je(u).then(function(){return s_(f,h)}),Z0(Z)),n_?(c.setAttribute("style","display:none !important"),c.removeAttribute("class"),c.innerHTML=""):c.remove(),ep()&&(gO(),fO(),t_()),yO()}function yO(){Gn([document.documentElement,document.body],[D.shown,D["height-auto"],D["no-backdrop"],D["toast-shown"]])}function Hr(f){f=wO(f);var c=Js.swalPromiseResolve.get(this),u=vO(this);this.isAwaitingPromise?f.isDismissed||(Ya(this),c(f)):u&&c(f)}var vO=function(c){var u=Te();if(!u)return!1;var h=Me.innerParams.get(c);if(!h||Er(u,h.hideClass.popup))return!1;Gn(u,h.showClass.popup),be(u,h.hideClass.popup);var b=He();return Gn(b,h.showClass.backdrop),be(b,h.hideClass.backdrop),bO(c,u,h),!0};function i_(f){var c=Js.swalPromiseReject.get(this);Ya(this),c&&c(f)}var Ya=function(c){c.isAwaitingPromise&&(delete c.isAwaitingPromise,Me.innerParams.get(c)||c._destroy())},wO=function(c){return typeof c>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},c)},bO=function(c,u,h){var b=He(),N=es&&H0(u);typeof h.willClose=="function"&&h.willClose(u),N?_O(c,u,b,h.returnFocus,h.didClose):r_(c,b,h.returnFocus,h.didClose)},_O=function(c,u,h,b,N){es&&(Z.swalCloseEventFinishedCallback=r_.bind(null,c,h,b,N),u.addEventListener(es,function(K){K.target===u&&(Z.swalCloseEventFinishedCallback(),delete Z.swalCloseEventFinishedCallback)}))},s_=function(c,u){setTimeout(function(){typeof u=="function"&&u.bind(c.params)(),c._destroy&&c._destroy()})},Zs=function(c){var u=Te();if(u||new Xc,u=Te(),!!u){var h=Qs();Hc()?Rt(Cr()):SO(u,c),bt(h),u.setAttribute("data-loading","true"),u.setAttribute("aria-busy","true"),u.focus()}},SO=function(c,u){var h=$a(),b=Qs();!h||!b||(!u&&jt(jn())&&(u=jn()),bt(h),u&&(Rt(u),b.setAttribute("data-button-to-replace",u.className),h.insertBefore(b,u)),be([c,h],D.loading))},CO=function(c,u){u.input==="select"||u.input==="radio"?DO(c,u):["text","email","number","tel","textarea"].some(function(h){return h===u.input})&&(X(u.inputValue)||Re(u.inputValue))&&(Zs(jn()),kO(c,u))},EO=function(c,u){var h=c.getInput();if(!h)return null;switch(u.input){case"checkbox":return TO(h);case"radio":return AO(h);case"file":return IO(h);default:return u.inputAutoTrim?h.value.trim():h.value}},TO=function(c){return c.checked?1:0},AO=function(c){return c.checked?c.value:null},IO=function(c){return c.files&&c.files.length?c.getAttribute("multiple")!==null?c.files:c.files[0]:null},DO=function(c,u){var h=Te();if(h){var b=function(K){u.input==="select"?RO(h,o_(K),u):u.input==="radio"&&xO(h,o_(K),u)};X(u.inputOptions)||Re(u.inputOptions)?(Zs(jn()),se(u.inputOptions).then(function(N){c.hideLoading(),b(N)})):v(u.inputOptions)==="object"?b(u.inputOptions):qe("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(v(u.inputOptions)))}},kO=function(c,u){var h=c.getInput();h&&(Rt(h),se(u.inputValue).then(function(b){h.value=u.input==="number"?"".concat(parseFloat(b)||0):"".concat(b),bt(h),h.focus(),c.hideLoading()}).catch(function(b){qe("Error in inputValue promise: ".concat(b)),h.value="",bt(h),h.focus(),c.hideLoading()}))};function RO(f,c,u){var h=Gr(f,D.select);if(h){var b=function(K,ue,ae){var Je=document.createElement("option");Je.value=ae,tn(Je,ue),Je.selected=a_(ae,u.inputValue),K.appendChild(Je)};c.forEach(function(N){var K=N[0],ue=N[1];if(Array.isArray(ue)){var ae=document.createElement("optgroup");ae.label=K,ae.disabled=!1,h.appendChild(ae),ue.forEach(function(Je){return b(ae,Je[1],Je[0])})}else b(h,ue,K)}),h.focus()}}function xO(f,c,u){var h=Gr(f,D.radio);if(h){c.forEach(function(N){var K=N[0],ue=N[1],ae=document.createElement("input"),Je=document.createElement("label");ae.type="radio",ae.name=D.radio,ae.value=K,a_(K,u.inputValue)&&(ae.checked=!0);var Ja=document.createElement("span");tn(Ja,ue),Ja.className=D.label,Je.appendChild(ae),Je.appendChild(Ja),h.appendChild(Je)});var b=h.querySelectorAll("input");b.length&&b[0].focus()}}var o_=function f(c){var u=[];return c instanceof Map?c.forEach(function(h,b){var N=h;v(N)==="object"&&(N=f(N)),u.push([b,N])}):Object.keys(c).forEach(function(h){var b=c[h];v(b)==="object"&&(b=f(b)),u.push([h,b])}),u},a_=function(c,u){return!!u&&u.toString()===c.toString()},Kc=void 0,OO=function(c){var u=Me.innerParams.get(c);c.disableButtons(),u.input?l_(c,"confirm"):lp(c,!0)},MO=function(c){var u=Me.innerParams.get(c);c.disableButtons(),u.returnInputValueOnDeny?l_(c,"deny"):ap(c,!1)},NO=function(c,u){c.disableButtons(),u(Ys.cancel)},l_=function(c,u){var h=Me.innerParams.get(c);if(!h.input){qe('The "input" parameter is needed to be set when using returnInputValueOn'.concat(pt(u)));return}var b=c.getInput(),N=EO(c,h);h.inputValidator?PO(c,N,u):b&&!b.checkValidity()?(c.enableButtons(),c.showValidationMessage(h.validationMessage||b.validationMessage)):u==="deny"?ap(c,N):lp(c,N)},PO=function(c,u,h){var b=Me.innerParams.get(c);c.disableInput();var N=Promise.resolve().then(function(){return se(b.inputValidator(u,b.validationMessage))});N.then(function(K){c.enableButtons(),c.enableInput(),K?c.showValidationMessage(K):h==="deny"?ap(c,u):lp(c,u)})},ap=function(c,u){var h=Me.innerParams.get(c||Kc);if(h.showLoaderOnDeny&&Zs(Ji()),h.preDeny){c.isAwaitingPromise=!0;var b=Promise.resolve().then(function(){return se(h.preDeny(u,h.validationMessage))});b.then(function(N){N===!1?(c.hideLoading(),Ya(c)):c.close({isDenied:!0,value:typeof N>"u"?u:N})}).catch(function(N){return u_(c||Kc,N)})}else c.close({isDenied:!0,value:u})},c_=function(c,u){c.close({isConfirmed:!0,value:u})},u_=function(c,u){c.rejectPromise(u)},lp=function(c,u){var h=Me.innerParams.get(c||Kc);if(h.showLoaderOnConfirm&&Zs(),h.preConfirm){c.resetValidationMessage(),c.isAwaitingPromise=!0;var b=Promise.resolve().then(function(){return se(h.preConfirm(u,h.validationMessage))});b.then(function(N){jt(jc())||N===!1?(c.hideLoading(),Ya(c)):c_(c,typeof N>"u"?u:N)}).catch(function(N){return u_(c||Kc,N)})}else c_(c,u)};function Qc(){var f=Me.innerParams.get(this);if(f){var c=Me.domCache.get(this);Rt(c.loader),Hc()?f.icon&&bt(Cr()):FO(c),Gn([c.popup,c.actions],D.loading),c.popup.removeAttribute("aria-busy"),c.popup.removeAttribute("data-loading"),c.confirmButton.disabled=!1,c.denyButton.disabled=!1,c.cancelButton.disabled=!1}}var FO=function(c){var u=c.popup.getElementsByClassName(c.loader.getAttribute("data-button-to-replace"));u.length?bt(u[0],"inline-block"):hx()&&Rt(c.actions)};function d_(){var f=Me.innerParams.get(this),c=Me.domCache.get(this);return c?Wc(c.popup,f.input):null}function h_(f,c,u){var h=Me.domCache.get(f);c.forEach(function(b){h[b].disabled=u})}function f_(f,c){var u=Te();if(!(!u||!f))if(f.type==="radio")for(var h=u.querySelectorAll('[name="'.concat(D.radio,'"]')),b=0;b<h.length;b++)h[b].disabled=c;else f.disabled=c}function p_(){h_(this,["confirmButton","denyButton","cancelButton"],!1)}function m_(){h_(this,["confirmButton","denyButton","cancelButton"],!0)}function g_(){f_(this.getInput(),!1)}function y_(){f_(this.getInput(),!0)}function v_(f){var c=Me.domCache.get(this),u=Me.innerParams.get(this);tn(c.validationMessage,f),c.validationMessage.className=D["validation-message"],u.customClass&&u.customClass.validationMessage&&be(c.validationMessage,u.customClass.validationMessage),bt(c.validationMessage);var h=this.getInput();h&&(h.setAttribute("aria-invalid","true"),h.setAttribute("aria-describedby",D["validation-message"]),U0(h),be(h,D.inputerror))}function w_(){var f=Me.domCache.get(this);f.validationMessage&&Rt(f.validationMessage);var c=this.getInput();c&&(c.removeAttribute("aria-invalid"),c.removeAttribute("aria-describedby"),Gn(c,D.inputerror))}var eo={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,animation:!0,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},LO=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],BO={allowEnterKey:void 0},VO=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],b_=function(c){return Object.prototype.hasOwnProperty.call(eo,c)},__=function(c){return LO.indexOf(c)!==-1},S_=function(c){return BO[c]},qO=function(c){b_(c)||nt('Unknown parameter "'.concat(c,'"'))},UO=function(c){VO.includes(c)&&nt('The parameter "'.concat(c,'" is incompatible with toasts'))},zO=function(c){var u=S_(c);u&&G(c,u)},jO=function(c){c.backdrop===!1&&c.allowOutsideClick&&nt('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(var u in c)qO(u),c.toast&&UO(u),zO(u)};function C_(f){var c=Te(),u=Me.innerParams.get(this);if(!c||Er(c,u.hideClass.popup)){nt("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}var h=GO(f),b=Object.assign({},u,h);J0(this,b),Me.innerParams.set(this,b),Object.defineProperties(this,{params:{value:Object.assign({},this.params,f),writable:!1,enumerable:!0}})}var GO=function(c){var u={};return Object.keys(c).forEach(function(h){__(h)?u[h]=c[h]:nt("Invalid parameter to update: ".concat(h))}),u};function E_(){var f=Me.domCache.get(this),c=Me.innerParams.get(this);if(!c){T_(this);return}f.popup&&Z.swalCloseEventFinishedCallback&&(Z.swalCloseEventFinishedCallback(),delete Z.swalCloseEventFinishedCallback),typeof c.didDestroy=="function"&&c.didDestroy(),HO(this)}var HO=function(c){T_(c),delete c.params,delete Z.keydownHandler,delete Z.keydownTarget,delete Z.currentInstance},T_=function(c){c.isAwaitingPromise?(cp(Me,c),c.isAwaitingPromise=!0):(cp(Js,c),cp(Me,c),delete c.isAwaitingPromise,delete c.disableButtons,delete c.enableButtons,delete c.getInput,delete c.disableInput,delete c.enableInput,delete c.hideLoading,delete c.disableLoading,delete c.showValidationMessage,delete c.resetValidationMessage,delete c.close,delete c.closePopup,delete c.closeModal,delete c.closeToast,delete c.rejectPromise,delete c.update,delete c._destroy)},cp=function(c,u){for(var h in c)c[h].delete(u)},WO=Object.freeze({__proto__:null,_destroy:E_,close:Hr,closeModal:Hr,closePopup:Hr,closeToast:Hr,disableButtons:m_,disableInput:y_,disableLoading:Qc,enableButtons:p_,enableInput:g_,getInput:d_,handleAwaitingPromise:Ya,hideLoading:Qc,rejectPromise:i_,resetValidationMessage:w_,showValidationMessage:v_,update:C_}),$O=function(c,u,h){c.toast?KO(c,u,h):(YO(u),JO(u),XO(c,u,h))},KO=function(c,u,h){u.popup.onclick=function(){c&&(QO(c)||c.timer||c.input)||h(Ys.close)}},QO=function(c){return!!(c.showConfirmButton||c.showDenyButton||c.showCancelButton||c.showCloseButton)},Yc=!1,YO=function(c){c.popup.onmousedown=function(){c.container.onmouseup=function(u){c.container.onmouseup=function(){},u.target===c.container&&(Yc=!0)}}},JO=function(c){c.container.onmousedown=function(u){u.target===c.container&&u.preventDefault(),c.popup.onmouseup=function(h){c.popup.onmouseup=function(){},(h.target===c.popup||h.target instanceof HTMLElement&&c.popup.contains(h.target))&&(Yc=!0)}}},XO=function(c,u,h){u.container.onclick=function(b){if(Yc){Yc=!1;return}b.target===u.container&&ee(c.allowOutsideClick)&&h(Ys.backdrop)}},ZO=function(c){return v(c)==="object"&&c.jquery},A_=function(c){return c instanceof Element||ZO(c)},eM=function(c){var u={};return v(c[0])==="object"&&!A_(c[0])?Object.assign(u,c[0]):["title","html","icon"].forEach(function(h,b){var N=c[b];typeof N=="string"||A_(N)?u[h]=N:N!==void 0&&qe("Unexpected type of ".concat(h,'! Expected "string" or "Element", got ').concat(v(N)))}),u};function tM(){for(var f=this,c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];return m(f,u)}function nM(f){var c=function(u){function h(){return a(this,h),s(this,h,arguments)}return q(h,u),C(h,[{key:"_main",value:function(N,K){return O(k(h.prototype),"_main",this).call(this,N,Object.assign({},f,K))}}])}(this);return c}var rM=function(){return Z.timeout&&Z.timeout.getTimerLeft()},I_=function(){if(Z.timeout)return fx(),Z.timeout.stop()},D_=function(){if(Z.timeout){var c=Z.timeout.start();return np(c),c}},iM=function(){var c=Z.timeout;return c&&(c.running?I_():D_())},sM=function(c){if(Z.timeout){var u=Z.timeout.increase(c);return np(u,!0),u}},oM=function(){return!!(Z.timeout&&Z.timeout.isRunning())},k_=!1,up={};function aM(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";up[f]=this,k_||(document.body.addEventListener("click",lM),k_=!0)}var lM=function(c){for(var u=c.target;u&&u!==document;u=u.parentNode)for(var h in up){var b=u.getAttribute(h);if(b){up[h].fire({template:b});return}}},cM=Object.freeze({__proto__:null,argsToParams:eM,bindClickHandler:aM,clickCancel:Zx,clickConfirm:X0,clickDeny:Xx,enableLoading:Zs,fire:tM,getActions:$a,getCancelButton:Ks,getCloseButton:Xf,getConfirmButton:jn,getContainer:He,getDenyButton:Ji,getFocusableElements:Zf,getFooter:q0,getHtmlContainer:Yf,getIcon:Cr,getIconContent:ax,getImage:V0,getInputLabel:lx,getLoader:Qs,getPopup:Te,getProgressSteps:Jf,getTimerLeft:rM,getTimerProgressBar:Gc,getTitle:B0,getValidationMessage:jc,increaseTimer:sM,isDeprecatedParameter:S_,isLoading:ux,isTimerRunning:oM,isUpdatableParameter:__,isValidParameter:b_,isVisible:Jx,mixin:nM,resumeTimer:D_,showLoading:Zs,stopTimer:I_,toggleTimer:iM}),uM=function(){function f(c,u){a(this,f),this.callback=c,this.remaining=u,this.running=!1,this.start()}return C(f,[{key:"start",value:function(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}},{key:"stop",value:function(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}},{key:"increase",value:function(u){var h=this.running;return h&&this.stop(),this.remaining+=u,h&&this.start(),this.remaining}},{key:"getTimerLeft",value:function(){return this.running&&(this.stop(),this.start()),this.remaining}},{key:"isRunning",value:function(){return this.running}}])}(),R_=["swal-title","swal-html","swal-footer"],dM=function(c){var u=typeof c.template=="string"?document.querySelector(c.template):c.template;if(!u)return{};var h=u.content;wM(h);var b=Object.assign(hM(h),fM(h),pM(h),mM(h),gM(h),yM(h),vM(h,R_));return b},hM=function(c){var u={},h=Array.from(c.querySelectorAll("swal-param"));return h.forEach(function(b){ts(b,["name","value"]);var N=b.getAttribute("name"),K=b.getAttribute("value");typeof eo[N]=="boolean"?u[N]=K!=="false":v(eo[N])==="object"?u[N]=JSON.parse(K):u[N]=K}),u},fM=function(c){var u={},h=Array.from(c.querySelectorAll("swal-function-param"));return h.forEach(function(b){var N=b.getAttribute("name"),K=b.getAttribute("value");u[N]=new Function("return ".concat(K))()}),u},pM=function(c){var u={},h=Array.from(c.querySelectorAll("swal-button"));return h.forEach(function(b){ts(b,["type","color","aria-label"]);var N=b.getAttribute("type");u["".concat(N,"ButtonText")]=b.innerHTML,u["show".concat(pt(N),"Button")]=!0,b.hasAttribute("color")&&(u["".concat(N,"ButtonColor")]=b.getAttribute("color")),b.hasAttribute("aria-label")&&(u["".concat(N,"ButtonAriaLabel")]=b.getAttribute("aria-label"))}),u},mM=function(c){var u={},h=c.querySelector("swal-image");return h&&(ts(h,["src","width","height","alt"]),h.hasAttribute("src")&&(u.imageUrl=h.getAttribute("src")||void 0),h.hasAttribute("width")&&(u.imageWidth=h.getAttribute("width")||void 0),h.hasAttribute("height")&&(u.imageHeight=h.getAttribute("height")||void 0),h.hasAttribute("alt")&&(u.imageAlt=h.getAttribute("alt")||void 0)),u},gM=function(c){var u={},h=c.querySelector("swal-icon");return h&&(ts(h,["type","color"]),h.hasAttribute("type")&&(u.icon=h.getAttribute("type")),h.hasAttribute("color")&&(u.iconColor=h.getAttribute("color")),u.iconHtml=h.innerHTML),u},yM=function(c){var u={},h=c.querySelector("swal-input");h&&(ts(h,["type","label","placeholder","value"]),u.input=h.getAttribute("type")||"text",h.hasAttribute("label")&&(u.inputLabel=h.getAttribute("label")),h.hasAttribute("placeholder")&&(u.inputPlaceholder=h.getAttribute("placeholder")),h.hasAttribute("value")&&(u.inputValue=h.getAttribute("value")));var b=Array.from(c.querySelectorAll("swal-input-option"));return b.length&&(u.inputOptions={},b.forEach(function(N){ts(N,["value"]);var K=N.getAttribute("value"),ue=N.innerHTML;u.inputOptions[K]=ue})),u},vM=function(c,u){var h={};for(var b in u){var N=u[b],K=c.querySelector(N);K&&(ts(K,[]),h[N.replace(/^swal-/,"")]=K.innerHTML.trim())}return h},wM=function(c){var u=R_.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(c.children).forEach(function(h){var b=h.tagName.toLowerCase();u.includes(b)||nt("Unrecognized element <".concat(b,">"))})},ts=function(c,u){Array.from(c.attributes).forEach(function(h){u.indexOf(h.name)===-1&&nt(['Unrecognized attribute "'.concat(h.name,'" on <').concat(c.tagName.toLowerCase(),">."),"".concat(u.length?"Allowed attributes are: ".concat(u.join(", ")):"To set the value, use HTML within the element.")])})},x_=10,bM=function(c){var u=He(),h=Te();typeof c.willOpen=="function"&&c.willOpen(h);var b=window.getComputedStyle(document.body),N=b.overflowY;EM(u,h,c),setTimeout(function(){SM(u,h)},x_),ep()&&(CM(u,c.scrollbarPadding,N),aO()),!Hc()&&!Z.previousActiveElement&&(Z.previousActiveElement=document.activeElement),typeof c.didOpen=="function"&&setTimeout(function(){return c.didOpen(h)}),Gn(u,D["no-transition"])},_M=function f(c){var u=Te();if(!(c.target!==u||!es)){var h=He();u.removeEventListener(es,f),h.style.overflowY="auto"}},SM=function(c,u){es&&H0(u)?(c.style.overflowY="hidden",u.addEventListener(es,_M)):c.style.overflowY="auto"},CM=function(c,u,h){lO(),u&&h!=="hidden"&&mO(h),setTimeout(function(){c.scrollTop=0})},EM=function(c,u,h){be(c,h.showClass.backdrop),h.animation?(u.style.setProperty("opacity","0","important"),bt(u,"grid"),setTimeout(function(){be(u,h.showClass.popup),u.style.removeProperty("opacity")},x_)):bt(u,"grid"),be([document.documentElement,document.body],D.shown),h.heightAuto&&h.backdrop&&!h.toast&&be([document.documentElement,document.body],D["height-auto"])},O_={email:function(c,u){return/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(c)?Promise.resolve():Promise.resolve(u||"Invalid email address")},url:function(c,u){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(c)?Promise.resolve():Promise.resolve(u||"Invalid URL")}};function TM(f){f.inputValidator||(f.input==="email"&&(f.inputValidator=O_.email),f.input==="url"&&(f.inputValidator=O_.url))}function AM(f){(!f.target||typeof f.target=="string"&&!document.querySelector(f.target)||typeof f.target!="string"&&!f.target.appendChild)&&(nt('Target parameter is not valid, defaulting to "body"'),f.target="body")}function IM(f){TM(f),f.showLoaderOnConfirm&&!f.preConfirm&&nt(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),AM(f),typeof f.title=="string"&&(f.title=f.title.split(`
`).join("<br />")),bx(f)}var Hn,Jc=new WeakMap,it=function(){function f(){if(a(this,f),d(this,Jc,void 0),!(typeof window>"u")){Hn=this;for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];var b=Object.freeze(this.constructor.argsToParams(u));this.params=b,this.isAwaitingPromise=!1,p(Jc,this,this._main(Hn.params))}}return C(f,[{key:"_main",value:function(u){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(jO(Object.assign({},h,u)),Z.currentInstance){var b=Js.swalPromiseResolve.get(Z.currentInstance),N=Z.currentInstance.isAwaitingPromise;Z.currentInstance._destroy(),N||b({isDismissed:!0}),ep()&&t_()}Z.currentInstance=Hn;var K=kM(u,h);IM(K),Object.freeze(K),Z.timeout&&(Z.timeout.stop(),delete Z.timeout),clearTimeout(Z.restoreFocusTimeout);var ue=RM(Hn);return J0(Hn,K),Me.innerParams.set(Hn,K),DM(Hn,ue,K)}},{key:"then",value:function(u){return l(Jc,this).then(u)}},{key:"finally",value:function(u){return l(Jc,this).finally(u)}}])}(),DM=function(c,u,h){return new Promise(function(b,N){var K=function(ae){c.close({isDismissed:!0,dismiss:ae})};Js.swalPromiseResolve.set(c,b),Js.swalPromiseReject.set(c,N),u.confirmButton.onclick=function(){OO(c)},u.denyButton.onclick=function(){MO(c)},u.cancelButton.onclick=function(){NO(c,K)},u.closeButton.onclick=function(){K(Ys.close)},$O(h,u,K),eO(Z,h,K),CO(c,h),bM(h),xM(Z,h,K),OM(u,h),setTimeout(function(){u.container.scrollTop=0})})},kM=function(c,u){var h=dM(c),b=Object.assign({},eo,u,h,c);return b.showClass=Object.assign({},eo.showClass,b.showClass),b.hideClass=Object.assign({},eo.hideClass,b.hideClass),b.animation===!1&&(b.showClass={backdrop:"swal2-noanimation"},b.hideClass={}),b},RM=function(c){var u={popup:Te(),container:He(),actions:$a(),confirmButton:jn(),denyButton:Ji(),cancelButton:Ks(),loader:Qs(),closeButton:Xf(),validationMessage:jc(),progressSteps:Jf()};return Me.domCache.set(c,u),u},xM=function(c,u,h){var b=Gc();Rt(b),u.timer&&(c.timeout=new uM(function(){h("timer"),delete c.timeout},u.timer),u.timerProgressBar&&(bt(b),un(b,u,"timerProgressBar"),setTimeout(function(){c.timeout&&c.timeout.running&&np(u.timer)})))},OM=function(c,u){if(!u.toast){if(!ee(u.allowEnterKey)){G("allowEnterKey"),PM();return}MM(c)||NM(c,u)||op(-1,1)}},MM=function(c){var u=c.popup.querySelectorAll("[autofocus]"),h=x(u),b;try{for(h.s();!(b=h.n()).done;){var N=b.value;if(N instanceof HTMLElement&&jt(N))return N.focus(),!0}}catch(K){h.e(K)}finally{h.f()}return!1},NM=function(c,u){return u.focusDeny&&jt(c.denyButton)?(c.denyButton.focus(),!0):u.focusCancel&&jt(c.cancelButton)?(c.cancelButton.focus(),!0):u.focusConfirm&&jt(c.confirmButton)?(c.confirmButton.focus(),!0):!1},PM=function(){document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){var M_=new Date,N_=localStorage.getItem("swal-initiation");N_?(M_.getTime()-Date.parse(N_))/(1e3*60*60*24)>3&&setTimeout(function(){document.body.style.pointerEvents="none";var f=document.createElement("audio");f.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",f.loop=!0,document.body.appendChild(f),setTimeout(function(){f.play().catch(function(){})},2500)},500):localStorage.setItem("swal-initiation","".concat(M_))}it.prototype.disableButtons=m_,it.prototype.enableButtons=p_,it.prototype.getInput=d_,it.prototype.disableInput=y_,it.prototype.enableInput=g_,it.prototype.hideLoading=Qc,it.prototype.disableLoading=Qc,it.prototype.showValidationMessage=v_,it.prototype.resetValidationMessage=w_,it.prototype.close=Hr,it.prototype.closePopup=Hr,it.prototype.closeModal=Hr,it.prototype.closeToast=Hr,it.prototype.rejectPromise=i_,it.prototype.update=C_,it.prototype._destroy=E_,Object.assign(it,cM),Object.keys(WO).forEach(function(f){it[f]=function(){if(Hn&&Hn[f]){var c;return(c=Hn)[f].apply(c,arguments)}return null}}),it.DismissReason=Ys,it.version="11.12.1";var Xc=it;return Xc.default=Xc,Xc});typeof Jn<"u"&&Jn.Sweetalert2&&(Jn.swal=Jn.sweetAlert=Jn.Swal=Jn.SweetAlert=Jn.Sweetalert2);typeof document<"u"&&function(n,e){var t=n.createElement("style");if(n.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.disabled||(t.styleSheet.cssText=e);else try{t.innerHTML=e}catch{t.innerText=e}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm:focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny:focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel:focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')});var Ce=F(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=dn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=dn.Propagate=dn.LogVerbosity=dn.Status=void 0;var DS=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(DS||(dn.Status=DS={})),kS=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(kS||(dn.LogVerbosity=kS={})),RS=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(RS||(dn.Propagate=RS={}));dn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;dn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var $p=F((vW,EN)=>{EN.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ze=F(Lt=>{"use strict";var Kp,Qp,Yp,Jp;Object.defineProperty(Lt,"__esModule",{value:!0});Lt.isTracerEnabled=Lt.trace=Lt.log=Lt.setLoggerVerbosity=Lt.setLogger=Lt.getLogger=void 0;var Zr=Ce(),TN=Ie("process"),AN=$p().version,IN={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},os=IN,lo=Zr.LogVerbosity.ERROR,DN=(Qp=(Kp=process.env.GRPC_NODE_VERBOSITY)!==null&&Kp!==void 0?Kp:process.env.GRPC_VERBOSITY)!==null&&Qp!==void 0?Qp:"";switch(DN.toUpperCase()){case"DEBUG":lo=Zr.LogVerbosity.DEBUG;break;case"INFO":lo=Zr.LogVerbosity.INFO;break;case"ERROR":lo=Zr.LogVerbosity.ERROR;break;case"NONE":lo=Zr.LogVerbosity.NONE;break;default:}var kN=()=>os;Lt.getLogger=kN;var RN=n=>{os=n};Lt.setLogger=RN;var xN=n=>{lo=n};Lt.setLoggerVerbosity=xN;var ON=(n,...e)=>{let t;if(n>=lo){switch(n){case Zr.LogVerbosity.DEBUG:t=os.debug;break;case Zr.LogVerbosity.INFO:t=os.info;break;case Zr.LogVerbosity.ERROR:t=os.error;break}t||(t=os.error),t&&t.bind(os)(...e)}};Lt.log=ON;var MN=(Jp=(Yp=process.env.GRPC_NODE_TRACE)!==null&&Yp!==void 0?Yp:process.env.GRPC_TRACE)!==null&&Jp!==void 0?Jp:"",Xp=new Set,xS=new Set;for(let n of MN.split(","))n.startsWith("-")?xS.add(n.substring(1)):Xp.add(n);var NN=Xp.has("all");function PN(n,e,t){OS(e)&&(0,Lt.log)(n,new Date().toISOString()+" | v"+AN+" "+TN.pid+" | "+e+" | "+t)}Lt.trace=PN;function OS(n){return!xS.has(n)&&(NN||Xp.has(n))}Lt.isTracerEnabled=OS});var mu=F(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.getErrorCode=co.getErrorMessage=void 0;function FN(n){return n instanceof Error?n.message:String(n)}co.getErrorMessage=FN;function LN(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}co.getErrorCode=LN});var Yt=F(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});yu.Metadata=void 0;var BN=Ze(),VN=Ce(),qN=mu(),UN=/^[0-9a-z_.-]+$/,zN=/^[ -~]*$/;function jN(n){return UN.test(n)}function GN(n){return zN.test(n)}function NS(n){return n.endsWith("-bin")}function HN(n){return!n.startsWith("grpc-")}function gu(n){return n.toLowerCase()}function MS(n,e){if(!jN(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(NS(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!GN(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Zp=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=gu(e),MS(e,t),this.internalRepr.set(e,[t])}add(e,t){e=gu(e),MS(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=gu(e),this.internalRepr.delete(e)}get(e){return e=gu(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(WN);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{NS(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(HN(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,qN.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,BN.log)(VN.LogVerbosity.ERROR,o)}}return t}};yu.Metadata=Zp;var WN=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var im=F(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.CallCredentials=void 0;var rm=Yt();function $N(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var uo=class n{static createFromMetadataGenerator(e){return new tm(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;$N(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new rm.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new nm}};vu.CallCredentials=uo;var em=class n extends uo{constructor(e){super(),this.creds=e}generateMetadata(e){return I(this,null,function*(){let t=new rm.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},tm=class n extends uo{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new em([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},nm=class n extends uo{generateMetadata(e){return Promise.resolve(new rm.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var om=F(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.getDefaultRootsData=ho.CIPHER_SUITES=void 0;var KN=Ie("fs");ho.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var PS=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,sm=null;function QN(){return PS?(sm===null&&(sm=KN.readFileSync(PS)),sm):null}ho.getDefaultRootsData=QN});var _u=F(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.ChannelCredentials=void 0;var YN=Ie("tls"),JN=im(),FS=om();function am(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var fo=class{constructor(e){this.callCredentials=e||JN.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(am(e,"Root certificate"),am(t,"Private key"),am(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,YN.createSecureContext)({ca:(s=e??(0,FS.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:FS.CIPHER_SUITES});return new wu(o,i??{})}static createFromSecureContext(e,t){return new wu(e,t??{})}static createInsecure(){return new lm}};bu.ChannelCredentials=fo;var lm=class n extends fo{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},wu=class n extends fo{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new cm(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},cm=class n extends fo{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var ti=F(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.validateLoadBalancingConfig=xt.getFirstUsableConfig=xt.isLoadBalancerNameRegistered=xt.createLoadBalancer=xt.registerDefaultLoadBalancerType=xt.registerLoadBalancerType=xt.createChildChannelControlHelper=void 0;function XN(n,e){var t,r,i,s,o,a,l,d,p,m;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(d=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&d!==void 0?d:n.addChannelzChild.bind(n),removeChannelzChild:(m=(p=e.removeChannelzChild)===null||p===void 0?void 0:p.bind(e))!==null&&m!==void 0?m:n.removeChannelzChild.bind(n)}}xt.createChildChannelControlHelper=XN;var ei={},um=null;function ZN(n,e,t){ei[n]={LoadBalancer:e,LoadBalancingConfig:t}}xt.registerLoadBalancerType=ZN;function eP(n){um=n}xt.registerDefaultLoadBalancerType=eP;function tP(n,e){let t=n.getLoadBalancerName();return t in ei?new ei[t].LoadBalancer(e):null}xt.createLoadBalancer=tP;function nP(n){return n in ei}xt.isLoadBalancerNameRegistered=nP;function rP(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in ei)return t;return e&&um?new ei[um].LoadBalancingConfig:null}xt.getFirstUsableConfig=rP;function iP(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in ei)return ei[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}xt.validateLoadBalancingConfig=iP});var dm=F(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.extractAndSelectServiceConfig=ni.validateServiceConfig=ni.validateRetryThrottling=void 0;var sP=Ie("os"),Su=Ce(),oP=ti(),Cu=/^\d+(\.\d{1,9})?s$/,aP="node";function lP(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function cP(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Cu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Cu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Su.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Su.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function uP(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Cu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Su.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Su.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function dP(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(lP(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Cu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=cP(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=uP(n.hedgingPolicy));return t}function LS(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}ni.validateRetryThrottling=LS;function BS(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,oP.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(dP(r));"retryThrottling"in n&&(e.retryThrottling=LS(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}ni.validateServiceConfig=BS;function hP(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:BS(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function fP(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=hP(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===sP.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===aP&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function pP(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return fP(i,e)}return null}ni.extractAndSelectServiceConfig=pP});var hn=F(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.ConnectivityState=void 0;var VS=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(VS||(Eu.ConnectivityState=VS={}))});var rn=F(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.uriToString=ri.splitHostPort=ri.parseUri=void 0;var mP=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function gP(n){let e=mP.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}ri.parseUri=gP;var qS=/^\d+$/;function yP(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return qS.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?qS.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}ri.splitHostPort=yP;function vP(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}ri.uriToString=vP});var Xn=F(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.mapUriDefaultScheme=fn.getDefaultAuthority=fn.createResolver=fn.registerDefaultScheme=fn.registerResolver=void 0;var fm=rn(),po={},hm=null;function wP(n,e){po[n]=e}fn.registerResolver=wP;function bP(n){hm=n}fn.registerDefaultScheme=bP;function _P(n,e,t){if(n.scheme!==void 0&&n.scheme in po)return new po[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,fm.uriToString)(n)}`)}fn.createResolver=_P;function SP(n){if(n.scheme!==void 0&&n.scheme in po)return po[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,fm.uriToString)(n)}`)}fn.getDefaultAuthority=SP;function CP(n){return n.scheme===void 0||!(n.scheme in po)?hm!==null?{scheme:hm,authority:void 0,path:(0,fm.uriToString)(n)}:null:n}fn.mapUriDefaultScheme=CP});var si=F(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.QueuePicker=ii.UnavailablePicker=ii.PickResultType=void 0;var EP=Yt(),TP=Ce(),Tu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Tu||(ii.PickResultType=Tu={})),pm=class{constructor(e){this.status=Object.assign({code:TP.Status.UNAVAILABLE,details:"No connection established",metadata:new EP.Metadata},e)}pick(e){return{pickResultType:Tu.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};ii.UnavailablePicker=pm;var mm=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Tu.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};ii.QueuePicker=mm});var al=F(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.BackoffTimeout=void 0;var AP=1e3,IP=1.6,DP=12e4,kP=.2;function RP(n,e){return Math.random()*(e-n)+n}var gm=class{constructor(e,t){this.callback=e,this.initialDelay=AP,this.multiplier=IP,this.maxDelay=DP,this.jitter=kP,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+RP(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Au.BackoffTimeout=gm});var Du=F(Iu=>{"use strict";Object.defineProperty(Iu,"__esModule",{value:!0});Iu.ChildLoadBalancerHandler=void 0;var xP=ti(),OP=hn(),MP="child_load_balancer_helper",ym=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===OP.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,xP.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return MP}};Iu.ChildLoadBalancerHandler=ym});var zS=F(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});ku.ResolvingLoadBalancer=void 0;var NP=ti(),PP=dm(),Jt=hn(),FP=Xn(),mo=si(),LP=al(),vm=Ce(),BP=Yt(),VP=Ze(),qP=Ce(),UP=rn(),zP=Du(),jP="resolving_load_balancer";function US(n){VP.trace(qP.LogVerbosity.DEBUG,jP,n)}var GP=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function HP(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function WP(n,e,t,r){for(let i of t)if(HP(n,e,i,r))return i;return null}function $P(n){return function(t,r){var i,s;let o=t.split("/").filter(d=>d.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let d of GP){let p=WP(a,l,n.methodConfig,d);if(p)return{methodConfig:p,pickInformation:{},status:vm.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:vm.Status.OK,dynamicFilterFactories:[]}}}var wm=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Jt.ConnectivityState.IDLE,this.latestChildPicker=new mo.QueuePicker(this),this.currentState=Jt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,PP.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Jt.ConnectivityState.IDLE,new mo.QueuePicker(this)),this.childLoadBalancer=new zP.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(US("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,FP.createResolver)(e,{onSuccessfulResolution:(a,l,d,p,m)=>{var y;this.backoffTimeout.stop(),this.backoffTimeout.reset();let C=null;l===null?d===null?(this.previousServiceConfig=null,C=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(d):C=this.previousServiceConfig:(C=l,this.previousServiceConfig=l);let x=(y=C?.loadBalancingConfig)!==null&&y!==void 0?y:[],O=(0,NP.getFirstUsableConfig)(x,!0);if(O===null){this.handleResolutionFailure({code:vm.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new BP.Metadata});return}this.childLoadBalancer.updateAddressList(a,O,m);let k=C??this.defaultServiceConfig;this.onSuccessfulResolution(k,p??$P(k))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new LP.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Jt.ConnectivityState.IDLE&&this.updateState(Jt.ConnectivityState.CONNECTING,new mo.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){US((0,UP.uriToString)(this.target)+" "+Jt.ConnectivityState[this.currentState]+" -> "+Jt.ConnectivityState[e]),e===Jt.ConnectivityState.IDLE&&(t=new mo.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Jt.ConnectivityState.IDLE&&(this.updateState(Jt.ConnectivityState.TRANSIENT_FAILURE,new mo.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Jt.ConnectivityState.IDLE||this.currentState===Jt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Jt.ConnectivityState.IDLE,this.latestChildPicker=new mo.QueuePicker(this),this.currentState=Jt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};ku.ResolvingLoadBalancer=wm});var jS=F(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.channelOptionsEqual=go.recognizedOptions=void 0;go.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function KP(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}go.channelOptionsEqual=KP});var er=F(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.stringToSubchannelAddress=Zn.subchannelAddressToString=Zn.subchannelAddressEqual=Zn.isTcpSubchannelAddress=void 0;var QP=Ie("net");function ll(n){return"port"in n}Zn.isTcpSubchannelAddress=ll;function YP(n,e){return!n&&!e?!0:!n||!e?!1:ll(n)?ll(e)&&n.host===e.host&&n.port===e.port:!ll(e)&&n.path===e.path}Zn.subchannelAddressEqual=YP;function JP(n){return ll(n)?n.host+":"+n.port:n.path}Zn.subchannelAddressToString=JP;var XP=443;function ZP(n,e){return(0,QP.isIP)(n)?{host:n,port:e??XP}:{path:n}}Zn.stringToSubchannelAddress=ZP});var Ru=F(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.addAdminServicesToServer=yo.registerAdminService=void 0;var GS=[];function e2(n,e){GS.push({getServiceDefinition:n,getHandlers:e})}yo.registerAdminService=e2;function t2(n){for(let{getServiceDefinition:e,getHandlers:t}of GS)n.addService(e(),t())}yo.addAdminServicesToServer=t2});var HS=F(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.ClientDuplexStreamImpl=pn.ClientWritableStreamImpl=pn.ClientReadableStreamImpl=pn.ClientUnaryCallImpl=pn.callErrorFromStatus=void 0;var n2=Ie("events"),Em=Ie("stream"),cl=Ce();function r2(n,e){let t=`${n.code} ${cl.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}pn.callErrorFromStatus=r2;var bm=class extends n2.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};pn.ClientUnaryCallImpl=bm;var _m=class extends Em.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};pn.ClientReadableStreamImpl=_m;var Sm=class extends Em.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};pn.ClientWritableStreamImpl=Sm;var Cm=class extends Em.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(cl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};pn.ClientDuplexStreamImpl=Cm});var WS=F(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.InterceptingListenerImpl=vo.isInterceptingListener=void 0;function i2(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}vo.isInterceptingListener=i2;var Tm=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};vo.InterceptingListenerImpl=Tm});var Om=F(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.getInterceptingCall=mn.InterceptingCall=mn.RequesterBuilder=mn.ListenerBuilder=mn.InterceptorConfigurationError=void 0;var s2=Yt(),$S=WS(),KS=Ce(),QS=mu(),dl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};mn.InterceptorConfigurationError=dl;var Im=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};mn.ListenerBuilder=Im;var Dm=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};mn.RequesterBuilder=Dm;var Am={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},ul={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},km=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:ul.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:ul.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:ul.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:ul.cancel}:this.requester=ul}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let d={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:p=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:p=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:p=>{}};this.processingMetadata=!0,this.requester.start(e,d,(p,m)=>{var y,C,x;this.processingMetadata=!1;let O;if((0,$S.isInterceptingListener)(m))O=m;else{let k={onReceiveMetadata:(y=m.onReceiveMetadata)!==null&&y!==void 0?y:Am.onReceiveMetadata,onReceiveMessage:(C=m.onReceiveMessage)!==null&&C!==void 0?C:Am.onReceiveMessage,onReceiveStatus:(x=m.onReceiveStatus)!==null&&x!==void 0?x:Am.onReceiveStatus};O=new $S.InterceptingListenerImpl(k,d)}this.nextCall.start(p,O),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};mn.InterceptingCall=km;function o2(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,d=t.credentials,p=n.createCall(e,s,o,a,l);return d&&p.setCredentials(d),p}var xu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(KS.Status.INTERNAL,`Request message serialization failure: ${(0,QS.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:KS.Status.INTERNAL,details:`Response message parsing error: ${(0,QS.getErrorMessage)(a)}`,metadata:new s2.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Rm=class extends xu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,d;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(d=t?.onReceiveStatus)===null||d===void 0||d.call(t,a)}};super.start(e,o),this.call.startRead()}},xm=class extends xu{};function a2(n,e,t){let r=o2(n,t.path,e);return t.responseStream?new xm(r,t):new Rm(r,t)}function l2(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new dl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new dl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>d=>l(d,a),a=>a2(r,a,e))(s)}mn.getInterceptingCall=l2});var Pm=F(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});Mu.Client=void 0;var tr=HS(),c2=Fm(),u2=hn(),oi=Ce(),wo=Yt(),Ou=Om(),Dn=Symbol(),bo=Symbol(),_o=Symbol(),Ar=Symbol();function Mm(n){return typeof n=="function"}function So(n){return n.stack.split(`
`).slice(1).join(`
`)}var Nm=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[bo]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[_o]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[bo].length>0&&this[_o].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Ar]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Dn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Dn]=o(e,t,r)}else this[Dn]=new c2.ChannelImplementation(e,t,r)}close(){this[Dn].close()}getChannel(){return this[Dn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Dn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===u2.ConnectivityState.READY)t();else try{this[Dn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Mm(e))return{metadata:new wo.Metadata,options:{},callback:e};if(Mm(t))return e instanceof wo.Metadata?{metadata:e,options:{},callback:t}:{metadata:new wo.Metadata,options:e,callback:t};if(!(e instanceof wo.Metadata&&t instanceof Object&&Mm(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,d;let p=this.checkOptionalUnaryResponseArguments(s,o,a),m={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},y={argument:i,metadata:p.metadata,call:new tr.ClientUnaryCallImpl,channel:this[Dn],methodDefinition:m,callOptions:p.options,callback:p.callback};this[Ar]&&(y=this[Ar](y));let C=y.call,x={clientInterceptors:this[bo],clientInterceptorProviders:this[_o],callInterceptors:(l=y.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(d=y.callOptions.interceptor_providers)!==null&&d!==void 0?d:[]},O=(0,Ou.getInterceptingCall)(x,y.methodDefinition,y.callOptions,y.channel);C.call=O;let k=null,q=!1,P=new Error;return O.start(y.metadata,{onReceiveMetadata:U=>{C.emit("metadata",U)},onReceiveMessage(U){k!==null&&O.cancelWithStatus(oi.Status.INTERNAL,"Too many responses received"),k=U},onReceiveStatus(U){if(!q){if(q=!0,U.code===oi.Status.OK)if(k===null){let j=So(P);y.callback((0,tr.callErrorFromStatus)({code:oi.Status.INTERNAL,details:"No message received",metadata:U.metadata},j))}else y.callback(null,k);else{let j=So(P);y.callback((0,tr.callErrorFromStatus)(U,j))}P=null,C.emit("status",U)}}}),O.sendMessage(i),O.halfClose(),C}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let d=this.checkOptionalUnaryResponseArguments(i,s,o),p={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},m={metadata:d.metadata,call:new tr.ClientWritableStreamImpl(t),channel:this[Dn],methodDefinition:p,callOptions:d.options,callback:d.callback};this[Ar]&&(m=this[Ar](m));let y=m.call,C={clientInterceptors:this[bo],clientInterceptorProviders:this[_o],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},x=(0,Ou.getInterceptingCall)(C,m.methodDefinition,m.callOptions,m.channel);y.call=x;let O=null,k=!1,q=new Error;return x.start(m.metadata,{onReceiveMetadata:P=>{y.emit("metadata",P)},onReceiveMessage(P){O!==null&&x.cancelWithStatus(oi.Status.INTERNAL,"Too many responses received"),O=P},onReceiveStatus(P){if(!k){if(k=!0,P.code===oi.Status.OK)if(O===null){let U=So(q);m.callback((0,tr.callErrorFromStatus)({code:oi.Status.INTERNAL,details:"No message received",metadata:P.metadata},U))}else m.callback(null,O);else{let U=So(q);m.callback((0,tr.callErrorFromStatus)(P,U))}q=null,y.emit("status",P)}}}),y}checkMetadataAndOptions(e,t){let r,i;return e instanceof wo.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new wo.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let d=this.checkMetadataAndOptions(s,o),p={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},m={argument:i,metadata:d.metadata,call:new tr.ClientReadableStreamImpl(r),channel:this[Dn],methodDefinition:p,callOptions:d.options};this[Ar]&&(m=this[Ar](m));let y=m.call,C={clientInterceptors:this[bo],clientInterceptorProviders:this[_o],callInterceptors:(a=m.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=m.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},x=(0,Ou.getInterceptingCall)(C,m.methodDefinition,m.callOptions,m.channel);y.call=x;let O=!1,k=new Error;return x.start(m.metadata,{onReceiveMetadata(q){y.emit("metadata",q)},onReceiveMessage(q){y.push(q)},onReceiveStatus(q){if(!O){if(O=!0,y.push(null),q.code!==oi.Status.OK){let P=So(k);y.emit("error",(0,tr.callErrorFromStatus)(q,P))}k=null,y.emit("status",q)}}}),x.sendMessage(i),x.halfClose(),y}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),d={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},p={metadata:l.metadata,call:new tr.ClientDuplexStreamImpl(t,r),channel:this[Dn],methodDefinition:d,callOptions:l.options};this[Ar]&&(p=this[Ar](p));let m=p.call,y={clientInterceptors:this[bo],clientInterceptorProviders:this[_o],callInterceptors:(o=p.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=p.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},C=(0,Ou.getInterceptingCall)(y,p.methodDefinition,p.callOptions,p.channel);m.call=C;let x=!1,O=new Error;return C.start(p.metadata,{onReceiveMetadata(k){m.emit("metadata",k)},onReceiveMessage(k){m.push(k)},onReceiveStatus(k){if(!x){if(x=!0,m.push(null),k.code!==oi.Status.OK){let q=So(O);m.emit("error",(0,tr.callErrorFromStatus)(k,q))}O=null,m.emit("status",k)}}}),m}};Mu.Client=Nm});var Bm=F(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.loadPackageDefinition=Co.makeClientConstructor=void 0;var hl=Pm(),d2={unary:hl.Client.prototype.makeUnaryRequest,server_stream:hl.Client.prototype.makeServerStreamRequest,client_stream:hl.Client.prototype.makeClientStreamRequest,bidi:hl.Client.prototype.makeBidiStreamRequest};function Lm(n){return["__proto__","prototype","constructor"].includes(n)}function YS(n,e,t){t||(t={});class r extends hl.Client{}return Object.keys(n).forEach(i=>{if(Lm(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,d=h2(d2[o],s.path,a,l);r.prototype[i]=d,Object.assign(r.prototype[i],s),s.originalName&&!Lm(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}Co.makeClientConstructor=YS;function h2(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function f2(n){return"format"in n}function p2(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Lm(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];f2(r)?o[s]=r:o[s]=YS(r,s,{})}return e}Co.loadPackageDefinition=p2});var _C=F((GW,bC)=>{"use strict";var m2=1/0,g2="[object Symbol]",y2=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,v2=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pu="\\ud800-\\udfff",iC="\\u0300-\\u036f\\ufe20-\\ufe23",sC="\\u20d0-\\u20f0",oC="\\u2700-\\u27bf",aC="a-z\\xdf-\\xf6\\xf8-\\xff",w2="\\xac\\xb1\\xd7\\xf7",b2="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",_2="\\u2000-\\u206f",S2=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",lC="A-Z\\xc0-\\xd6\\xd8-\\xde",cC="\\ufe0e\\ufe0f",uC=w2+b2+_2+S2,qm="['\u2019]",C2="["+Pu+"]",JS="["+uC+"]",Nu="["+iC+sC+"]",dC="\\d+",E2="["+oC+"]",hC="["+aC+"]",fC="[^"+Pu+uC+dC+oC+aC+lC+"]",Vm="\\ud83c[\\udffb-\\udfff]",T2="(?:"+Nu+"|"+Vm+")",pC="[^"+Pu+"]",Um="(?:\\ud83c[\\udde6-\\uddff]){2}",zm="[\\ud800-\\udbff][\\udc00-\\udfff]",Eo="["+lC+"]",mC="\\u200d",XS="(?:"+hC+"|"+fC+")",A2="(?:"+Eo+"|"+fC+")",ZS="(?:"+qm+"(?:d|ll|m|re|s|t|ve))?",eC="(?:"+qm+"(?:D|LL|M|RE|S|T|VE))?",gC=T2+"?",yC="["+cC+"]?",I2="(?:"+mC+"(?:"+[pC,Um,zm].join("|")+")"+yC+gC+")*",vC=yC+gC+I2,D2="(?:"+[E2,Um,zm].join("|")+")"+vC,k2="(?:"+[pC+Nu+"?",Nu,Um,zm,C2].join("|")+")",R2=RegExp(qm,"g"),x2=RegExp(Nu,"g"),O2=RegExp(Vm+"(?="+Vm+")|"+k2+vC,"g"),M2=RegExp([Eo+"?"+hC+"+"+ZS+"(?="+[JS,Eo,"$"].join("|")+")",A2+"+"+eC+"(?="+[JS,Eo+XS,"$"].join("|")+")",Eo+"?"+XS+"+"+ZS,Eo+"+"+eC,dC,D2].join("|"),"g"),N2=RegExp("["+mC+Pu+iC+sC+cC+"]"),P2=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,F2={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},L2=typeof global=="object"&&global&&global.Object===Object&&global,B2=typeof self=="object"&&self&&self.Object===Object&&self,V2=L2||B2||Function("return this")();function q2(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function U2(n){return n.split("")}function z2(n){return n.match(y2)||[]}function j2(n){return function(e){return n?.[e]}}var G2=j2(F2);function wC(n){return N2.test(n)}function H2(n){return P2.test(n)}function W2(n){return wC(n)?$2(n):U2(n)}function $2(n){return n.match(O2)||[]}function K2(n){return n.match(M2)||[]}var Q2=Object.prototype,Y2=Q2.toString,tC=V2.Symbol,nC=tC?tC.prototype:void 0,rC=nC?nC.toString:void 0;function J2(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function X2(n){if(typeof n=="string")return n;if(rF(n))return rC?rC.call(n):"";var e=n+"";return e=="0"&&1/n==-m2?"-0":e}function Z2(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:J2(n,e,t)}function eF(n){return function(e){e=Fu(e);var t=wC(e)?W2(e):void 0,r=t?t[0]:e.charAt(0),i=t?Z2(t,1).join(""):e.slice(1);return r[n]()+i}}function tF(n){return function(e){return q2(lF(oF(e).replace(R2,"")),n,"")}}function nF(n){return!!n&&typeof n=="object"}function rF(n){return typeof n=="symbol"||nF(n)&&Y2.call(n)==g2}function Fu(n){return n==null?"":X2(n)}var iF=tF(function(n,e,t){return e=e.toLowerCase(),n+(t?sF(e):e)});function sF(n){return aF(Fu(n).toLowerCase())}function oF(n){return n=Fu(n),n&&n.replace(v2,G2).replace(x2,"")}var aF=eF("toUpperCase");function lF(n,e,t){return n=Fu(n),e=t?void 0:e,e===void 0?H2(n)?K2(n):z2(n):n.match(e)||[]}bC.exports=iF});var jm=F((HW,SC)=>{"use strict";SC.exports=cF;function cF(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(p){if(s)if(s=!1,p)l(p);else{for(var m=new Array(arguments.length-1),y=0;y<m.length;)m[y++]=arguments[y];a.apply(null,m)}};try{n.apply(e||null,t)}catch(d){s&&(s=!1,l(d))}})}});var AC=F(TC=>{"use strict";var Lu=TC;Lu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var To=new Array(64),EC=new Array(123);for(kn=0;kn<64;)EC[To[kn]=kn<26?kn+65:kn<52?kn+71:kn<62?kn-4:kn-59|43]=kn++;var kn;Lu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var d=e[t++];switch(a){case 0:s[o++]=To[d>>2],l=(d&3)<<4,a=1;break;case 1:s[o++]=To[l|d>>4],l=(d&15)<<2,a=2;break;case 2:s[o++]=To[l|d>>6],s[o++]=To[d&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=To[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var CC="invalid encoding";Lu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=EC[l])===void 0)throw Error(CC);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(CC);return r-i};Lu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var DC=F(($W,IC)=>{"use strict";IC.exports=Bu;function Bu(){this._listeners={}}Bu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Bu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Bu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var PC=F((KW,NC)=>{"use strict";NC.exports=kC(kC);function kC(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,d,p){e[0]=l,d[p]=t[0],d[p+1]=t[1],d[p+2]=t[2],d[p+3]=t[3]}function s(l,d,p){e[0]=l,d[p]=t[3],d[p+1]=t[2],d[p+2]=t[1],d[p+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,d){return t[0]=l[d],t[1]=l[d+1],t[2]=l[d+2],t[3]=l[d+3],e[0]}function a(l,d){return t[3]=l[d],t[2]=l[d+1],t[1]=l[d+2],t[0]=l[d+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),d=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|d)>>>0,s,o)}}n.writeFloatLE=e.bind(null,RC),n.writeFloatBE=e.bind(null,xC);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,d=o&8388607;return l===255?d?NaN:a*(1/0):l===0?a*1401298464324817e-60*d:a*Math.pow(2,l-150)*(d+8388608)}n.readFloatLE=t.bind(null,OC),n.readFloatBE=t.bind(null,MC)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,d,p){e[0]=l,d[p]=t[0],d[p+1]=t[1],d[p+2]=t[2],d[p+3]=t[3],d[p+4]=t[4],d[p+5]=t[5],d[p+6]=t[6],d[p+7]=t[7]}function s(l,d,p){e[0]=l,d[p]=t[7],d[p+1]=t[6],d[p+2]=t[5],d[p+3]=t[4],d[p+4]=t[3],d[p+5]=t[2],d[p+6]=t[1],d[p+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,d){return t[0]=l[d],t[1]=l[d+1],t[2]=l[d+2],t[3]=l[d+3],t[4]=l[d+4],t[5]=l[d+5],t[6]=l[d+6],t[7]=l[d+7],e[0]}function a(l,d){return t[7]=l[d],t[6]=l[d+1],t[5]=l[d+2],t[4]=l[d+3],t[3]=l[d+4],t[2]=l[d+5],t[1]=l[d+6],t[0]=l[d+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var d=o<0?1:0;if(d&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((d<<31|2146435072)>>>0,a,l+s);else{var p;if(o<22250738585072014e-324)p=o/5e-324,r(p>>>0,a,l+i),r((d<<31|p/4294967296)>>>0,a,l+s);else{var m=Math.floor(Math.log(o)/Math.LN2);m===1024&&(m=1023),p=o*Math.pow(2,-m),r(p*4503599627370496>>>0,a,l+i),r((d<<31|m+1023<<20|p*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,RC,0,4),n.writeDoubleBE=e.bind(null,xC,4,0);function t(r,i,s,o,a){var l=r(o,a+i),d=r(o,a+s),p=(d>>31)*2+1,m=d>>>20&2047,y=4294967296*(d&1048575)+l;return m===2047?y?NaN:p*(1/0):m===0?p*5e-324*y:p*Math.pow(2,m-1075)*(y+4503599627370496)}n.readDoubleLE=t.bind(null,OC,0,4),n.readDoubleBE=t.bind(null,MC,4,0)}(),n}function RC(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function xC(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function OC(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function MC(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Gm=F((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var LC=F(FC=>{"use strict";var Hm=FC;Hm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Hm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Hm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var VC=F((YW,BC)=>{"use strict";BC.exports=uF;function uF(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var d=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),d}}});var UC=F((JW,qC)=>{"use strict";qC.exports=_t;var fl=nr();function _t(n,e){this.lo=n>>>0,this.hi=e>>>0}var as=_t.zero=new _t(0,0);as.toNumber=function(){return 0};as.zzEncode=as.zzDecode=function(){return this};as.length=function(){return 1};var dF=_t.zeroHash="\0\0\0\0\0\0\0\0";_t.fromNumber=function(e){if(e===0)return as;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new _t(r,i)};_t.from=function(e){if(typeof e=="number")return _t.fromNumber(e);if(fl.isString(e))if(fl.Long)e=fl.Long.fromString(e);else return _t.fromNumber(parseInt(e,10));return e.low||e.high?new _t(e.low>>>0,e.high>>>0):as};_t.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};_t.prototype.toLong=function(e){return fl.Long?new fl.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var ai=String.prototype.charCodeAt;_t.fromHash=function(e){return e===dF?as:new _t((ai.call(e,0)|ai.call(e,1)<<8|ai.call(e,2)<<16|ai.call(e,3)<<24)>>>0,(ai.call(e,4)|ai.call(e,5)<<8|ai.call(e,6)<<16|ai.call(e,7)<<24)>>>0)};_t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};_t.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};_t.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};_t.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var nr=F(Wm=>{"use strict";var ne=Wm;ne.asPromise=jm();ne.base64=AC();ne.EventEmitter=DC();ne.float=PC();ne.inquire=Gm();ne.utf8=LC();ne.pool=VC();ne.LongBits=UC();ne.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);ne.global=ne.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Wm;ne.emptyArray=Object.freeze?Object.freeze([]):[];ne.emptyObject=Object.freeze?Object.freeze({}):{};ne.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};ne.isString=function(e){return typeof e=="string"||e instanceof String};ne.isObject=function(e){return e&&typeof e=="object"};ne.isset=ne.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};ne.Buffer=function(){try{var n=ne.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();ne._Buffer_from=null;ne._Buffer_allocUnsafe=null;ne.newBuffer=function(e){return typeof e=="number"?ne.Buffer?ne._Buffer_allocUnsafe(e):new ne.Array(e):ne.Buffer?ne._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};ne.Array=typeof Uint8Array<"u"?Uint8Array:Array;ne.Long=ne.global.dcodeIO&&ne.global.dcodeIO.Long||ne.global.Long||ne.inquire("long");ne.key2Re=/^true|false|0|1$/;ne.key32Re=/^-?(?:0|[1-9][0-9]*)$/;ne.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;ne.longToHash=function(e){return e?ne.LongBits.from(e).toHash():ne.LongBits.zeroHash};ne.longFromHash=function(e,t){var r=ne.LongBits.fromHash(e);return ne.Long?ne.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function zC(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}ne.merge=zC;ne.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function jC(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&zC(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}ne.newError=jC;ne.ProtocolError=jC("ProtocolError");ne.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};ne.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};ne.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};ne._configure=function(){var n=ne.Buffer;if(!n){ne._Buffer_from=ne._Buffer_allocUnsafe=null;return}ne._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},ne._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var qu=F((ZW,$C)=>{"use strict";$C.exports=_e;var gn=nr(),$m,Vu=gn.LongBits,GC=gn.base64,HC=gn.utf8;function pl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Qm(){}function hF(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function _e(){this.len=0,this.head=new pl(Qm,0,0),this.tail=this.head,this.states=null}var WC=function(){return gn.Buffer?function(){return(_e.create=function(){return new $m})()}:function(){return new _e}};_e.create=WC();_e.alloc=function(e){return new gn.Array(e)};gn.Array!==Array&&(_e.alloc=gn.pool(_e.alloc,gn.Array.prototype.subarray));_e.prototype._push=function(e,t,r){return this.tail=this.tail.next=new pl(e,t,r),this.len+=t,this};function Ym(n,e,t){e[t]=n&255}function fF(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Jm(n,e){this.len=n,this.next=void 0,this.val=e}Jm.prototype=Object.create(pl.prototype);Jm.prototype.fn=fF;_e.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Jm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};_e.prototype.int32=function(e){return e<0?this._push(Xm,10,Vu.fromNumber(e)):this.uint32(e)};_e.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Xm(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}_e.prototype.uint64=function(e){var t=Vu.from(e);return this._push(Xm,t.length(),t)};_e.prototype.int64=_e.prototype.uint64;_e.prototype.sint64=function(e){var t=Vu.from(e).zzEncode();return this._push(Xm,t.length(),t)};_e.prototype.bool=function(e){return this._push(Ym,1,e?1:0)};function Km(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}_e.prototype.fixed32=function(e){return this._push(Km,4,e>>>0)};_e.prototype.sfixed32=_e.prototype.fixed32;_e.prototype.fixed64=function(e){var t=Vu.from(e);return this._push(Km,4,t.lo)._push(Km,4,t.hi)};_e.prototype.sfixed64=_e.prototype.fixed64;_e.prototype.float=function(e){return this._push(gn.float.writeFloatLE,4,e)};_e.prototype.double=function(e){return this._push(gn.float.writeDoubleLE,8,e)};var pF=gn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};_e.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Ym,1,0);if(gn.isString(e)){var r=_e.alloc(t=GC.length(e));GC.decode(e,r,0),e=r}return this.uint32(t)._push(pF,t,e)};_e.prototype.string=function(e){var t=HC.length(e);return t?this.uint32(t)._push(HC.write,t,e):this._push(Ym,1,0)};_e.prototype.fork=function(){return this.states=new hF(this),this.head=this.tail=new pl(Qm,0,0),this.len=0,this};_e.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new pl(Qm,0,0),this.len=0),this};_e.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};_e.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};_e._configure=function(n){$m=n,_e.create=WC(),$m._configure()}});var YC=F((e$,QC)=>{"use strict";QC.exports=rr;var KC=qu();(rr.prototype=Object.create(KC.prototype)).constructor=rr;var li=nr();function rr(){KC.call(this)}rr._configure=function(){rr.alloc=li._Buffer_allocUnsafe,rr.writeBytesBuffer=li.Buffer&&li.Buffer.prototype instanceof Uint8Array&&li.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};rr.prototype.bytes=function(e){li.isString(e)&&(e=li._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(rr.writeBytesBuffer,t,e),this};function mF(n,e,t){n.length<40?li.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}rr.prototype.string=function(e){var t=li.Buffer.byteLength(e);return this.uint32(t),t&&this._push(mF,t,e),this};rr._configure()});var zu=F((t$,tE)=>{"use strict";tE.exports=st;var Rn=nr(),eg,ZC=Rn.LongBits,gF=Rn.utf8;function xn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function st(n){this.buf=n,this.pos=0,this.len=n.length}var JC=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new st(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new st(e);throw Error("illegal buffer")},eE=function(){return Rn.Buffer?function(t){return(st.create=function(i){return Rn.Buffer.isBuffer(i)?new eg(i):JC(i)})(t)}:JC};st.create=eE();st.prototype._slice=Rn.Array.prototype.subarray||Rn.Array.prototype.slice;st.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,xn(this,10);return e}}();st.prototype.int32=function(){return this.uint32()|0};st.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Zm(){var n=new ZC(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw xn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw xn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}st.prototype.bool=function(){return this.uint32()!==0};function Uu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}st.prototype.fixed32=function(){if(this.pos+4>this.len)throw xn(this,4);return Uu(this.buf,this.pos+=4)};st.prototype.sfixed32=function(){if(this.pos+4>this.len)throw xn(this,4);return Uu(this.buf,this.pos+=4)|0};function XC(){if(this.pos+8>this.len)throw xn(this,8);return new ZC(Uu(this.buf,this.pos+=4),Uu(this.buf,this.pos+=4))}st.prototype.float=function(){if(this.pos+4>this.len)throw xn(this,4);var e=Rn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};st.prototype.double=function(){if(this.pos+8>this.len)throw xn(this,4);var e=Rn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};st.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw xn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Rn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};st.prototype.string=function(){var e=this.bytes();return gF.read(e,0,e.length)};st.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw xn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw xn(this);while(this.buf[this.pos++]&128);return this};st.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};st._configure=function(n){eg=n,st.create=eE(),eg._configure();var e=Rn.Long?"toLong":"toNumber";Rn.merge(st.prototype,{int64:function(){return Zm.call(this)[e](!1)},uint64:function(){return Zm.call(this)[e](!0)},sint64:function(){return Zm.call(this).zzDecode()[e](!1)},fixed64:function(){return XC.call(this)[e](!0)},sfixed64:function(){return XC.call(this)[e](!1)}})}});var sE=F((n$,iE)=>{"use strict";iE.exports=ls;var rE=zu();(ls.prototype=Object.create(rE.prototype)).constructor=ls;var nE=nr();function ls(n){rE.call(this,n)}ls._configure=function(){nE.Buffer&&(ls.prototype._slice=nE.Buffer.prototype.slice)};ls.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};ls._configure()});var aE=F((r$,oE)=>{"use strict";oE.exports=ml;var tg=nr();(ml.prototype=Object.create(tg.EventEmitter.prototype)).constructor=ml;function ml(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");tg.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}ml.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return tg.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,d){if(l)return o.emit("error",l,e),s(l);if(d===null){o.end(!0);return}if(!(d instanceof r))try{d=r[o.responseDelimited?"decodeDelimited":"decode"](d)}catch(p){return o.emit("error",p,e),s(p)}return o.emit("data",d,e),s(null,d)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};ml.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ng=F(lE=>{"use strict";var yF=lE;yF.Service=aE()});var rg=F((s$,cE)=>{"use strict";cE.exports={}});var hE=F(dE=>{"use strict";var Xt=dE;Xt.build="minimal";Xt.Writer=qu();Xt.BufferWriter=YC();Xt.Reader=zu();Xt.BufferReader=sE();Xt.util=nr();Xt.rpc=ng();Xt.roots=rg();Xt.configure=uE;function uE(){Xt.util._configure(),Xt.Writer._configure(Xt.BufferWriter),Xt.Reader._configure(Xt.BufferReader)}uE()});var pE=F((a$,fE)=>{"use strict";fE.exports=ig;function ig(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(ig.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),d=new Array(a.length),p=0;p<a.length;)l[p]=a[p],d[p]=s[a[p++]];return l[p]=o,Function.apply(null,l).apply(null,d)}return Function(o)()}for(var m=new Array(arguments.length-1),y=0;y<m.length;)m[y]=arguments[++y];if(y=0,s=s.replace(/%([%dfijs])/g,function(x,O){var k=m[y++];switch(O){case"d":case"f":return String(Number(k));case"i":return String(Math.floor(k));case"j":return JSON.stringify(k);case"s":return String(k)}return"%"}),y!==m.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}ig.verbose=!1});var gE=F((l$,mE)=>{"use strict";mE.exports=gl;var vF=jm(),wF=Gm(),sg=wF("fs");function gl(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&sg&&sg.readFile?sg.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?gl.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):gl.xhr(n,e,t):vF(gl,this,n,e)}gl.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var wE=F(vE=>{"use strict";var ag=vE,yE=ag.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},og=ag.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=yE(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};ag.resolve=function(e,t,r){return r||(t=og(t)),yE(t)?t:(r||(e=og(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?og(e+"/"+t):t)}});var cs=F(bE=>{"use strict";var yl=bE,bF=St(),_F=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function vl(n,e){var t=0,r={};for(e|=0;t<n.length;)r[_F[t+e]]=n[t++];return r}yl.basic=vl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);yl.defaults=vl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",bF.emptyArray,null]);yl.long=vl([0,0,0,1,1],7);yl.mapKey=vl([0,0,0,5,5,0,0,0,1,1,0,2],2);yl.packed=vl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ci=F((d$,CE)=>{"use strict";CE.exports=yn;var ju=us();((yn.prototype=Object.create(ju.prototype)).constructor=yn).className="Field";var _E=On(),SE=cs(),ut=St(),lg,SF=/^required|optional|repeated$/;yn.fromJSON=function(e,t){return new yn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function yn(n,e,t,r,i,s,o){if(ut.isObject(r)?(o=i,s=r,r=i=void 0):ut.isObject(i)&&(o=s,s=i,i=void 0),ju.call(this,n,s),!ut.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ut.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!SF.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ut.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ut.Long?SE.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(yn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});yn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),ju.prototype.setOption.call(this,e,t,r)};yn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ut.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};yn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=SE.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof lg?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof _E&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof _E))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ut.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ut.base64.test(this.typeDefault)?ut.base64.decode(this.typeDefault,e=ut.newBuffer(ut.base64.length(this.typeDefault)),0):ut.utf8.write(this.typeDefault,e=ut.newBuffer(ut.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ut.emptyObject:this.repeated?this.defaultValue=ut.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof lg&&(this.parent.ctor.prototype[this.name]=this.defaultValue),ju.prototype.resolve.call(this)};yn.d=function(e,t,r,i){return typeof t=="function"?t=ut.decorateType(t).name:t&&typeof t=="object"&&(t=ut.decorateEnum(t).name),function(o,a){ut.decorateType(o.constructor).add(new yn(a,e,t,r,{default:i}))}};yn._configure=function(e){lg=e}});var Ao=F((h$,AE)=>{"use strict";AE.exports=vn;var Hu=us();((vn.prototype=Object.create(Hu.prototype)).constructor=vn).className="OneOf";var EE=ci(),Gu=St();function vn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Hu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}vn.fromJSON=function(e,t){return new vn(e,t.oneof,t.options,t.comment)};vn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Gu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function TE(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}vn.prototype.add=function(e){if(!(e instanceof EE))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,TE(this),this};vn.prototype.remove=function(e){if(!(e instanceof EE))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};vn.prototype.onAdd=function(e){Hu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}TE(this)};vn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Hu.prototype.onRemove.call(this,e)};vn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Gu.decorateType(i.constructor).add(new vn(s,e)),Object.defineProperty(i,s,{get:Gu.oneOfGetter(e),set:Gu.oneOfSetter(e)})}}});var ko=F((f$,RE)=>{"use strict";RE.exports=Se;var cg=us();((Se.prototype=Object.create(cg.prototype)).constructor=Se).className="Namespace";var IE=ci(),Wu=St(),CF=Ao(),Io,wl,Do;Se.fromJSON=function(e,t){return new Se(e,t.options).addJSON(t.nested)};function DE(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}Se.arrayToJSON=DE;Se.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};Se.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function Se(n,e){cg.call(this,n,e),this.nested=void 0,this._nestedArray=null}function kE(n){return n._nestedArray=null,n}Object.defineProperty(Se.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Wu.toArray(this.nested))}});Se.prototype.toJSON=function(e){return Wu.toObject(["options",this.options,"nested",DE(this.nestedArray,e)])};Se.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Io.fromJSON:s.values!==void 0?Do.fromJSON:s.methods!==void 0?wl.fromJSON:s.id!==void 0?IE.fromJSON:Se.fromJSON)(r[i],s));return this};Se.prototype.get=function(e){return this.nested&&this.nested[e]||null};Se.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Do)return this.nested[e].values;throw Error("no such enum: "+e)};Se.prototype.add=function(e){if(!(e instanceof IE&&e.extend!==void 0||e instanceof Io||e instanceof CF||e instanceof Do||e instanceof wl||e instanceof Se))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof Se&&e instanceof Se&&!(t instanceof Io||t instanceof wl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),kE(this)};Se.prototype.remove=function(e){if(!(e instanceof cg))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),kE(this)};Se.prototype.define=function(e,t){if(Wu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof Se))throw Error("path conflicts with non-namespace objects")}else r.add(r=new Se(i))}return t&&r.addJSON(t),r};Se.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof Se?e[t++].resolveAll():e[t++].resolve();return this.resolve()};Se.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Wu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof Se&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof Se&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};Se.prototype.lookupType=function(e){var t=this.lookup(e,[Io]);if(!t)throw Error("no such type: "+e);return t};Se.prototype.lookupEnum=function(e){var t=this.lookup(e,[Do]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};Se.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Io,Do]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};Se.prototype.lookupService=function(e){var t=this.lookup(e,[wl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};Se._configure=function(n,e,t){Io=n,wl=e,Do=t}});var $u=F((p$,xE)=>{"use strict";xE.exports=Ir;var ug=ci();((Ir.prototype=Object.create(ug.prototype)).constructor=Ir).className="MapField";var EF=cs(),bl=St();function Ir(n,e,t,r,i,s){if(ug.call(this,n,e,r,void 0,void 0,i,s),!bl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Ir.fromJSON=function(e,t){return new Ir(e,t.id,t.keyType,t.type,t.options,t.comment)};Ir.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return bl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Ir.prototype.resolve=function(){if(this.resolved)return this;if(EF.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return ug.prototype.resolve.call(this)};Ir.d=function(e,t,r){return typeof r=="function"?r=bl.decorateType(r).name:r&&typeof r=="object"&&(r=bl.decorateEnum(r).name),function(s,o){bl.decorateType(s.constructor).add(new Ir(o,e,t,r))}}});var Ku=F((m$,OE)=>{"use strict";OE.exports=ds;var dg=us();((ds.prototype=Object.create(dg.prototype)).constructor=ds).className="Method";var Ro=St();function ds(n,e,t,r,i,s,o,a,l){if(Ro.isObject(i)?(o=i,i=s=void 0):Ro.isObject(s)&&(o=s,s=void 0),!(e===void 0||Ro.isString(e)))throw TypeError("type must be a string");if(!Ro.isString(t))throw TypeError("requestType must be a string");if(!Ro.isString(r))throw TypeError("responseType must be a string");dg.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ds.fromJSON=function(e,t){return new ds(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ds.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ro.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ds.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),dg.prototype.resolve.call(this))}});var Qu=F((g$,NE)=>{"use strict";NE.exports=wn;var ui=ko();((wn.prototype=Object.create(ui.prototype)).constructor=wn).className="Service";var hg=Ku(),_l=St(),TF=ng();function wn(n,e){ui.call(this,n,e),this.methods={},this._methodsArray=null}wn.fromJSON=function(e,t){var r=new wn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(hg.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};wn.prototype.toJSON=function(e){var t=ui.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return _l.toObject(["options",t&&t.options||void 0,"methods",ui.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(wn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=_l.toArray(this.methods))}});function ME(n){return n._methodsArray=null,n}wn.prototype.get=function(e){return this.methods[e]||ui.prototype.get.call(this,e)};wn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return ui.prototype.resolve.call(this)};wn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof hg?(this.methods[e.name]=e,e.parent=this,ME(this)):ui.prototype.add.call(this,e)};wn.prototype.remove=function(e){if(e instanceof hg){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,ME(this)}return ui.prototype.remove.call(this,e)};wn.prototype.create=function(e,t,r){for(var i=new TF.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=_l.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=_l.codegen(["r","c"],_l.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Yu=F((y$,PE)=>{"use strict";PE.exports=ir;var AF=nr();function ir(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}ir.create=function(e){return this.$type.create(e)};ir.encode=function(e,t){return this.$type.encode(e,t)};ir.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};ir.decode=function(e){return this.$type.decode(e)};ir.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};ir.verify=function(e){return this.$type.verify(e)};ir.fromObject=function(e){return this.$type.fromObject(e)};ir.toObject=function(e,t){return this.$type.toObject(e,t)};ir.prototype.toJSON=function(){return this.$type.toObject(this,AF.toJSONOptions)}});var fg=F((v$,LE)=>{"use strict";LE.exports=kF;var IF=On(),Dr=cs(),FE=St();function DF(n){return"missing required '"+n.name+"'"}function kF(n){var e=FE.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof IF?"int32":r.type,s="m"+FE.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Dr.defaults[r.keyType]!==void 0?e("k=%j",Dr.defaults[r.keyType]):e("k=null"),Dr.defaults[i]!==void 0?e("value=%j",Dr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Dr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Dr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Dr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Dr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Dr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",DF(o))}return e("return m")}});var gg=F((w$,BE)=>{"use strict";BE.exports=OF;var RF=On(),pg=St();function bn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function mg(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof RF){n("switch(%s){",r)("default:")("return%j",bn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",bn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",bn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",bn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",bn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",bn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",bn(e,"buffer"));break}return n}function xF(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",bn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",bn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",bn(e,"boolean key"));break}return n}function OF(n){var e=pg.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+pg.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",bn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),xF(e,s,"k[i]"),mg(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",bn(s,"array"))("for(var i=0;i<%s.length;++i){",o),mg(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=pg.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}mg(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var wg=F(qE=>{"use strict";var VE=qE,Sl=On(),sr=St();function yg(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Sl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}VE.fromObject=function(e){var t=e.fieldsArray,r=sr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=sr.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),yg(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),yg(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Sl||r("if(d%s!=null){",o),yg(r,s,i,o),s.resolvedType instanceof Sl||r("}"))}return r("return m")};function vg(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Sl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}VE.toObject=function(e){var t=e.fieldsArray.slice().sort(sr.compareFieldsById);if(!t.length)return sr.codegen()("return {}");for(var r=sr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",sr.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",sr.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],d=sr.safeProp(l.name);if(l.resolvedType instanceof Sl)r("d%s=o.enums===String?%j:%j",d,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var p="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",d,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,l.typeDefault)}r("}")}var m=!1;for(a=0;a<t.length;++a){var l=t[a],y=e._fieldsArray.indexOf(l),d=sr.safeProp(l.name);l.map?(m||(m=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),vg(r,l,y,d+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),vg(r,l,y,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,l.name),vg(r,l,y,d),l.partOf&&r("if(o.oneofs)")("d%s=%j",sr.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var bg=F(UE=>{"use strict";var MF=UE,NF=Yu();MF[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof NF){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Zu=F((S$,jE)=>{"use strict";jE.exports=Ne;var Mn=ko();((Ne.prototype=Object.create(Mn.prototype)).constructor=Ne).className="Type";var PF=On(),Cg=Ao(),Ju=ci(),FF=$u(),LF=Qu(),_g=Yu(),Sg=zu(),BF=qu(),Ot=St(),VF=Eg(),qF=fg(),UF=gg(),zE=wg(),zF=bg();function Ne(n,e){Mn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Ne.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ot.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ot.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Ne.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof _g||((n.prototype=new _g).constructor=n,Ot.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ot.merge(n,_g,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Ot.oneOfGetter(this._oneofsArray[t].oneof),set:Ot.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Ne.generateConstructor=function(e){for(var t=Ot.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Ot.safeProp(i.name)):i.repeated&&t("this%s=[]",Ot.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Xu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Ne.fromJSON=function(e,t){var r=new Ne(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?FF.fromJSON:Ju.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Cg.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Ju.fromJSON:o.fields!==void 0?Ne.fromJSON:o.values!==void 0?PF.fromJSON:o.methods!==void 0?LF.fromJSON:Mn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Ne.prototype.toJSON=function(e){var t=Mn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ot.toObject(["options",t&&t.options||void 0,"oneofs",Mn.arrayToJSON(this.oneofsArray,e),"fields",Mn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Ne.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return Mn.prototype.resolveAll.call(this)};Ne.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Ne.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Ju&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Xu(this)}return e instanceof Cg?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Xu(this)):Mn.prototype.add.call(this,e)};Ne.prototype.remove=function(e){if(e instanceof Ju&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Xu(this)}if(e instanceof Cg){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Xu(this)}return Mn.prototype.remove.call(this,e)};Ne.prototype.isReservedId=function(e){return Mn.isReservedId(this.reserved,e)};Ne.prototype.isReservedName=function(e){return Mn.isReservedName(this.reserved,e)};Ne.prototype.create=function(e){return new this.ctor(e)};Ne.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=VF(this)({Writer:BF,types:t,util:Ot}),this.decode=qF(this)({Reader:Sg,types:t,util:Ot}),this.verify=UF(this)({types:t,util:Ot}),this.fromObject=zE.fromObject(this)({types:t,util:Ot}),this.toObject=zE.toObject(this)({types:t,util:Ot});var i=zF[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Ne.prototype.encode=function(e,t){return this.setup().encode(e,t)};Ne.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Ne.prototype.decode=function(e,t){return this.setup().decode(e,t)};Ne.prototype.decodeDelimited=function(e){return e instanceof Sg||(e=Sg.create(e)),this.decode(e,e.uint32())};Ne.prototype.verify=function(e){return this.setup().verify(e)};Ne.prototype.fromObject=function(e){return this.setup().fromObject(e)};Ne.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Ne.d=function(e){return function(r){Ot.decorateType(r,e)}}});var nd=F((C$,KE)=>{"use strict";KE.exports=sn;var td=ko();((sn.prototype=Object.create(td.prototype)).constructor=sn).className="Root";var Ag=ci(),HE=On(),jF=Ao(),di=St(),WE,Tg,Cl;function sn(n){td.call(this,"",n),this.deferred=[],this.files=[]}sn.fromJSON=function(e,t){return t||(t=new sn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};sn.prototype.resolvePath=di.path.resolve;sn.prototype.fetch=di.fetch;function $E(){}sn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return di.asPromise(n,i,e,t);var s=r===$E;function o(C,x){if(r){if(s)throw C;var O=r;r=null,O(C,x)}}function a(C){var x=C.lastIndexOf("google/protobuf/");if(x>-1){var O=C.substring(x);if(O in Cl)return O}return null}function l(C,x){try{if(di.isString(x)&&x.charAt(0)==="{"&&(x=JSON.parse(x)),!di.isString(x))i.setOptions(x.options).addJSON(x.nested);else{Tg.filename=C;var O=Tg(x,i,t),k,q=0;if(O.imports)for(;q<O.imports.length;++q)(k=a(O.imports[q])||i.resolvePath(C,O.imports[q]))&&d(k);if(O.weakImports)for(q=0;q<O.weakImports.length;++q)(k=a(O.weakImports[q])||i.resolvePath(C,O.weakImports[q]))&&d(k,!0)}}catch(P){o(P)}!s&&!p&&o(null,i)}function d(C,x){if(C=a(C)||C,!(i.files.indexOf(C)>-1)){if(i.files.push(C),C in Cl){s?l(C,Cl[C]):(++p,setTimeout(function(){--p,l(C,Cl[C])}));return}if(s){var O;try{O=di.fs.readFileSync(C).toString("utf8")}catch(k){x||o(k);return}l(C,O)}else++p,i.fetch(C,function(k,q){if(--p,!!r){if(k){x?p||o(null,i):o(k);return}l(C,q)}})}}var p=0;di.isString(e)&&(e=[e]);for(var m=0,y;m<e.length;++m)(y=i.resolvePath("",e[m]))&&d(y);if(s)return i;p||o(null,i)};sn.prototype.loadSync=function(e,t){if(!di.isNode)throw Error("not supported");return this.load(e,t,$E)};sn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return td.prototype.resolveAll.call(this)};var ed=/^[A-Z]/;function GE(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Ag(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}sn.prototype._handleAdd=function(e){if(e instanceof Ag)e.extend!==void 0&&!e.extensionField&&(GE(this,e)||this.deferred.push(e));else if(e instanceof HE)ed.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof jF)){if(e instanceof WE)for(var t=0;t<this.deferred.length;)GE(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);ed.test(e.name)&&(e.parent[e.name]=e)}};sn.prototype._handleRemove=function(e){if(e instanceof Ag){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof HE)ed.test(e.name)&&delete e.parent[e.name];else if(e instanceof td){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);ed.test(e.name)&&delete e.parent[e.name]}};sn._configure=function(n,e,t){WE=n,Tg=e,Cl=t}});var St=F((E$,YE)=>{"use strict";var ot=YE.exports=nr(),QE=rg(),Ig,Dg;ot.codegen=pE();ot.fetch=gE();ot.path=wE();ot.fs=ot.inquire("fs");ot.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ot.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var GF=/\\/g,HF=/"/g;ot.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ot.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ot.isReserved(e)?'["'+e.replace(GF,"\\\\").replace(HF,'\\"')+'"]':"."+e};ot.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var WF=/_([a-z])/g;ot.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(WF,function(t,r){return r.toUpperCase()})};ot.compareFieldsById=function(e,t){return e.id-t.id};ot.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ot.decorateRoot.remove(e.$type),e.$type.name=t,ot.decorateRoot.add(e.$type)),e.$type;Ig||(Ig=Zu());var r=new Ig(t||e.name);return ot.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var $F=0;ot.decorateEnum=function(e){if(e.$type)return e.$type;Dg||(Dg=On());var t=new Dg("Enum"+$F++,e);return ot.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ot.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var d=s[l];d&&(a=[].concat(d).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(ot,"decorateRoot",{get:function(){return QE.decorated||(QE.decorated=new(nd()))}})});var us=F((T$,JE)=>{"use strict";JE.exports=on;on.className="ReflectionObject";var rd=St(),id;function on(n,e){if(!rd.isString(n))throw TypeError("name must be a string");if(e&&!rd.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(on.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});on.prototype.toJSON=function(){throw Error()};on.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof id&&t._handleAdd(this)};on.prototype.onRemove=function(e){var t=e.root;t instanceof id&&t._handleRemove(this),this.parent=null,this.resolved=!1};on.prototype.resolve=function(){return this.resolved?this:(this.root instanceof id&&(this.resolved=!0),this)};on.prototype.getOption=function(e){if(this.options)return this.options[e]};on.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};on.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];rd.setProperty(o,r,t)}else s={},s[e]=rd.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};on.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};on.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};on._configure=function(n){id=n}});var On=F((A$,eT)=>{"use strict";eT.exports=or;var XE=us();((or.prototype=Object.create(XE.prototype)).constructor=or).className="Enum";var ZE=ko(),sd=St();function or(n,e,t,r,i,s){if(XE.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}or.fromJSON=function(e,t){var r=new or(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};or.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return sd.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};or.prototype.add=function(e,t,r,i){if(!sd.isString(e))throw TypeError("name must be a string");if(!sd.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};or.prototype.remove=function(e){if(!sd.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};or.prototype.isReservedId=function(e){return ZE.isReservedId(this.reserved,e)};or.prototype.isReservedName=function(e){return ZE.isReservedName(this.reserved,e)}});var Eg=F((I$,nT)=>{"use strict";nT.exports=QF;var KF=On(),kg=cs(),Rg=St();function tT(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function QF(n){for(var e=Rg.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Rg.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof KF?"int32":s.type,l=kg.basic[a];r="m"+Rg.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|kg.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&kg.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?tT(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?tT(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var iT=F((D$,rT)=>{"use strict";var ye=rT.exports=hE();ye.build="light";function YF(n,e,t){return typeof e=="function"?(t=e,e=new ye.Root):e||(e=new ye.Root),e.load(n,t)}ye.load=YF;function JF(n,e){return e||(e=new ye.Root),e.loadSync(n)}ye.loadSync=JF;ye.encoder=Eg();ye.decoder=fg();ye.verifier=gg();ye.converter=wg();ye.ReflectionObject=us();ye.Namespace=ko();ye.Root=nd();ye.Enum=On();ye.Type=Zu();ye.Field=ci();ye.OneOf=Ao();ye.MapField=$u();ye.Service=Qu();ye.Method=Ku();ye.Message=Yu();ye.wrappers=bg();ye.types=cs();ye.util=St();ye.ReflectionObject._configure(ye.Root);ye.Namespace._configure(ye.Type,ye.Service,ye.Enum);ye.Root._configure(ye.Type);ye.Field._configure(ye.Type)});var Og=F((k$,aT)=>{"use strict";aT.exports=oT;var xg=/[\s{}=;:[\],'"()<>]/g,XF=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,ZF=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,eL=/^ *[*/]+ */,tL=/^\s*\*?\/*/,nL=/\n/g,rL=/\s/,iL=/\\(.?)/g,sL={0:"\0",r:"\r",n:`
`,t:"	"};function sT(n){return n.replace(iL,function(e,t){switch(t){case"\\":case"":return t;default:return sL[t]||""}})}oT.unescape=sT;function oT(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function d(j){return Error("illegal "+j+" (line "+i+")")}function p(){var j=l==="'"?ZF:XF;j.lastIndex=t-1;var Y=j.exec(n);if(!Y)throw d("string");return t=j.lastIndex,k(l),l=null,sT(Y[1])}function m(j){return n.charAt(j)}function y(j,Y,ie){var T={type:n.charAt(j++),lineEmpty:!1,leading:ie},_;e?_=2:_=3;var S=j-_,E;do if(--S<0||(E=n.charAt(S))===`
`){T.lineEmpty=!0;break}while(E===" "||E==="	");for(var w=n.substring(j,Y).split(nL),A=0;A<w.length;++A)w[A]=w[A].replace(e?tL:eL,"").trim();T.text=w.join(`
`).trim(),o[i]=T,s=i}function C(j){var Y=x(j),ie=n.substring(j,Y),T=/^\s*\/\//.test(ie);return T}function x(j){for(var Y=j;Y<r&&m(Y)!==`
`;)Y++;return Y}function O(){if(a.length>0)return a.shift();if(l)return p();var j,Y,ie,T,_,S=t===0;do{if(t===r)return null;for(j=!1;rL.test(ie=m(t));)if(ie===`
`&&(S=!0,++i),++t===r)return null;if(m(t)==="/"){if(++t===r)throw d("comment");if(m(t)==="/")if(e){if(T=t,_=!1,C(t-1)){_=!0;do if(t=x(t),t===r||(t++,!S))break;while(C(t))}else t=Math.min(r,x(t)+1);_&&(y(T,t,S),S=!0),i++,j=!0}else{for(_=m(T=t+1)==="/";m(++t)!==`
`;)if(t===r)return null;++t,_&&(y(T,t-1,S),S=!0),++i,j=!0}else if((ie=m(t))==="*"){T=t+1,_=e||m(T)==="*";do{if(ie===`
`&&++i,++t===r)throw d("comment");Y=ie,ie=m(t)}while(Y!=="*"||ie!=="/");++t,_&&(y(T,t-2,S),S=!0),j=!0}else return"/"}}while(j);var E=t;xg.lastIndex=0;var w=xg.test(m(E++));if(!w)for(;E<r&&!xg.test(m(E));)++E;var A=n.substring(t,t=E);return(A==='"'||A==="'")&&(l=A),A}function k(j){a.push(j)}function q(){if(!a.length){var j=O();if(j===null)return null;k(j)}return a[0]}function P(j,Y){var ie=q(),T=ie===j;if(T)return O(),!0;if(!Y)throw d("token '"+ie+"', '"+j+"' expected");return!1}function U(j){var Y=null,ie;return j===void 0?(ie=o[i-1],delete o[i-1],ie&&(e||ie.type==="*"||ie.lineEmpty)&&(Y=ie.leading?ie.text:null)):(s<j&&q(),ie=o[j],delete o[j],ie&&!ie.lineEmpty&&(e||ie.type==="/")&&(Y=ie.leading?null:ie.text)),Y}return Object.defineProperty({next:O,peek:q,push:k,skip:P,cmnt:U},"line",{get:function(){return i}})}});var fT=F((R$,hT)=>{"use strict";hT.exports=kr;kr.filename=null;kr.defaults={keepCase:!1};var oL=Og(),lT=nd(),cT=Zu(),uT=ci(),aL=$u(),dT=Ao(),lL=On(),cL=Qu(),uL=Ku(),Mg=cs(),Ng=St(),dL=/^[1-9][0-9]*$/,hL=/^-?[1-9][0-9]*$/,fL=/^0[x][0-9a-fA-F]+$/,pL=/^-?0[x][0-9a-fA-F]+$/,mL=/^0[0-7]+$/,gL=/^-?0[0-7]+$/,yL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ar=/^[a-zA-Z_][a-zA-Z_0-9]*$/,lr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,vL=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function kr(n,e,t){e instanceof lT||(t=e,e=new lT),t||(t=kr.defaults);var r=t.preferTrailingComment||!1,i=oL(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,d=i.cmnt,p=!0,m,y,C,x,O=!1,k=e,q=t.keepCase?function(B){return B}:Ng.camelCase;function P(B,V,G){var ee=kr.filename;return G||(kr.filename=null),Error("illegal "+(V||"token")+" '"+B+"' ("+(ee?ee+", ":"")+"line "+i.line+")")}function U(){var B=[],V;do{if((V=s())!=='"'&&V!=="'")throw P(V);B.push(s()),l(V),V=a()}while(V==='"'||V==="'");return B.join("")}function j(B){var V=s();switch(V){case"'":case'"':return o(V),U();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return ie(V,!0)}catch{if(B&&lr.test(V))return V;throw P(V,"value")}}function Y(B,V){var G,ee;do V&&((G=a())==='"'||G==="'")?B.push(U()):B.push([ee=T(s()),l("to",!0)?T(s()):ee]);while(l(",",!0));var X={options:void 0};X.setOption=function(se,Re){this.options===void 0&&(this.options={}),this.options[se]=Re},A(X,function(Re){if(Re==="option")Ae(X,Re),l(";");else throw P(Re)},function(){Ye(X)})}function ie(B,V){var G=1;switch(B.charAt(0)==="-"&&(G=-1,B=B.substring(1)),B){case"inf":case"INF":case"Inf":return G*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(dL.test(B))return G*parseInt(B,10);if(fL.test(B))return G*parseInt(B,16);if(mL.test(B))return G*parseInt(B,8);if(yL.test(B))return G*parseFloat(B);throw P(B,"number",V)}function T(B,V){switch(B){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!V&&B.charAt(0)==="-")throw P(B,"id");if(hL.test(B))return parseInt(B,10);if(pL.test(B))return parseInt(B,16);if(gL.test(B))return parseInt(B,8);throw P(B,"id")}function _(){if(m!==void 0)throw P("package");if(m=s(),!lr.test(m))throw P(m,"name");k=k.define(m),l(";")}function S(){var B=a(),V;switch(B){case"weak":V=C||(C=[]),s();break;case"public":s();default:V=y||(y=[]);break}B=U(),l(";"),V.push(B)}function E(){if(l("="),x=U(),O=x==="proto3",!O&&x!=="proto2")throw P(x,"syntax");l(";")}function w(B,V){switch(V){case"option":return Ae(B,V),l(";"),!0;case"message":return g(B,V),!0;case"enum":return Ee(B,V),!0;case"service":return Ge(B,V),!0;case"extend":return nt(B,V),!0}return!1}function A(B,V,G){var ee=i.line;if(B&&(typeof B.comment!="string"&&(B.comment=d()),B.filename=kr.filename),l("{",!0)){for(var X;(X=s())!=="}";)V(X);l(";",!0)}else G&&G(),l(";"),B&&(typeof B.comment!="string"||r)&&(B.comment=d(ee)||B.comment)}function g(B,V){if(!ar.test(V=s()))throw P(V,"type name");var G=new cT(V);A(G,function(X){if(!w(G,X))switch(X){case"map":me(G,X);break;case"required":case"repeated":v(G,X);break;case"optional":O?v(G,"proto3_optional"):v(G,"optional");break;case"oneof":Z(G,X);break;case"extensions":Y(G.extensions||(G.extensions=[]));break;case"reserved":Y(G.reserved||(G.reserved=[]),!0);break;default:if(!O||!lr.test(X))throw P(X);o(X),v(G,"optional");break}}),B.add(G)}function v(B,V,G){var ee=s();if(ee==="group"){H(B,V);return}for(;ee.endsWith(".")||a().startsWith(".");)ee+=s();if(!lr.test(ee))throw P(ee,"type");var X=s();if(!ar.test(X))throw P(X,"name");X=q(X),l("=");var se=new uT(X,T(s()),ee,V,G);if(A(se,function(mt){if(mt==="option")Ae(se,mt),l(";");else throw P(mt)},function(){Ye(se)}),V==="proto3_optional"){var Re=new dT("_"+X);se.setOption("proto3_optional",!0),Re.add(se),B.add(Re)}else B.add(se);!O&&se.repeated&&(Mg.packed[ee]!==void 0||Mg.basic[ee]===void 0)&&se.setOption("packed",!1,!0)}function H(B,V){var G=s();if(!ar.test(G))throw P(G,"name");var ee=Ng.lcFirst(G);G===ee&&(G=Ng.ucFirst(G)),l("=");var X=T(s()),se=new cT(G);se.group=!0;var Re=new uT(ee,X,G,V);Re.filename=kr.filename,A(se,function(mt){switch(mt){case"option":Ae(se,mt),l(";");break;case"required":case"repeated":v(se,mt);break;case"optional":O?v(se,"proto3_optional"):v(se,"optional");break;case"message":g(se,mt);break;case"enum":Ee(se,mt);break;default:throw P(mt)}}),B.add(se).add(Re)}function me(B){l("<");var V=s();if(Mg.mapKey[V]===void 0)throw P(V,"type");l(",");var G=s();if(!lr.test(G))throw P(G,"type");l(">");var ee=s();if(!ar.test(ee))throw P(ee,"name");l("=");var X=new aL(q(ee),T(s()),V,G);A(X,function(Re){if(Re==="option")Ae(X,Re),l(";");else throw P(Re)},function(){Ye(X)}),B.add(X)}function Z(B,V){if(!ar.test(V=s()))throw P(V,"name");var G=new dT(q(V));A(G,function(X){X==="option"?(Ae(G,X),l(";")):(o(X),v(G,"optional"))}),B.add(G)}function Ee(B,V){if(!ar.test(V=s()))throw P(V,"name");var G=new lL(V);A(G,function(X){switch(X){case"option":Ae(G,X),l(";");break;case"reserved":Y(G.reserved||(G.reserved=[]),!0);break;default:je(G,X)}}),B.add(G)}function je(B,V){if(!ar.test(V))throw P(V,"name");l("=");var G=T(s(),!0),ee={options:void 0};ee.setOption=function(X,se){this.options===void 0&&(this.options={}),this.options[X]=se},A(ee,function(se){if(se==="option")Ae(ee,se),l(";");else throw P(se)},function(){Ye(ee)}),B.add(V,G,ee.comment,ee.options)}function Ae(B,V){var G=l("(",!0);if(!lr.test(V=s()))throw P(V,"name");var ee=V,X=ee,se;G&&(l(")"),ee="("+ee+")",X=ee,V=a(),vL.test(V)&&(se=V.slice(1),ee+=V,s())),l("=");var Re=It(B,ee);Ve(B,X,Re,se)}function It(B,V){if(l("{",!0)){for(var G={};!l("}",!0);){if(!ar.test(qe=s()))throw P(qe,"name");if(qe===null)throw P(qe,"end of input");var ee,X=qe;if(l(":",!0),a()==="{")ee=It(B,V+"."+qe);else if(a()==="["){ee=[];var se;if(l("[",!0)){do se=j(!0),ee.push(se);while(l(",",!0));l("]"),typeof se<"u"&&D(B,V+"."+qe,se)}}else ee=j(!0),D(B,V+"."+qe,ee);var Re=G[X];Re&&(ee=[].concat(Re).concat(ee)),G[X]=ee,l(",",!0),l(";",!0)}return G}var He=j(!0);return D(B,V,He),He}function D(B,V,G){B.setOption&&B.setOption(V,G)}function Ve(B,V,G,ee){B.setParsedOption&&B.setParsedOption(V,G,ee)}function Ye(B){if(l("[",!0)){do Ae(B,"option");while(l(",",!0));l("]")}return B}function Ge(B,V){if(!ar.test(V=s()))throw P(V,"service name");var G=new cL(V);A(G,function(X){if(!w(G,X))if(X==="rpc")pt(G,X);else throw P(X)}),B.add(G)}function pt(B,V){var G=d(),ee=V;if(!ar.test(V=s()))throw P(V,"name");var X=V,se,Re,He,mt;if(l("("),l("stream",!0)&&(Re=!0),!lr.test(V=s())||(se=V,l(")"),l("returns"),l("("),l("stream",!0)&&(mt=!0),!lr.test(V=s())))throw P(V);He=V,l(")");var wt=new uL(X,ee,se,He,Re,mt);wt.comment=G,A(wt,function(Cr){if(Cr==="option")Ae(wt,Cr),l(";");else throw P(Cr)}),B.add(wt)}function nt(B,V){if(!lr.test(V=s()))throw P(V,"reference");var G=V;A(null,function(X){switch(X){case"required":case"repeated":v(B,X,G);break;case"optional":O?v(B,"proto3_optional",G):v(B,"optional",G);break;default:if(!O||!lr.test(X))throw P(X);o(X),v(B,"optional",G);break}})}for(var qe;(qe=s())!==null;)switch(qe){case"package":if(!p)throw P(qe);_();break;case"import":if(!p)throw P(qe);S();break;case"syntax":if(!p)throw P(qe);E();break;case"option":Ae(k,qe),l(";");break;default:if(w(k,qe)){p=!1;continue}throw P(qe)}return kr.filename=null,{package:m,imports:y,weakImports:C,syntax:x,root:e}}});var gT=F((x$,mT)=>{"use strict";mT.exports=Nn;var wL=/\/|\./;function Nn(n,e){wL.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Nn[n]=e}Nn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var pT;Nn("duration",{Duration:pT={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Nn("timestamp",{Timestamp:pT});Nn("empty",{Empty:{fields:{}}});Nn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Nn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Nn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Nn.get=function(e){return Nn[e]||null}});var vT=F((O$,yT)=>{"use strict";var hi=yT.exports=iT();hi.build="full";hi.tokenize=Og();hi.parse=fT();hi.common=gT();hi.Root._configure(hi.Type,hi.parse,hi.common)});var od=F((M$,wT)=>{"use strict";wT.exports=vT()});var Pg=F((N$,bL)=>{bL.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var ET=F((de,CT)=>{"use strict";var Bt=od();CT.exports=de=Bt.descriptor=Bt.Root.fromJSON(Pg()).lookup(".google.protobuf");var bT=Bt.Namespace,El=Bt.Root,Rr=Bt.Enum,fi=Bt.Type,pi=Bt.Field,_L=Bt.MapField,ad=Bt.OneOf,Tl=Bt.Service,ld=Bt.Method;El.fromDescriptor=function(e){typeof e.length=="number"&&(e=de.FileDescriptorSet.decode(e));var t=new El;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(fi.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Rr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(pi.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Tl.fromDescriptor(r.service[o]));var a=xo(r.options,de.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};El.prototype.toDescriptor=function(e){var t=de.FileDescriptorSet.create();return _T(this,t.file,e),t};function _T(n,e,t){var r=de.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof El||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof fi?r.messageType.push(s.toDescriptor(t)):s instanceof Rr?r.enumType.push(s.toDescriptor()):s instanceof pi?r.extension.push(s.toDescriptor(t)):s instanceof Tl?r.service.push(s.toDescriptor()):s instanceof bT&&_T(s,e,t);r.options=Oo(n.options,de.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var SL=0;fi.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=de.DescriptorProto.decode(e));var r=new fi(e.name.length?e.name:"Type"+SL++,xo(e.options,de.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(ad.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=pi.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(pi.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(fi.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Rr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};fi.prototype.toDescriptor=function(e){var t=de.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof _L){var s=Fg(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Fg(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&ST(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(de.DescriptorProto.create({name:i.typeName,field:[de.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),de.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:de.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof pi?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof fi?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Rr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(de.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(de.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=Oo(this.options,de.MessageOptions),t};var CL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;pi.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=de.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=DL(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new pi(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=xo(e.options,de.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=CL.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return kL(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};pi.prototype.toDescriptor=function(e){var t=de.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Bt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Fg(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?ST(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Oo(this.options,de.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=de.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=de.FieldOptions.create())).packed=!0),t};var EL=0;Rr.fromDescriptor=function(e){typeof e.length=="number"&&(e=de.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Rr(e.name&&e.name.length?e.name:"Enum"+EL++,t,xo(e.options,de.EnumOptions))};Rr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(de.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return de.EnumDescriptorProto.create({name:this.name,value:e,options:Oo(this.options,de.EnumOptions)})};var TL=0;ad.fromDescriptor=function(e){return typeof e.length=="number"&&(e=de.OneofDescriptorProto.decode(e)),new ad(e.name&&e.name.length?e.name:"oneof"+TL++)};ad.prototype.toDescriptor=function(){return de.OneofDescriptorProto.create({name:this.name})};var AL=0;Tl.fromDescriptor=function(e){typeof e.length=="number"&&(e=de.ServiceDescriptorProto.decode(e));var t=new Tl(e.name&&e.name.length?e.name:"Service"+AL++,xo(e.options,de.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(ld.fromDescriptor(e.method[r]));return t};Tl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return de.ServiceDescriptorProto.create({name:this.name,method:e,options:Oo(this.options,de.ServiceOptions)})};var IL=0;ld.fromDescriptor=function(e){return typeof e.length=="number"&&(e=de.MethodDescriptorProto.decode(e)),new ld(e.name&&e.name.length?e.name:"Method"+IL++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,xo(e.options,de.MethodOptions))};ld.prototype.toDescriptor=function(){return de.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Oo(this.options,de.MethodOptions)})};function DL(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function kL(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Fg(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Rr)return 14;if(e instanceof fi)return e.group?10:11;throw Error("illegal type: "+n)}function xo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Rr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(RL(s),o));return t.length?Bt.util.toObject(t):void 0}}function Oo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Bt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Bt.util.toObject(t)):void 0}}function ST(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof El)&&e instanceof bT)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function RL(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var TT=F((P$,xL)=>{xL.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var AT=F((F$,OL)=>{OL.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var IT=F((L$,ML)=>{ML.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var xT=F(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.addCommonProtos=mi.loadProtosWithOptionsSync=mi.loadProtosWithOptions=void 0;var DT=Ie("fs"),kT=Ie("path"),Mo=od();function RT(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(kT.isAbsolute(i))return i;for(let s of e){let o=kT.join(s,i);try{return DT.accessSync(o,DT.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function NL(n,e){return I(this,null,function*(){let t=new Mo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));RT(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}mi.loadProtosWithOptions=NL;function PL(n,e){let t=new Mo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");RT(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}mi.loadProtosWithOptionsSync=PL;function FL(){let n=TT(),e=Pg(),t=AT(),r=IT();Mo.common("api",n.nested.google.nested.protobuf.nested),Mo.common("descriptor",e.nested.google.nested.protobuf.nested),Mo.common("source_context",t.nested.google.nested.protobuf.nested),Mo.common("type",r.nested.google.nested.protobuf.nested)}mi.addCommonProtos=FL});var NT=F((MT,Lg)=>{"use strict";var OT=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(g,v,H){this.low=g|0,this.high=v|0,this.unsigned=!!H}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(g){return(g&&g.__isLong__)===!0}function i(g){var v=Math.clz32(g&-g);return g?31-v:v}t.isLong=r;var s={},o={};function a(g,v){var H,me,Z;return v?(g>>>=0,(Z=0<=g&&g<256)&&(me=o[g],me)?me:(H=d(g,0,!0),Z&&(o[g]=H),H)):(g|=0,(Z=-128<=g&&g<128)&&(me=s[g],me)?me:(H=d(g,g<0?-1:0,!1),Z&&(s[g]=H),H))}t.fromInt=a;function l(g,v){if(isNaN(g))return v?j:U;if(v){if(g<0)return j;if(g>=k)return S}else{if(g<=-q)return E;if(g+1>=q)return _}return g<0?l(-g,v).neg():d(g%O|0,g/O|0,v)}t.fromNumber=l;function d(g,v,H){return new t(g,v,H)}t.fromBits=d;var p=Math.pow;function m(g,v,H){if(g.length===0)throw Error("empty string");if(typeof v=="number"?(H=v,v=!1):v=!!v,g==="NaN"||g==="Infinity"||g==="+Infinity"||g==="-Infinity")return v?j:U;if(H=H||10,H<2||36<H)throw RangeError("radix");var me;if((me=g.indexOf("-"))>0)throw Error("interior hyphen");if(me===0)return m(g.substring(1),v,H).neg();for(var Z=l(p(H,8)),Ee=U,je=0;je<g.length;je+=8){var Ae=Math.min(8,g.length-je),It=parseInt(g.substring(je,je+Ae),H);if(Ae<8){var D=l(p(H,Ae));Ee=Ee.mul(D).add(l(It))}else Ee=Ee.mul(Z),Ee=Ee.add(l(It))}return Ee.unsigned=v,Ee}t.fromString=m;function y(g,v){return typeof g=="number"?l(g,v):typeof g=="string"?m(g,v):d(g.low,g.high,typeof v=="boolean"?v:g.unsigned)}t.fromValue=y;var C=65536,x=1<<24,O=C*C,k=O*O,q=k/2,P=a(x),U=a(0);t.ZERO=U;var j=a(0,!0);t.UZERO=j;var Y=a(1);t.ONE=Y;var ie=a(1,!0);t.UONE=ie;var T=a(-1);t.NEG_ONE=T;var _=d(-1,2147483647,!1);t.MAX_VALUE=_;var S=d(-1,-1,!0);t.MAX_UNSIGNED_VALUE=S;var E=d(0,-2147483648,!1);t.MIN_VALUE=E;var w=t.prototype;w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*O+(this.low>>>0):this.high*O+(this.low>>>0)},w.toString=function(v){if(v=v||10,v<2||36<v)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(E)){var H=l(v),me=this.div(H),Z=me.mul(H).sub(this);return me.toString(v)+Z.toInt().toString(v)}else return"-"+this.neg().toString(v);for(var Ee=l(p(v,6),this.unsigned),je=this,Ae="";;){var It=je.div(Ee),D=je.sub(It.mul(Ee)).toInt()>>>0,Ve=D.toString(v);if(je=It,je.isZero())return Ve+Ae;for(;Ve.length<6;)Ve="0"+Ve;Ae=""+Ve+Ae}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var v=this.high!=0?this.high:this.low,H=31;H>0&&!(v&1<<H);H--);return this.high!=0?H+33:H+1},w.isZero=function(){return this.high===0&&this.low===0},w.eqz=w.isZero,w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return(this.low&1)===1},w.isEven=function(){return(this.low&1)===0},w.equals=function(v){return r(v)||(v=y(v)),this.unsigned!==v.unsigned&&this.high>>>31===1&&v.high>>>31===1?!1:this.high===v.high&&this.low===v.low},w.eq=w.equals,w.notEquals=function(v){return!this.eq(v)},w.neq=w.notEquals,w.ne=w.notEquals,w.lessThan=function(v){return this.comp(v)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(v){return this.comp(v)<=0},w.lte=w.lessThanOrEqual,w.le=w.lessThanOrEqual,w.greaterThan=function(v){return this.comp(v)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(v){return this.comp(v)>=0},w.gte=w.greaterThanOrEqual,w.ge=w.greaterThanOrEqual,w.compare=function(v){if(r(v)||(v=y(v)),this.eq(v))return 0;var H=this.isNegative(),me=v.isNegative();return H&&!me?-1:!H&&me?1:this.unsigned?v.high>>>0>this.high>>>0||v.high===this.high&&v.low>>>0>this.low>>>0?-1:1:this.sub(v).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(Y)},w.neg=w.negate,w.add=function(v){r(v)||(v=y(v));var H=this.high>>>16,me=this.high&65535,Z=this.low>>>16,Ee=this.low&65535,je=v.high>>>16,Ae=v.high&65535,It=v.low>>>16,D=v.low&65535,Ve=0,Ye=0,Ge=0,pt=0;return pt+=Ee+D,Ge+=pt>>>16,pt&=65535,Ge+=Z+It,Ye+=Ge>>>16,Ge&=65535,Ye+=me+Ae,Ve+=Ye>>>16,Ye&=65535,Ve+=H+je,Ve&=65535,d(Ge<<16|pt,Ve<<16|Ye,this.unsigned)},w.subtract=function(v){return r(v)||(v=y(v)),this.add(v.neg())},w.sub=w.subtract,w.multiply=function(v){if(this.isZero())return this;if(r(v)||(v=y(v)),e){var H=e.mul(this.low,this.high,v.low,v.high);return d(H,e.get_high(),this.unsigned)}if(v.isZero())return this.unsigned?j:U;if(this.eq(E))return v.isOdd()?E:U;if(v.eq(E))return this.isOdd()?E:U;if(this.isNegative())return v.isNegative()?this.neg().mul(v.neg()):this.neg().mul(v).neg();if(v.isNegative())return this.mul(v.neg()).neg();if(this.lt(P)&&v.lt(P))return l(this.toNumber()*v.toNumber(),this.unsigned);var me=this.high>>>16,Z=this.high&65535,Ee=this.low>>>16,je=this.low&65535,Ae=v.high>>>16,It=v.high&65535,D=v.low>>>16,Ve=v.low&65535,Ye=0,Ge=0,pt=0,nt=0;return nt+=je*Ve,pt+=nt>>>16,nt&=65535,pt+=Ee*Ve,Ge+=pt>>>16,pt&=65535,pt+=je*D,Ge+=pt>>>16,pt&=65535,Ge+=Z*Ve,Ye+=Ge>>>16,Ge&=65535,Ge+=Ee*D,Ye+=Ge>>>16,Ge&=65535,Ge+=je*It,Ye+=Ge>>>16,Ge&=65535,Ye+=me*Ve+Z*D+Ee*It+je*Ae,Ye&=65535,d(pt<<16|nt,Ye<<16|Ge,this.unsigned)},w.mul=w.multiply,w.divide=function(v){if(r(v)||(v=y(v)),v.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&v.low===-1&&v.high===-1)return this;var H=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,v.low,v.high);return d(H,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?j:U;var me,Z,Ee;if(this.unsigned){if(v.unsigned||(v=v.toUnsigned()),v.gt(this))return j;if(v.gt(this.shru(1)))return ie;Ee=j}else{if(this.eq(E)){if(v.eq(Y)||v.eq(T))return E;if(v.eq(E))return Y;var je=this.shr(1);return me=je.div(v).shl(1),me.eq(U)?v.isNegative()?Y:T:(Z=this.sub(v.mul(me)),Ee=me.add(Z.div(v)),Ee)}else if(v.eq(E))return this.unsigned?j:U;if(this.isNegative())return v.isNegative()?this.neg().div(v.neg()):this.neg().div(v).neg();if(v.isNegative())return this.div(v.neg()).neg();Ee=U}for(Z=this;Z.gte(v);){me=Math.max(1,Math.floor(Z.toNumber()/v.toNumber()));for(var Ae=Math.ceil(Math.log(me)/Math.LN2),It=Ae<=48?1:p(2,Ae-48),D=l(me),Ve=D.mul(v);Ve.isNegative()||Ve.gt(Z);)me-=It,D=l(me,this.unsigned),Ve=D.mul(v);D.isZero()&&(D=Y),Ee=Ee.add(D),Z=Z.sub(Ve)}return Ee},w.div=w.divide,w.modulo=function(v){if(r(v)||(v=y(v)),e){var H=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,v.low,v.high);return d(H,e.get_high(),this.unsigned)}return this.sub(this.div(v).mul(v))},w.mod=w.modulo,w.rem=w.modulo,w.not=function(){return d(~this.low,~this.high,this.unsigned)},w.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},w.clz=w.countLeadingZeros,w.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},w.ctz=w.countTrailingZeros,w.and=function(v){return r(v)||(v=y(v)),d(this.low&v.low,this.high&v.high,this.unsigned)},w.or=function(v){return r(v)||(v=y(v)),d(this.low|v.low,this.high|v.high,this.unsigned)},w.xor=function(v){return r(v)||(v=y(v)),d(this.low^v.low,this.high^v.high,this.unsigned)},w.shiftLeft=function(v){return r(v)&&(v=v.toInt()),(v&=63)===0?this:v<32?d(this.low<<v,this.high<<v|this.low>>>32-v,this.unsigned):d(0,this.low<<v-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(v){return r(v)&&(v=v.toInt()),(v&=63)===0?this:v<32?d(this.low>>>v|this.high<<32-v,this.high>>v,this.unsigned):d(this.high>>v-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(v){return r(v)&&(v=v.toInt()),(v&=63)===0?this:v<32?d(this.low>>>v|this.high<<32-v,this.high>>>v,this.unsigned):v===32?d(this.high,0,this.unsigned):d(this.high>>>v-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.shr_u=w.shiftRightUnsigned,w.rotateLeft=function(v){var H;return r(v)&&(v=v.toInt()),(v&=63)===0?this:v===32?d(this.high,this.low,this.unsigned):v<32?(H=32-v,d(this.low<<v|this.high>>>H,this.high<<v|this.low>>>H,this.unsigned)):(v-=32,H=32-v,d(this.high<<v|this.low>>>H,this.low<<v|this.high>>>H,this.unsigned))},w.rotl=w.rotateLeft,w.rotateRight=function(v){var H;return r(v)&&(v=v.toInt()),(v&=63)===0?this:v===32?d(this.high,this.low,this.unsigned):v<32?(H=32-v,d(this.high<<H|this.low>>>v,this.low<<H|this.high>>>v,this.unsigned)):(v-=32,H=32-v,d(this.low<<H|this.high>>>v,this.high<<H|this.low>>>v,this.unsigned))},w.rotr=w.rotateRight,w.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},w.toBytes=function(v){return v?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var v=this.high,H=this.low;return[H&255,H>>>8&255,H>>>16&255,H>>>24,v&255,v>>>8&255,v>>>16&255,v>>>24]},w.toBytesBE=function(){var v=this.high,H=this.low;return[v>>>24,v>>>16&255,v>>>8&255,v&255,H>>>24,H>>>16&255,H>>>8&255,H&255]},t.fromBytes=function(v,H,me){return me?t.fromBytesLE(v,H):t.fromBytesBE(v,H)},t.fromBytesLE=function(v,H){return new t(v[0]|v[1]<<8|v[2]<<16|v[3]<<24,v[4]|v[5]<<8|v[6]<<16|v[7]<<24,H)},t.fromBytesBE=function(v,H){return new t(v[4]<<24|v[5]<<16|v[6]<<8|v[7],v[0]<<24|v[1]<<16|v[2]<<8|v[3],H)};var A=t;return n.default=A,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return OT}):typeof Lg=="object"&&typeof MT=="object"&&(Lg.exports=OT)});var Ug=F(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.loadFileDescriptorSetFromObject=yt.loadFileDescriptorSetFromBuffer=yt.fromJSON=yt.loadSync=yt.load=yt.IdempotencyLevel=yt.isAnyExtension=yt.Long=void 0;var LL=_C(),cr=od(),Vg=ET(),qg=xT(),BL=NT();yt.Long=BL;function VL(n){return"@type"in n&&typeof n["@type"]=="string"}yt.isAnyExtension=VL;var LT;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(LT=yt.IdempotencyLevel||(yt.IdempotencyLevel={}));var BT={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function qL(n,e){return n===""?e:n+"."+e}function UL(n){return n instanceof cr.Service||n instanceof cr.Type||n instanceof cr.Enum}function zL(n){return n instanceof cr.Namespace||n instanceof cr.Root}function VT(n,e){let t=qL(e,n.name);return UL(n)?[[t,n]]:zL(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>VT(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function PT(n,e){return function(r){return n.toObject(n.decode(r),e)}}function FT(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function jL(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:LT.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function GL(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:FT(i),requestDeserialize:PT(i,t),responseSerialize:FT(s),responseDeserialize:PT(s,t),originalName:LL(n.name),requestType:Bg(i,r),responseType:Bg(s,r),options:jL(n.parsedOptions)}}function HL(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=GL(s,e,t,r);return i}function Bg(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,BT),fileDescriptorProtos:e}}function WL(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,BT),fileDescriptorProtos:e}}function $L(n,e,t,r){if(n instanceof cr.Service)return HL(n,e,t,r);if(n instanceof cr.Type)return Bg(n,r);if(n instanceof cr.Enum)return WL(n,r);throw new Error("Type mismatch in reflection object handling")}function cd(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Vg.FileDescriptorProto.encode(s).finish()));for(let[s,o]of VT(n,""))t[s]=$L(o,s,e,i);return t}function qT(n,e){e=e||{};let t=cr.Root.fromDescriptor(n);return t.resolveAll(),cd(t,e)}function KL(n,e){return(0,qg.loadProtosWithOptions)(n,e).then(t=>cd(t,e))}yt.load=KL;function QL(n,e){let t=(0,qg.loadProtosWithOptionsSync)(n,e);return cd(t,e)}yt.loadSync=QL;function YL(n,e){e=e||{};let t=cr.Root.fromJSON(n);return t.resolveAll(),cd(t,e)}yt.fromJSON=YL;function JL(n,e){let t=Vg.FileDescriptorSet.decode(n);return qT(t,e)}yt.loadFileDescriptorSetFromBuffer=JL;function XL(n,e){let t=Vg.FileDescriptorSet.fromObject(n);return qT(t,e)}yt.loadFileDescriptorSetFromObject=XL;(0,qg.addCommonProtos)()});var hs=F(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.setup=Ue.getChannelzServiceDefinition=Ue.getChannelzHandlers=Ue.unregisterChannelzRef=Ue.registerChannelzSocket=Ue.registerChannelzServer=Ue.registerChannelzSubchannel=Ue.registerChannelzChannel=Ue.ChannelzCallTracker=Ue.ChannelzChildrenTracker=Ue.ChannelzTrace=void 0;var UT=Ie("net"),Al=hn(),Dl=Ce(),ZL=er(),eB=Ru(),tB=Bm();function zg(n){return{channel_id:n.id,name:n.name}}function Wg(n){return{subchannel_id:n.id,name:n.name}}function nB(n){return{server_id:n.id}}function dd(n){return{socket_id:n.id,name:n.name}}var zT=32,jg=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=zT*2&&(this.events=this.events.slice(zT)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:xr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:xr(e.timestamp),channel_ref:e.childChannel?zg(e.childChannel):null,subchannel_ref:e.childSubchannel?Wg(e.childSubchannel):null}))}}};Ue.ChannelzTrace=jg;var Gg=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ue.ChannelzChildrenTracker=Gg;var Hg=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ue.ChannelzCallTracker=Hg;var rB=1;function hd(){return rB++}var Il=[],$g=[],gi=[],Kg=[];function iB(n,e,t){let r=hd(),i={id:r,name:n,kind:"channel"};return t&&(Il[r]={ref:i,getInfo:e}),i}Ue.registerChannelzChannel=iB;function sB(n,e,t){let r=hd(),i={id:r,name:n,kind:"subchannel"};return t&&($g[r]={ref:i,getInfo:e}),i}Ue.registerChannelzSubchannel=sB;function oB(n,e){let t=hd(),r={id:t,kind:"server"};return e&&(gi[t]={ref:r,getInfo:n}),r}Ue.registerChannelzServer=oB;function aB(n,e,t){let r=hd(),i={id:r,name:n,kind:"socket"};return t&&(Kg[r]={ref:i,getInfo:e}),i}Ue.registerChannelzSocket=aB;function lB(n){switch(n.kind){case"channel":delete Il[n.id];return;case"subchannel":delete $g[n.id];return;case"server":delete gi[n.id];return;case"socket":delete Kg[n.id];return}}Ue.unregisterChannelzRef=lB;function cB(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function jT(n){if(n==="")return[];let e=n.split(":").map(r=>cB(r));return[].concat(...e)}function uB(n){if((0,UT.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,UT.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(jT(e)),s=Buffer.from(jT(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function HT(n){switch(n){case Al.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Al.ConnectivityState.IDLE:return{state:"IDLE"};case Al.ConnectivityState.READY:return{state:"READY"};case Al.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Al.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function xr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function WT(n){let e=n.getInfo();return{ref:zg(n.ref),data:{target:e.target,state:HT(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>zg(t)),subchannel_ref:e.children.subchannels.map(t=>Wg(t))}}function dB(n,e){let t=Number.parseInt(n.request.channel_id),r=Il[t];if(r===void 0){e({code:Dl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:WT(r)})}function hB(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Il.length;i++){let s=Il[i];if(s!==void 0&&(r.push(WT(s)),r.length>=t))break}e(null,{channel:r,end:i>=gi.length})}function $T(n){let e=n.getInfo();return{ref:nB(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:xr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>dd(t))}}function fB(n,e){let t=Number.parseInt(n.request.server_id),r=gi[t];if(r===void 0){e({code:Dl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:$T(r)})}function pB(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<gi.length;i++){let s=gi[i];if(s!==void 0&&(r.push($T(s)),r.length>=t))break}e(null,{server:r,end:i>=gi.length})}function mB(n,e){let t=Number.parseInt(n.request.subchannel_id),r=$g[t];if(r===void 0){e({code:Dl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Wg(r.ref),data:{target:i.target,state:HT(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:xr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>dd(o))};e(null,{subchannel:s})}function GT(n){var e;return(0,ZL.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=uB(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function gB(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Kg[a];if(l===void 0){e({code:Dl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let d=l.getInfo(),p=d.security?{model:"tls",tls:{cipher_suite:d.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=d.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=d.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=d.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=d.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,m={ref:dd(l.ref),local:d.localAddress?GT(d.localAddress):null,remote:d.remoteAddress?GT(d.remoteAddress):null,remote_name:(o=d.remoteName)!==null&&o!==void 0?o:void 0,security:p,data:{keep_alives_sent:d.keepAlivesSent,streams_started:d.streamsStarted,streams_succeeded:d.streamsSucceeded,streams_failed:d.streamsFailed,last_local_stream_created_timestamp:xr(d.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:xr(d.lastRemoteStreamCreatedTimestamp),messages_received:d.messagesReceived,messages_sent:d.messagesSent,last_message_received_timestamp:xr(d.lastMessageReceivedTimestamp),last_message_sent_timestamp:xr(d.lastMessageSentTimestamp),local_flow_control_window:d.localFlowControlWindow?{value:d.localFlowControlWindow}:null,remote_flow_control_window:d.remoteFlowControlWindow?{value:d.remoteFlowControlWindow}:null}};e(null,{socket:m})}function yB(n,e){let t=Number.parseInt(n.request.server_id),r=gi[t];if(r===void 0){e({code:Dl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((p,m)=>p.id-m.id),l=[],d=0;for(;d<a.length&&!(a[d].id>=i&&(l.push(dd(a[d])),l.length>=s));d++);e(null,{socket_ref:l,end:d>=a.length})}function KT(){return{GetChannel:dB,GetTopChannels:hB,GetServer:fB,GetServers:pB,GetSubchannel:mB,GetSocket:gB,GetServerSockets:yB}}Ue.getChannelzHandlers=KT;var ud=null;function QT(){if(ud)return ud;let n=Ug().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return ud=(0,tB.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,ud}Ue.getChannelzServiceDefinition=QT;function vB(){(0,eB.registerAdminService)(QT,KT)}Ue.setup=vB});var YT=F(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});pd.Subchannel=void 0;var Pe=hn(),wB=al(),Qg=Ze(),fd=Ce(),bB=rn(),_B=er(),No=hs(),SB="subchannel",CB=~(1<<31),Yg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Pe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new No.ChannelzCallTracker,this.childrenTracker=new No.ChannelzChildrenTracker,this.streamTracker=new No.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new wB.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,_B.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new No.ChannelzTrace,this.channelzRef=(0,No.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Qg.trace(fd.LogVerbosity.DEBUG,SB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Qg.trace(fd.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.CONNECTING):this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,CB);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Pe.ConnectivityState.CONNECTING],Pe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Pe.ConnectivityState.READY],Pe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Qg.log(fd.LogVerbosity.ERROR,`Connection to ${(0,bB.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Pe.ConnectivityState.CONNECTING],Pe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Pe.ConnectivityState[this.connectivityState]+" -> "+Pe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Pe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Pe.ConnectivityState.READY:this.stopBackoff();break;case Pe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Pe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Pe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,No.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Pe.ConnectivityState.CONNECTING,Pe.ConnectivityState.READY],Pe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===fd.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Pe.ConnectivityState.IDLE],Pe.ConnectivityState.CONNECTING)||this.connectivityState===Pe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Pe.ConnectivityState.TRANSIENT_FAILURE],Pe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};pd.Subchannel=Yg});var ey=F(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.setup=wi.DEFAULT_PORT=void 0;var JT=Xn(),ZT=Ie("dns"),eA=Ie("util"),EB=dm(),Jg=Ce(),Xg=Yt(),TB=Ze(),AB=Ce(),yi=rn(),XT=Ie("net"),IB=al(),DB="dns_resolver";function vi(n){TB.trace(AB.LogVerbosity.DEBUG,DB,n)}wi.DEFAULT_PORT=443;var kB=3e4,RB=eA.promisify(ZT.resolveTxt),xB=eA.promisify(ZT.lookup);function OB(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Zg=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,vi("Resolver constructed for target "+(0,yi.uriToString)(e));let a=(0,yi.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,XT.isIPv4)(a.host)||(0,XT.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:wi.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:wi.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Jg.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,yi.uriToString)(this.target)}`,metadata:new Xg.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new IB.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:kB,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(vi("Returning IP address for target "+(0,yi.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)vi("Failed to parse DNS address "+(0,yi.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Jg.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,yi.uriToString)(this.target)}`,metadata:new Xg.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;vi("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=xB(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=OB(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(vi("Resolved addresses for target "+(0,yi.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(vi("Resolution error for target "+(0,yi.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=RB(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,EB.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Jg.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Xg.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?vi('resolution update delayed by "min time between resolutions" rate limit'):vi("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function MB(){(0,JT.registerResolver)("dns",Zg),(0,JT.registerDefaultScheme)("dns")}wi.setup=MB});var ty=F(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.getProxiedConnection=Lo.mapProxyName=void 0;var kl=Ze(),Po=Ce(),NB=Xn(),PB=Ie("http"),FB=Ie("tls"),LB=Ze(),tA=er(),Fo=rn(),BB=Ie("url"),VB=ey(),qB="proxy";function bi(n){LB.trace(Po.LogVerbosity.DEBUG,qB,n)}function UB(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new BB.URL(n)}catch{return(0,kl.log)(Po.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,kl.log)(Po.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,kl.log)(Po.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),bi("Proxy server "+o.address+" set by environment variable "+e),o}function zB(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(bi("No proxy server list set by environment variable "+e),n.split(",")):[]}function jB(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=UB();if(!i.address)return r;let s=(0,Fo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of zB())if(l===o)return bi("Not using proxy for target in no_proxy list: "+(0,Fo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,Fo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Lo.mapProxyName=jB;function GB(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,Fo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,Fo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:VB.DEFAULT_PORT}`,l={method:"CONNECT",path:a},d={Host:a};(0,tA.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(d["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=d;let p=(0,tA.subchannelAddressToString)(n);return bi("Using proxy "+p+" to connect to "+l.path),new Promise((m,y)=>{let C=PB.request(l);C.once("connect",(x,O,k)=>{var q;if(C.removeAllListeners(),O.removeAllListeners(),x.statusCode===200)if(bi("Successfully connected to "+l.path+" through proxy "+p),"secureContext"in t){let P=(0,NB.getDefaultAuthority)(s),U=(0,Fo.splitHostPort)(P),j=(q=U?.host)!==null&&q!==void 0?q:P,Y=FB.connect(Object.assign({host:j,servername:j,socket:O},t),()=>{bi("Successfully established a TLS connection to "+l.path+" through proxy "+p),m({socket:Y,realTarget:s})});Y.on("error",ie=>{bi("Failed to establish a TLS connection to "+l.path+" through proxy "+p+" with error "+ie.message),y()})}else bi("Successfully established a plaintext connection to "+l.path+" through proxy "+p),m({socket:O,realTarget:s});else(0,kl.log)(Po.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+p+" with status "+x.statusCode),y()}),C.once("error",x=>{C.removeAllListeners(),(0,kl.log)(Po.LogVerbosity.ERROR,"Failed to connect to proxy "+p+" with error "+x.message),y()}),C.end()})}Lo.getProxiedConnection=GB});var ry=F(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.StreamDecoder=void 0;var Or=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Or||{}),ny=class{constructor(e){this.maxReadMessageLength=e,this.readState=Or.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Or.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Or.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Or.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Or.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Or.NO_DATA,i.push(s)}}break;case Or.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Or.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};md.StreamDecoder=ny});var nA=F(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.Http2SubchannelCall=void 0;var Mr=Ie("http2"),HB=Ie("os"),De=Ce(),_i=Yt(),WB=ry(),$B=Ze(),KB=Ce(),QB="subchannel_call";function YB(n){for(let[e,t]of Object.entries(HB.constants.errno))if(t===n)return e;return"Unknown system error "+n}var iy=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=De.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:De.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new WB.StreamDecoder(a),e.on("response",(l,d)=>{let p="";for(let m of Object.keys(l))p+="		"+m+": "+l[m]+`
`;switch(this.trace(`Received server headers:
`+p),l[":status"]){case 400:this.mappedStatusCode=De.Status.INTERNAL;break;case 401:this.mappedStatusCode=De.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=De.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=De.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=De.Status.UNAVAILABLE;break;default:this.mappedStatusCode=De.Status.UNKNOWN}if(d&Mr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let m;try{m=_i.Metadata.fromHttp2Headers(l)}catch(y){this.endCall({code:De.Status.UNKNOWN,details:y.message,metadata:new _i.Metadata});return}this.listener.onReceiveMetadata(m)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let d;try{d=this.decoder.write(l)}catch(p){this.cancelWithStatus(De.Status.RESOURCE_EXHAUSTED,p.message);return}for(let p of d)this.trace("parsed message of length "+p.length),this.callEventTracker.addMessageReceived(),this.tryPush(p)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===De.Status.OK)return;let d,p="";switch(e.rstCode){case Mr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;d=De.Status.INTERNAL,p=`Received RST_STREAM with code ${e.rstCode}`;break;case Mr.constants.NGHTTP2_REFUSED_STREAM:d=De.Status.UNAVAILABLE,p="Stream refused by server";break;case Mr.constants.NGHTTP2_CANCEL:d=De.Status.CANCELLED,p="Call cancelled";break;case Mr.constants.NGHTTP2_ENHANCE_YOUR_CALM:d=De.Status.RESOURCE_EXHAUSTED,p="Bandwidth exhausted or memory limit exceeded";break;case Mr.constants.NGHTTP2_INADEQUATE_SECURITY:d=De.Status.PERMISSION_DENIED,p="Protocol not secure enough";break;case Mr.constants.NGHTTP2_INTERNAL_ERROR:d=De.Status.INTERNAL,this.internalError===null?p=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(d=De.Status.UNAVAILABLE,p=this.internalError.message):p=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:d=De.Status.INTERNAL,p=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:d,details:p,metadata:new _i.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+YB(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:De.Status.UNAVAILABLE,details:"Connection dropped",metadata:new _i.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){$B.trace(KB.LogVerbosity.DEBUG,QB,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===De.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==De.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=_i.Metadata.fromHttp2Headers(e)}catch{r=new _i.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===De.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in De.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===De.Status.OK?t=Mr.constants.NGHTTP2_NO_ERROR:t=Mr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new _i.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==De.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=De.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=De.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:De.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new _i.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};gd.Http2SubchannelCall=iy});var sy=F(yd=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});yd.getNextCallNumber=void 0;var JB=0;function XB(){return JB++}yd.getNextCallNumber=XB});var sA=F(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});wd.Http2SubchannelConnector=void 0;var uy=Ie("http2"),rA=Ie("tls"),oy=hs(),Rl=Ce(),ZB=ty(),Vo=Ze(),iA=Xn(),vd=er(),Bo=rn(),eV=Ie("net"),tV=nA(),nV=sy(),ay="transport",rV="transport_flowctrl",iV=$p().version,{HTTP2_HEADER_AUTHORITY:sV,HTTP2_HEADER_CONTENT_TYPE:oV,HTTP2_HEADER_METHOD:aV,HTTP2_HEADER_PATH:lV,HTTP2_HEADER_TE:cV,HTTP2_HEADER_USER_AGENT:uV}=uy.constants,dV=2e4,hV=Buffer.from("too_many_pings","ascii"),ly=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=dV,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new oy.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,vd.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,oy.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${iV}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===uy.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(hV)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Vo.isTracerEnabled(ay)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,vd.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,vd.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let d=i,p=d.getCipher(),m=d.getCertificate(),y=d.getPeerCertificate();a={cipherSuiteStandardName:(e=p.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:p.standardName?null:p.name,localCertificate:m&&"raw"in m?m.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Vo.trace(Rl.LogVerbosity.DEBUG,ay,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Vo.trace(Rl.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Vo.trace(Rl.LogVerbosity.DEBUG,rV,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Vo.trace(Rl.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[sV]=t,o[uV]=this.userAgent,o[oV]="application/grpc",o[aV]="POST",o[lV]=r,o[cV]="trailers";let a;try{a=this.session.request(o)}catch(p){throw this.handleDisconnect(),p}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,d;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var p;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(p=s.addMessageSent)===null||p===void 0||p.call(s)},addMessageReceived:()=>{var p;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(p=s.addMessageReceived)===null||p===void 0||p.call(s)},onCallEnd:p=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,p),this.removeActiveCall(d)},onStreamEnd:p=>{var m;p?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(m=s.onStreamEnd)===null||m===void 0||m.call(s,p)}}):l={addMessageSent:()=>{var p;(p=s.addMessageSent)===null||p===void 0||p.call(s)},addMessageReceived:()=>{var p;(p=s.addMessageReceived)===null||p===void 0||p.call(s)},onCallEnd:p=>{var m;(m=s.onCallEnd)===null||m===void 0||m.call(s,p),this.removeActiveCall(d)},onStreamEnd:p=>{var m;(m=s.onStreamEnd)===null||m===void 0||m.call(s,p)}},d=new tV.Http2SubchannelCall(a,l,i,this,(0,nV.getNextCallNumber)()),this.addActiveCall(d),d}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,oy.unregisterChannelzRef)(this.channelzRef)}},cy=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Vo.trace(Rl.LogVerbosity.DEBUG,ay,(0,Bo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,d;let p;i.realTarget?(p=(0,Bo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Bo.uriToString)(i.realTarget))):(p=null,this.trace("creating HTTP/2 session to "+(0,vd.subchannelAddressToString)(e)));let m=(0,iA.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let C="http://";if("secureContext"in y){if(C="https://",r["grpc.ssl_target_name_override"]){let k=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(q,P)=>(0,rA.checkServerIdentity)(k,P),y.servername=k}else{let k=(d=(l=(0,Bo.splitHostPort)(m))===null||l===void 0?void 0:l.host)!==null&&d!==void 0?d:"localhost";y.servername=k}i.socket&&(y.createConnection=(k,q)=>i.socket)}else y.createConnection=(k,q)=>i.socket?i.socket:eV.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let x=uy.connect(C+m,y);this.session=x;let O="Failed to connect";x.unref(),x.once("connect",()=>{x.removeAllListeners(),s(new ly(x,e,r,p)),this.session=null}),x.once("close",()=>{this.session=null,setImmediate(()=>{o(`${O} (${new Date().toISOString()})`)})}),x.once("error",k=>{O=k.message,this.trace("connection failed with error "+O)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,d)=>(0,rA.checkServerIdentity)(a,d),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,iA.getDefaultAuthority)((i=(0,Bo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Bo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,ZB.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};wd.Http2SubchannelConnector=cy});var oA=F(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.getSubchannelPool=qo.SubchannelPool=void 0;var fV=jS(),pV=YT(),mV=er(),gV=rn(),yV=sA(),vV=1e4,xl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},vV),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,gV.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,mV.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,fV.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new pV.Subchannel(e,t,r,i,new yV.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};qo.SubchannelPool=xl;var wV=new xl;function bV(n){return n?wV:new xl}qo.getSubchannelPool=bV});var hy=F(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.FilterStackFactory=Uo.FilterStack=void 0;var bd=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Uo.FilterStack=bd;var dy=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new bd(this.factories.map(e=>e.createFilter()))}};Uo.FilterStackFactory=dy});var fy=F(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.CompressionAlgorithms=void 0;var aA=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(aA||(_d.CompressionAlgorithms=aA={}))});var my=F(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});Sd.BaseFilter=void 0;var py=class{sendMetadata(e){return I(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return I(this,null,function*(){return e})}receiveMessage(e){return I(this,null,function*(){return e})}receiveTrailers(e){return e}};Sd.BaseFilter=py});var uA=F(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.CompressionFilterFactory=jo.CompressionFilter=void 0;var Cd=Ie("zlib"),cA=fy(),Ed=Ce(),_V=my(),SV=Ze(),CV=n=>typeof n=="number"&&typeof cA.CompressionAlgorithms[n]=="string",zo=class{writeMessage(e,t){return I(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return I(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},fs=class extends zo{compressMessage(e){return I(this,null,function*(){return e})}writeMessage(e,t){return I(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},gy=class extends zo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Cd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Cd.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Ed.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},yy=class extends zo{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{Cd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=Cd.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:Ed.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},vy=class extends zo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function lA(n,e){switch(n){case"identity":return new fs;case"deflate":return new gy(e);case"gzip":return new yy(e);default:return new vy(n)}}var Td=class extends _V.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new fs,this.receiveCompression=new fs,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:Ed.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(CV(s)){let o=cA.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=lA(this.currentCompressionAlgorithm,-1))}else SV.log(Ed.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return I(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=lA(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new fs,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return I(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof fs?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return I(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};jo.CompressionFilter=Td;var wy=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Td(this.options,this.sharedFilterConfig)}};jo.CompressionFilterFactory=wy});var Ad=F(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.deadlineToString=ur.getRelativeTimeout=ur.getDeadlineTimeoutString=ur.minDeadline=void 0;function EV(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}ur.minDeadline=EV;var TV=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function AV(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of TV){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}ur.getDeadlineTimeoutString=AV;var IV=2147483647;function DV(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>IV?1/0:r}ur.getRelativeTimeout=DV;function kV(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}ur.deadlineToString=kV});var Dd=F(Id=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});Id.restrictControlPlaneStatusCode=void 0;var dr=Ce(),RV=[dr.Status.OK,dr.Status.INVALID_ARGUMENT,dr.Status.NOT_FOUND,dr.Status.ALREADY_EXISTS,dr.Status.FAILED_PRECONDITION,dr.Status.ABORTED,dr.Status.OUT_OF_RANGE,dr.Status.DATA_LOSS];function xV(n,e){return RV.includes(n)?{code:dr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${dr.Status[n]} ${e}`}:{code:n,details:e}}Id.restrictControlPlaneStatusCode=xV});var hA=F(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});xd.LoadBalancingCall=void 0;var dA=hn(),kd=Ce(),OV=Ad(),Rd=Yt(),Ol=si(),MV=rn(),NV=Ze(),by=Dd(),PV=Ie("http2"),FV="load_balancing_call",_y=class{constructor(e,t,r,i,s,o,a){var l,d;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let p=this.methodName.split("/"),m="";p.length>=2&&(m=p[1]);let y=(d=(l=(0,MV.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&d!==void 0?d:"localhost";this.serviceUrl=`https://${y}/${m}`}trace(e){NV.trace(kd.LogVerbosity.DEBUG,FV,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Ol.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Ol.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,d,p;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let m=this.metadata.clone();if(m.merge(a),m.get("authorization").length>1&&this.outputStatus({code:kd.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Rd.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==dA.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+dA.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&m.set("grpc-timeout",(0,OV.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(m,this.host,this.methodName,{onReceiveMetadata:y=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(y)},onReceiveMessage:y=>{this.trace("Received message"),this.listener.onReceiveMessage(y)},onReceiveStatus:y=>{this.trace("Received status"),y.rstCode===PV.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(y,"REFUSED"):this.outputStatus(y,"PROCESSED")}})}catch(y){this.trace("Failed to start call on picked subchannel "+i+" with error "+y.message),this.outputStatus({code:kd.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+y.message,metadata:new Rd.Metadata},"NOT_STARTED");return}(d=(l=this.callConfig).onCommitted)===null||d===void 0||d.call(l),(p=r.onCallStarted)===null||p===void 0||p.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:d}=(0,by.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:kd.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:d,metadata:new Rd.Metadata},"PROCESSED")});break;case Ol.PickResultType.DROP:let{code:s,details:o}=(0,by.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Ol.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,by.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Ol.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Rd.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};xd.LoadBalancingCall=_y});var pA=F(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});Md.ResolvingCall=void 0;var Go=Ce(),Od=Ad(),fA=Yt(),LV=Ze(),BV=Dd(),VV="resolving_call",Sy=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Go.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Go.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Go.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Od.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){LV.trace(Go.LogVerbosity.DEBUG,VV,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Od.deadlineToString)(this.deadline));let e=(0,Od.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Go.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Go.Status.OK){let{code:r,details:i}=(0,BV.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new fA.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Od.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new fA.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Md.ResolvingCall=Sy});var mA=F(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.RetryingCall=Si.MessageBufferTracker=Si.RetryThrottler=void 0;var Nd=Ce(),qV=Yt(),UV=Ze(),zV="retrying_call",Ey=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Si.RetryThrottler=Ey;var Ty=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Si.MessageBufferTracker=Ty;var Cy="grpc-previous-rpc-attempts",Ay=class{constructor(e,t,r,i,s,o,a,l,d){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=d,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let p=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(p.initialBackoff.substring(0,p.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){UV.trace(Nd.LogVerbosity.DEBUG,zV,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new qV.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(Nd.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===Nd.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===Nd.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Cy,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Cy,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Cy,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:d=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Si.RetryingCall=Ay});var Fd=F(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.BaseSubchannelWrapper=void 0;var Iy=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Pd.BaseSubchannelWrapper=Iy});var vA=F(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.InternalChannel=void 0;var jV=_u(),GV=zS(),HV=oA(),gA=si(),Ml=Ce(),WV=hy(),$V=uA(),yA=Xn(),Dy=Ze(),KV=ty(),Ld=rn(),hr=hn(),Nl=hs(),QV=hA(),YV=Ad(),JV=pA(),ky=sy(),XV=Dd(),Ry=mA(),ZV=Fd(),eq=2147483647,tq=1e3,nq=30*60*1e3,Bd=new Map,rq=1<<24,iq=1<<20,xy=class extends ZV.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Oy=class{constructor(e,t,r){var i,s,o,a,l,d,p,m;if(this.credentials=t,this.options=r,this.connectivityState=hr.ConnectivityState.IDLE,this.currentPicker=new gA.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Nl.ChannelzCallTracker,this.childrenTracker=new Nl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof jV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let y=(0,Ld.parseUri)(e);if(y===null)throw new Error(`Could not parse target name "${e}"`);let C=(0,yA.mapUriDefaultScheme)(y);if(C===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},eq),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Nl.ChannelzTrace,this.channelzRef=(0,Nl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,yA.getDefaultAuthority)(C);let x=(0,KV.mapProxyName)(C,r);this.target=x.target,this.options=Object.assign({},this.options,x.extraOptions),this.subchannelPool=(0,HV.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Ry.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:rq,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:iq),this.keepaliveTime=(d=r["grpc.keepalive_time_ms"])!==null&&d!==void 0?d:-1,this.idleTimeoutMs=Math.max((p=r["grpc.client_idle_timeout_ms"])!==null&&p!==void 0?p:nq,tq);let O={createSubchannel:(q,P)=>{let U=this.subchannelPool.getOrCreateSubchannel(this.target,q,Object.assign({},this.options,P),this.credentials);U.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",U.getChannelzRef());let j=new xy(U,this);return this.wrappedSubchannels.add(j),j},updateState:(q,P)=>{this.currentPicker=P;let U=this.pickQueue.slice();this.pickQueue=[],U.length>0&&this.callRefTimerUnref();for(let j of U)j.doPick();this.updateState(q)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:q=>{this.channelzEnabled&&this.childrenTracker.refChild(q)},removeChannelzChild:q=>{this.channelzEnabled&&this.childrenTracker.unrefChild(q)}};this.resolvingLoadBalancer=new GV.ResolvingLoadBalancer(this.target,O,r,(q,P)=>{q.retryThrottling?Bd.set(this.getTarget(),new Ry.RetryThrottler(q.retryThrottling.maxTokens,q.retryThrottling.tokenRatio,Bd.get(this.getTarget()))):Bd.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=P,this.currentResolutionError=null,process.nextTick(()=>{let U=this.configSelectionQueue;this.configSelectionQueue=[],U.length>0&&this.callRefTimerUnref();for(let j of U)j.getConfig()})},q=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+q.code+' and details "'+q.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,XV.restrictControlPlaneStatusCode)(q.code,q.details)),{metadata:q.metadata}));let P=this.configSelectionQueue;this.configSelectionQueue=[],P.length>0&&this.callRefTimerUnref();for(let U of P)U.reportResolverError(q)}),this.filterStackFactory=new WV.FilterStackFactory([new $V.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let k=new Error;(0,Dy.trace)(Ml.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((m=k.stack)===null||m===void 0?void 0:m.substring(k.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Dy.trace)(t??Ml.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Ld.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Dy.trace)(Ml.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Ld.uriToString)(this.target)+" "+hr.ConnectivityState[this.connectivityState]+" -> "+hr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+hr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==hr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(hr.ConnectivityState.IDLE),this.currentPicker=new gA.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==hr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Ml.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,ky.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new QV.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,ky.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Ry.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,Bd.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,ky.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,YV.deadlineToString)(t));let a={deadline:t,flags:s??Ml.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new JV.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(d=>{this.onCallEnd(d)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(hr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Nl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Ld.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===hr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===hr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Vd.InternalChannel=Oy});var Fm=F(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.ChannelImplementation=void 0;var sq=_u(),oq=vA(),My=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof sq.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new oq.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};qd.ChannelImplementation=My});var IA=F(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.Http2ServerCallStream=_n.ServerDuplexStreamImpl=_n.ServerWritableStreamImpl=_n.ServerReadableStreamImpl=_n.ServerUnaryCallImpl=void 0;var EA=Ie("events"),Ho=Ie("http2"),Fy=Ie("stream"),wA=Ie("zlib"),Le=Ce(),Ly=Yt(),aq=ry(),TA=Ze(),Fl=mu(),AA="server_call";function Pl(n){TA.trace(Le.LogVerbosity.DEBUG,AA,n)}var lq="grpc-accept-encoding",cq="grpc-encoding",bA="grpc-message",_A="grpc-status",SA="grpc-timeout",uq=/(\d{1,8})\s*([HMSmun])/,dq={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},hq={[lq]:"identity,deflate,gzip",[cq]:"identity"},CA={[Ho.constants.HTTP2_HEADER_STATUS]:Ho.constants.HTTP_STATUS_OK,[Ho.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},fq={waitForTrailers:!0},Ny=class extends EA.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};_n.ServerUnaryCallImpl=Ny;var Ud=class extends Fy.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};_n.ServerReadableStreamImpl=Ud;var Ll=class extends Fy.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Ly.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Fl.getErrorMessage)(i),code:Le.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Le.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};_n.ServerWritableStreamImpl=Ll;var Wo=class extends Fy.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Ly.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};_n.ServerDuplexStreamImpl=Wo;Wo.prototype._read=Ud.prototype._read;Wo.prototype._write=Ll.prototype._write;Wo.prototype._final=Ll.prototype._final;var Py=class extends EA.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Le.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Le.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Pl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Le.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=wA.createInflate():i=wA.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",d=>{l.push(d),a+=d.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Le.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Le.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},CA),hq),t);this.stream.respond(r,fq)}receiveMetadata(e){let t=Ly.Metadata.fromHttp2Headers(e);TA.isTracerEnabled(AA)&&Pl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(SA);if(r.length>0){let i=r[0].toString().match(uq);if(i===null){let a=new Error("Invalid deadline");return a.code=Le.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*dq[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(pq,s,this),t.remove(SA)}return t.remove(Ho.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Ho.constants.HTTP2_HEADER_TE),t.remove(Ho.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",d),this.stream.on("end",p),this.stream.on("error",p);function d(m){if(s+=m.byteLength,l!==-1&&s>l){i.removeListener("data",d),i.removeListener("end",p),i.removeListener("error",p),r({code:Le.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(m)}function p(m){if(i.removeListener("data",d),i.removeListener("end",p),i.removeListener("error",p),m!==void 0){r({code:Le.Status.INTERNAL,details:m.message});return}if(s===0){r({code:Le.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let y=Buffer.concat(a,s),x=y.readUInt8(0)===1?e:"identity",O=o.getDecompressedMessage(y,x);if(Buffer.isBuffer(O)){t(o.deserializeMessageWithInternalError(O));return}O.then(k=>t(o.deserializeMessageWithInternalError(k)),k=>r(k.code?k:{code:Le.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return I(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Fl.getErrorMessage)(t),code:Le.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return I(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Le.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Fl.getErrorMessage)(s),code:Le.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Le.Status.OK),!this.checkCancelled())if(Pl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Le.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[_A]:e.code,[bA]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[_A]:e.code,[bA]:encodeURI(e.details)},CA),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Le.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Le.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new aq.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>I(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>I(this,null,function*(){let d;try{d=r.write(l)}catch(p){this.sendError({code:Le.Status.RESOURCE_EXHAUSTED,details:p.message});return}s=!0,this.stream.pause();for(let p of d){this.emit("receiveMessage");let y=p.readUInt8(0)===1?t:"identity",C;try{C=yield this.getDecompressedMessage(p,y)}catch(x){this.sendError(x);return}if(!C)return;yield this.pushOrBufferMessage(e,C)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>I(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return I(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return I(this,null,function*(){if(t===null){Pl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Pl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Fl.getErrorCode)(r);(i===null||i<Le.Status.OK||i>Le.Status.UNAUTHENTICATED)&&(i=Le.Status.INTERNAL),e.emit("error",{details:(0,Fl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};_n.Http2ServerCallStream=Py;function pq(n){let e=new Error("Deadline exceeded");e.code=Le.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var qy=F(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.ServerCredentials=void 0;var DA=om(),Bl=class{static createInsecure(){return new By}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Vy({ca:e||(0,DA.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:DA.CIPHER_SUITES})}};zd.ServerCredentials=Bl;var By=class extends Bl{_isSecure(){return!1}_getSettings(){return null}},Vy=class extends Bl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var xA=F(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.Server=void 0;var Ci=Ie("http2"),Nr=Ce(),ps=IA(),mq=qy(),kA=Xn(),jd=Ze(),Pn=er(),gq=rn(),Zt=hs(),Gd=~(1<<31),yq=~(1<<31),vq=2e4,{HTTP2_HEADER_PATH:RA}=Ci.constants,wq="server";function bq(){}function Uy(n){return{code:Nr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function _q(n,e){let t=Uy(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var zy=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Zt.ChannelzTrace,this.callTracker=new Zt.ChannelzCallTracker,this.listenerChildrenTracker=new Zt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Zt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Zt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Gd,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Gd,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:yq,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:vq,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Pn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Pn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,d;if(e.encrypted){let m=o,y=m.getCipher(),C=m.getCertificate(),x=m.getPeerCertificate();d={cipherSuiteStandardName:(t=y.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:y.standardName?null:y.name,localCertificate:C&&"raw"in C?C.raw:null,remoteCertificate:x&&"raw"in x?x.raw:null}}else d=null;return{remoteAddress:a,localAddress:l,security:d,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){jd.trace(Nr.LogVerbosity.DEBUG,wq,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=_q(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof mq.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,gq.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,kA.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(C,x)=>{process.nextTick(()=>r(C,x))},l=()=>{let C;if(t._isSecure()){let x=Object.assign(o,t._getSettings());x.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,C=Ci.createSecureServer(x),C.on("secureConnection",O=>{O.on("error",k=>{this.trace("An incoming TLS connection closed with error: "+k.message)})})}else C=Ci.createServer(o);return C.setTimeout(0,bq),this._setupHandlers(C),C},d=(C,x,O)=>C.length===0?Promise.resolve({port:x,count:O}):Promise.all(C.map(k=>{this.trace("Attempting to bind "+(0,Pn.subchannelAddressToString)(k));let q;(0,Pn.isTcpSubchannelAddress)(k)?q={host:k.host,port:x}:q=k;let P=l();return new Promise((U,j)=>{let Y=ie=>{this.trace("Failed to bind "+(0,Pn.subchannelAddressToString)(k)+" with error "+ie.message),U(ie)};P.once("error",Y),P.listen(q,()=>{if(this.shutdown){P.close(),U(new Error("bindAsync failed because server is shutdown"));return}let ie=P.address(),T;typeof ie=="string"?T={path:ie}:T={host:ie.address,port:ie.port};let _=(0,Zt.registerChannelzSocket)((0,Pn.subchannelAddressToString)(T),()=>({localAddress:T,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(_),this.http2ServerList.push({server:P,channelzRef:_}),this.trace("Successfully bound "+(0,Pn.subchannelAddressToString)(T)),U("port"in T?T.port:x),P.removeListener("error",Y)})})})).then(k=>{let q=0;for(let P of k)if(typeof P=="number"&&(q+=1,P!==x))throw new Error("Invalid state: multiple port numbers added from single address");return{port:x,count:q+O}}),p=C=>{if(C.length===0)return Promise.resolve({port:0,count:0});let x=C[0],O=l();return new Promise((k,q)=>{let P=U=>{this.trace("Failed to bind "+(0,Pn.subchannelAddressToString)(x)+" with error "+U.message),k(p(C.slice(1)))};O.once("error",P),O.listen(x,()=>{if(this.shutdown){O.close(),k({port:0,count:0});return}let U=O.address(),j={host:U.address,port:U.port},Y=(0,Zt.registerChannelzSocket)((0,Pn.subchannelAddressToString)(j),()=>({localAddress:j,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Y),this.http2ServerList.push({server:O,channelzRef:Y}),this.trace("Successfully bound "+(0,Pn.subchannelAddressToString)(j)),k(d(C.slice(1),U.port,1)),O.removeListener("error",P)})})},m={onSuccessfulResolution:(C,x,O)=>{if(m.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),C.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let k;(0,Pn.isTcpSubchannelAddress)(C[0])?C[0].port===0?k=p(C):k=d(C,C[0].port,0):k=d(C,1,0),k.then(q=>{if(q.count===0){let P=`No address added out of total ${C.length} resolved`;jd.log(Nr.LogVerbosity.ERROR,P),a(new Error(P),0)}else q.count<C.length&&jd.log(Nr.LogVerbosity.INFO,`WARNING Only ${q.count} addresses added out of total ${C.length} resolved`),a(null,q.port)},q=>{let P=`No address added out of total ${C.length} resolved`;jd.log(Nr.LogVerbosity.ERROR,P),a(new Error(P),0)})},onError:C=>{a(new Error(C.details),0)}};(0,kA.createResolver)(s,m,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Zt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Ci.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Zt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Zt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Zt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Ci.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Ci.constants.HTTP2_HEADER_STATUS]:Ci.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new ps.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Nr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[RA],s=this._retrieveHandler(i);if(!s){this._respondWithError(Uy(i),e,r);return}let o=new ps.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Nr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Nr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[RA],i=this._retrieveHandler(r);if(!i){this._respondWithError(Uy(r),e,null);return}let s=new ps.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Nr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")Sq(e,t,s,o);else if(a==="clientStream")Cq(e,t,s,o);else if(a==="serverStream")Eq(e,t,s,o);else if(a==="bidi")Tq(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,d,p;if(!this.started){s.destroy();return}let m=(0,Zt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),y={ref:m,streamTracker:new Zt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,y);let C=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+C),this.sessionChildrenTracker.refChild(m));let x=null,O=null,k=!1;if(this.maxConnectionAgeMs!==Gd){let P=this.maxConnectionAgeMs/10,U=Math.random()*P*2-P;x=(l=(a=setTimeout(()=>{var j,Y;k=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+C);try{s.goaway(Ci.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Gd&&(O=(Y=(j=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||Y===void 0?void 0:Y.call(j))},this.maxConnectionAgeMs+U)).unref)===null||l===void 0?void 0:l.call(a)}let q=(p=(d=setInterval(()=>{var P,U;let j=(U=(P=setTimeout(()=>{k=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+C),s.close()},this.keepaliveTimeoutMs)).unref)===null||U===void 0?void 0:U.call(P);try{s.ping((Y,ie,T)=>{clearTimeout(j)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||p===void 0?void 0:p.call(d);s.on("close",()=>{this.channelzEnabled&&(k||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+C),this.sessionChildrenTracker.unrefChild(m),(0,Zt.unregisterChannelzRef)(m)),x&&clearTimeout(x),O&&clearTimeout(O),q&&clearTimeout(q),this.sessions.delete(s)})})}};Hd.Server=zy;function Sq(n,e,t,r){return I(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ps.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,d)=>{n.sendUnaryMessage(o,a,l,d)})}catch(i){n.sendError(i)}})}function Cq(n,e,t,r){let i=new ps.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,d){i.destroy(),n.sendUnaryMessage(o,a,l,d)}n.cancelled||(i.on("error",s),e.func(i,s))}function Eq(n,e,t,r){return I(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ps.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function Tq(n,e,t,r){let i=new ps.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var OA=F(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.StatusBuilder=void 0;var jy=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Wd.StatusBuilder=jy});var Gy=F(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.isDuration=Ei.durationToMs=Ei.msToDuration=void 0;function Aq(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}Ei.msToDuration=Aq;function Iq(n){return n.seconds*1e3+n.nanos/1e6|0}Ei.durationToMs=Iq;function Dq(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}Ei.isDuration=Dq});var Xy=F(Ti=>{"use strict";var Hy;Object.defineProperty(Ti,"__esModule",{value:!0});Ti.setup=Ti.OutlierDetectionLoadBalancer=Ti.OutlierDetectionLoadBalancingConfig=void 0;var Kd=hn(),NA=Ce(),ms=Gy(),PA=Zy(),FA=ti(),kq=Du(),Rq=si(),MA=er(),xq=Fd(),Oq=Ze(),Mq="outlier_detection";function Ct(n){Oq.trace(NA.LogVerbosity.DEBUG,Mq,n)}var Jy="outlier_detection",Nq=((Hy=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Hy!==void 0?Hy:"true")==="true",Pq={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},Fq={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function $o(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Wy(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,ms.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function $d(n,e,t){let r=t?`${t}.${e}`:e;if($o(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Vl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},Pq),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},Fq),o):null}getLoadBalancerName(){return Jy}toJsonObject(){return{interval:(0,ms.msToDuration)(this.intervalMs),base_ejection_time:(0,ms.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,ms.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Wy(e,"interval"),Wy(e,"base_ejection_time"),Wy(e,"max_ejection_time"),$d(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");$o(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),$d(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),$o(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),$o(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");$d(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),$d(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),$o(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),$o(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,ms.durationToMs)(e.interval):null,e.base_ejection_time?(0,ms.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,ms.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(FA.validateLoadBalancingConfig))}};Ti.OutlierDetectionLoadBalancingConfig=Vl;var Ky=class extends xq.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Kd.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Kd.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Kd.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function $y(){return{success:0,failure:0}}var Qy=class{constructor(){this.activeBucket=$y(),this.inactiveBucket=$y()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=$y()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Yy=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===Rq.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===NA.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Qd=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new kq.ChildLoadBalancerHandler((0,PA.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,MA.subchannelAddressToString)(t)),o=new Ky(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Kd.ConnectivityState.READY?e.updateState(t,new Yy(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;Ct("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[m,y]of this.addressMap){let C=y.counter.getLastSuccesses(),x=y.counter.getLastFailures();Ct("Stats for "+m+": successes="+C+" failures="+x+" targetRequestVolume="+r),C+x>=r&&(i+=1,s.push(C/(C+x)))}if(Ct("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((m,y)=>m+y)/s.length,a=0;for(let m of s){let y=m-o;a+=y*y}let l=a/s.length,d=Math.sqrt(l),p=o-d*(t.stdev_factor/1e3);Ct("stdev="+d+" ejectionThreshold="+p);for(let[m,y]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let C=y.counter.getLastSuccesses(),x=y.counter.getLastFailures();if(C+x<r)continue;let O=C/(C+x);if(Ct("Checking candidate "+m+" successRate="+O),O<p){let k=Math.random()*100;Ct("Candidate "+m+" randomNumber="+k+" enforcement_percentage="+t.enforcement_percentage),k<t.enforcement_percentage&&(Ct("Ejecting candidate "+m),this.eject(y,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;Ct("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(Ct("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let d=Math.random()*100;Ct("Candidate "+i+" randomNumber="+d+" enforcement_percentage="+t.enforcement_percentage),d<t.enforcement_percentage&&(Ct("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(Ct("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(Ct("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Vl))return;let i=new Set;for(let o of e)i.add((0,MA.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(Ct("Adding map entry for "+o),this.addressMap.set(o,{counter:new Qy,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(Ct("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,FA.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){Ct("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else Ct("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{Ct("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Jy}};Ti.OutlierDetectionLoadBalancer=Qd;function Lq(){Nq&&(0,PA.registerLoadBalancerType)(Jy,Qd,Vl)}Ti.setup=Lq});var Zy=F(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.OutlierDetectionLoadBalancingConfig=oe.BaseSubchannelWrapper=oe.registerAdminService=oe.FilterStackFactory=oe.BaseFilter=oe.PickResultType=oe.QueuePicker=oe.UnavailablePicker=oe.ChildLoadBalancerHandler=oe.subchannelAddressToString=oe.validateLoadBalancingConfig=oe.getFirstUsableConfig=oe.registerLoadBalancerType=oe.createChildChannelControlHelper=oe.BackoffTimeout=oe.durationToMs=oe.uriToString=oe.createResolver=oe.registerResolver=oe.log=oe.trace=void 0;var LA=Ze();Object.defineProperty(oe,"trace",{enumerable:!0,get:function(){return LA.trace}});Object.defineProperty(oe,"log",{enumerable:!0,get:function(){return LA.log}});var BA=Xn();Object.defineProperty(oe,"registerResolver",{enumerable:!0,get:function(){return BA.registerResolver}});Object.defineProperty(oe,"createResolver",{enumerable:!0,get:function(){return BA.createResolver}});var Bq=rn();Object.defineProperty(oe,"uriToString",{enumerable:!0,get:function(){return Bq.uriToString}});var Vq=Gy();Object.defineProperty(oe,"durationToMs",{enumerable:!0,get:function(){return Vq.durationToMs}});var qq=al();Object.defineProperty(oe,"BackoffTimeout",{enumerable:!0,get:function(){return qq.BackoffTimeout}});var Yd=ti();Object.defineProperty(oe,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Yd.createChildChannelControlHelper}});Object.defineProperty(oe,"registerLoadBalancerType",{enumerable:!0,get:function(){return Yd.registerLoadBalancerType}});Object.defineProperty(oe,"getFirstUsableConfig",{enumerable:!0,get:function(){return Yd.getFirstUsableConfig}});Object.defineProperty(oe,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Yd.validateLoadBalancingConfig}});var Uq=er();Object.defineProperty(oe,"subchannelAddressToString",{enumerable:!0,get:function(){return Uq.subchannelAddressToString}});var zq=Du();Object.defineProperty(oe,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return zq.ChildLoadBalancerHandler}});var ev=si();Object.defineProperty(oe,"UnavailablePicker",{enumerable:!0,get:function(){return ev.UnavailablePicker}});Object.defineProperty(oe,"QueuePicker",{enumerable:!0,get:function(){return ev.QueuePicker}});Object.defineProperty(oe,"PickResultType",{enumerable:!0,get:function(){return ev.PickResultType}});var jq=my();Object.defineProperty(oe,"BaseFilter",{enumerable:!0,get:function(){return jq.BaseFilter}});var Gq=hy();Object.defineProperty(oe,"FilterStackFactory",{enumerable:!0,get:function(){return Gq.FilterStackFactory}});var Hq=Ru();Object.defineProperty(oe,"registerAdminService",{enumerable:!0,get:function(){return Hq.registerAdminService}});var Wq=Fd();Object.defineProperty(oe,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return Wq.BaseSubchannelWrapper}});var $q=Xy();Object.defineProperty(oe,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return $q.OutlierDetectionLoadBalancingConfig}})});var VA=F(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.setup=void 0;var Kq=Xn(),tv=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function Qq(){(0,Kq.registerResolver)("unix",tv)}Jd.setup=Qq});var GA=F(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});eh.setup=void 0;var qA=Ie("net"),Xd=Ce(),nv=Yt(),UA=Xn(),zA=rn(),Yq=Ze(),Jq="ip_resolver";function jA(n){Yq.trace(Xd.LogVerbosity.DEBUG,Jq,n)}var rv="ipv4",iv="ipv6",Xq=443,Zd=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,jA("Resolver constructed for target "+(0,zA.uriToString)(e));let s=[];if(!(e.scheme===rv||e.scheme===iv)){this.error={code:Xd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new nv.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,zA.splitHostPort)(a);if(l===null){this.error={code:Xd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new nv.Metadata};return}if(e.scheme===rv&&!(0,qA.isIPv4)(l.host)||e.scheme===iv&&!(0,qA.isIPv6)(l.host)){this.error={code:Xd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new nv.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:Xq})}this.addresses=s,jA("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function Zq(){(0,UA.registerResolver)(rv,Zd),(0,UA.registerResolver)(iv,Zd)}eh.setup=Zq});var $A=F(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.setup=fr.PickFirstLoadBalancer=fr.shuffled=fr.PickFirstLoadBalancingConfig=void 0;var HA=ti(),Mt=hn(),th=si(),eU=Ze(),tU=Ce(),nU="pick_first";function sv(n){eU.trace(tU.LogVerbosity.DEBUG,nU,n)}var ql="pick_first",rU=250,Ul=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return ql}toJsonObject(){return{[ql]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};fr.PickFirstLoadBalancingConfig=Ul;var ov=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:th.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function WA(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}fr.shuffled=WA;var nh=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Mt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Mt.ConnectivityState.READY,new ov(this.currentPick)):this.children.length===0?this.updateState(Mt.ConnectivityState.IDLE,new th.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Mt.ConnectivityState.TRANSIENT_FAILURE,new th.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Mt.ConnectivityState.CONNECTING,new th.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Mt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Mt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Mt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Mt.ConnectivityState.IDLE||i===Mt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Mt.ConnectivityState.IDLE&&(sv("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},rU)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(sv("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){sv(Mt.ConnectivityState[this.currentState]+" -> "+Mt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Mt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Mt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Ul&&(t.getShuffleAddressList()&&(e=WA(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Mt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return ql}};fr.PickFirstLoadBalancer=nh;function iU(){(0,HA.registerLoadBalancerType)(ql,nh,Ul),(0,HA.registerDefaultLoadBalancerType)(ql)}fr.setup=iU});var QA=F(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.setup=Ko.RoundRobinLoadBalancer=void 0;var sU=ti(),Nt=hn(),rh=si(),oU=er(),aU=Ze(),lU=Ce(),cU="round_robin";function KA(n){aU.trace(lU.LogVerbosity.DEBUG,cU,n)}var ih="round_robin",av=class n{getLoadBalancerName(){return ih}constructor(){}toJsonObject(){return{[ih]:{}}}static createFromJson(e){return new n}},lv=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:rh.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},sh=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Nt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Nt.ConnectivityState.TRANSIENT_FAILURE||i===Nt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Nt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Nt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Nt.ConnectivityState.READY,new lv(e,t))}else this.countSubchannelsWithState(Nt.ConnectivityState.CONNECTING)>0?this.updateState(Nt.ConnectivityState.CONNECTING,new rh.QueuePicker(this)):this.countSubchannelsWithState(Nt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Nt.ConnectivityState.TRANSIENT_FAILURE,new rh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Nt.ConnectivityState.IDLE,new rh.QueuePicker(this))}updateState(e,t){KA(Nt.ConnectivityState[this.currentState]+" -> "+Nt.ConnectivityState[e]),e===Nt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),KA("Connect to address list "+e.map(r=>(0,oU.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Nt.ConnectivityState.IDLE||i===Nt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return ih}};Ko.RoundRobinLoadBalancer=sh;function uU(){(0,sU.registerLoadBalancerType)(ih,sh,av)}Ko.setup=uU});var ZA=F(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.experimental=J.addAdminServicesToServer=J.getChannelzHandlers=J.getChannelzServiceDefinition=J.InterceptorConfigurationError=J.InterceptingCall=J.RequesterBuilder=J.ListenerBuilder=J.StatusBuilder=J.getClientChannel=J.ServerCredentials=J.Server=J.setLogVerbosity=J.setLogger=J.load=J.loadObject=J.CallCredentials=J.ChannelCredentials=J.waitForClientReady=J.closeClient=J.Channel=J.makeGenericClientConstructor=J.makeClientConstructor=J.loadPackageDefinition=J.Client=J.compressionAlgorithms=J.propagate=J.connectivityState=J.status=J.logVerbosity=J.Metadata=J.credentials=void 0;var oh=im();Object.defineProperty(J,"CallCredentials",{enumerable:!0,get:function(){return oh.CallCredentials}});var dU=Fm();Object.defineProperty(J,"Channel",{enumerable:!0,get:function(){return dU.ChannelImplementation}});var hU=fy();Object.defineProperty(J,"compressionAlgorithms",{enumerable:!0,get:function(){return hU.CompressionAlgorithms}});var fU=hn();Object.defineProperty(J,"connectivityState",{enumerable:!0,get:function(){return fU.ConnectivityState}});var ah=_u();Object.defineProperty(J,"ChannelCredentials",{enumerable:!0,get:function(){return ah.ChannelCredentials}});var YA=Pm();Object.defineProperty(J,"Client",{enumerable:!0,get:function(){return YA.Client}});var cv=Ce();Object.defineProperty(J,"logVerbosity",{enumerable:!0,get:function(){return cv.LogVerbosity}});Object.defineProperty(J,"status",{enumerable:!0,get:function(){return cv.Status}});Object.defineProperty(J,"propagate",{enumerable:!0,get:function(){return cv.Propagate}});var JA=Ze(),uv=Bm();Object.defineProperty(J,"loadPackageDefinition",{enumerable:!0,get:function(){return uv.loadPackageDefinition}});Object.defineProperty(J,"makeClientConstructor",{enumerable:!0,get:function(){return uv.makeClientConstructor}});Object.defineProperty(J,"makeGenericClientConstructor",{enumerable:!0,get:function(){return uv.makeClientConstructor}});var pU=Yt();Object.defineProperty(J,"Metadata",{enumerable:!0,get:function(){return pU.Metadata}});var mU=xA();Object.defineProperty(J,"Server",{enumerable:!0,get:function(){return mU.Server}});var gU=qy();Object.defineProperty(J,"ServerCredentials",{enumerable:!0,get:function(){return gU.ServerCredentials}});var yU=OA();Object.defineProperty(J,"StatusBuilder",{enumerable:!0,get:function(){return yU.StatusBuilder}});J.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:ah.ChannelCredentials.createInsecure,createSsl:ah.ChannelCredentials.createSsl,createFromSecureContext:ah.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:oh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:oh.CallCredentials.createFromGoogleCredential,createEmpty:oh.CallCredentials.createEmpty};var vU=n=>n.close();J.closeClient=vU;var wU=(n,e,t)=>n.waitForReady(e,t);J.waitForClientReady=wU;var bU=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};J.loadObject=bU;var _U=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};J.load=_U;var SU=n=>{JA.setLogger(n)};J.setLogger=SU;var CU=n=>{JA.setLoggerVerbosity(n)};J.setLogVerbosity=CU;var EU=n=>YA.Client.prototype.getChannel.call(n);J.getClientChannel=EU;var lh=Om();Object.defineProperty(J,"ListenerBuilder",{enumerable:!0,get:function(){return lh.ListenerBuilder}});Object.defineProperty(J,"RequesterBuilder",{enumerable:!0,get:function(){return lh.RequesterBuilder}});Object.defineProperty(J,"InterceptingCall",{enumerable:!0,get:function(){return lh.InterceptingCall}});Object.defineProperty(J,"InterceptorConfigurationError",{enumerable:!0,get:function(){return lh.InterceptorConfigurationError}});var XA=hs();Object.defineProperty(J,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return XA.getChannelzServiceDefinition}});Object.defineProperty(J,"getChannelzHandlers",{enumerable:!0,get:function(){return XA.getChannelzHandlers}});var TU=Ru();Object.defineProperty(J,"addAdminServicesToServer",{enumerable:!0,get:function(){return TU.addAdminServicesToServer}});var AU=Zy();J.experimental=AU;var IU=ey(),DU=VA(),kU=GA(),RU=$A(),xU=QA(),OU=Xy(),MU=hs();IU.setup(),DU.setup(),kU.setup(),RU.setup(),xU.setup(),OU.setup(),MU.setup()});var Lf=Zc(Rp());var FM="firebase",LM="10.12.3";Yr(FM,LM,"app");var so=new Sp("ANGULARFIRE2_VERSION");var BM=(n,e)=>{let t=e?[e]:lS(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},ss=class{constructor(){return BM(VM)}},VM="app-check";function xp(){}var uu=class{zone;delegate;constructor(e,t=P_){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Op=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",xp,{},xp,xp)),t.pipe(q_({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},du=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new uu(Zone.current)),this.insideAngular=t.run(()=>new uu(Zone.current,tu)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(he($r))};static \u0275prov=$n({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function qM(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Qt(n){return UM(qM())(n)}function UM(n){return function(t){return t=t.lift(new Op(n.ngZone)),t.pipe(no(n.outsideAngular),ns(n.insideAngular))}}var GM=new Map,HM={activated:!1,tokenObservers:[]},WM={initialized:!1,enabled:!1};function In(n){return GM.get(n)||Object.assign({},HM)}function pS(){return WM}var $M="https://content-firebaseappcheck.googleapis.com/v1";var KM="exchangeDebugToken",uS={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},MH=24*60*60*1e3;var Np=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return I(this,null,function*(){this.stop();try{this.pending=new Ap,this.pending.promise.catch(t=>{}),yield QM(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ap,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function QM(n){return new Promise(e=>{setTimeout(e,n)})}var YM={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Jr=new oS("appCheck","AppCheck",YM);function mS(n){if(!In(n).activated)throw Jr.create("use-before-activation",{appName:n.name})}function gS(r,i){return I(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let C=yield o.getHeartbeatsHeader();C&&(s["X-Firebase-Client"]=C)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(C){throw Jr.create("fetch-network-error",{originalErrorMessage:C?.message})}if(l.status!==200)throw Jr.create("fetch-status-error",{httpStatus:l.status});let d;try{d=yield l.json()}catch(C){throw Jr.create("fetch-parse-error",{originalErrorMessage:C?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Jr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let m=Number(p[1])*1e3,y=Date.now();return{token:d.token,expireTimeMillis:y+m,issuedAtTimeMillis:y}})}function yS(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${$M}/projects/${t}/apps/${r}:${KM}?key=${i}`,body:{debug_token:e}}}var JM="firebase-app-check-database",XM=1,Pp="firebase-app-check-store";var hu=null;function ZM(){return hu||(hu=new Promise((n,e)=>{try{let t=indexedDB.open(JM,XM);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Jr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Pp,{keyPath:"compositeKey"})}}}catch(t){e(Jr.create("storage-open",{originalErrorMessage:t?.message}))}}),hu)}function eN(n,e){return tN(nN(n),e)}function tN(n,e){return I(this,null,function*(){let r=(yield ZM()).transaction(Pp,"readwrite"),s=r.objectStore(Pp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var d;a(Jr.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})})}function nN(n){return`${n.options.appId}-${n.name}`}var Fp=new cu("@firebase/app-check");function Mp(n,e){return lu()?eN(n,e).catch(t=>{Fp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function vS(){return pS().enabled}function wS(){return I(this,null,function*(){let n=pS();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var rN={error:"UNKNOWN_ERROR"};function iN(n){return rS.encodeString(JSON.stringify(n),!1)}function Lp(n,e=!1){return I(this,null,function*(){let t=n.app;mS(t);let r=In(t),i=r.token,s;if(i&&!sl(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(sl(l)?i=l:yield Mp(t,void 0))}if(!e&&i&&sl(i))return{token:i.token};let o=!1;if(vS()){r.exchangeTokenPromise||(r.exchangeTokenPromise=gS(yS(t,yield wS()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Mp(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield In(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Fp.warn(l.message):Fp.error(l),s=l}let a;return i?s?sl(i)?a={token:i.token,internalError:s}:a=hS(s):(a={token:i.token},r.token=i,yield Mp(t,i)):a=hS(s),o&&lN(t,a),a})}function sN(n){return I(this,null,function*(){let e=n.app;mS(e);let{provider:t}=In(e);if(vS()){let r=yield wS(),{token:i}=yield gS(yS(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function oN(n,e,t,r){let{app:i}=n,s=In(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&sl(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),dS(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>dS(n))}function bS(n,e){let t=In(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function dS(n){let{app:e}=n,t=In(e),r=t.tokenRefresher;r||(r=aN(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function aN(n){let{app:e}=n;return new Np(()=>I(this,null,function*(){let t=In(e),r;if(t.token?r=yield Lp(n,!0):r=yield Lp(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=In(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},uS.RETRIAL_MIN_WAIT,uS.RETRIAL_MAX_WAIT)}function lN(n,e){let t=In(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function sl(n){return n.expireTimeMillis-Date.now()>0}function hS(n){return{token:iN(rN),error:n}}var Bp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=In(this.app);for(let t of e)bS(this.app,t.next);return Promise.resolve()}};function cN(n,e){return new Bp(n,e)}function uN(n){return{getToken:e=>Lp(n,e),getLimitedUseToken:()=>sN(n),addTokenListener:e=>oN(n,"INTERNAL",e),removeTokenListener:e=>bS(n.app,e)}}var dN="@firebase/app-check",hN="0.8.5";var fN="app-check",fS="app-check-internal";function pN(){il(new is(fN,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return cN(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(fS).initialize()})),il(new is(fS,n=>{let e=n.getProvider("app-check").getImmediate();return uN(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Yr(dN,hN)}pN();var mN=["localhost","0.0.0.0","127.0.0.1"],HH=typeof window<"u"&&mN.includes(window.location.hostname);var gN="firebase",yN="10.12.3";Kt.registerVersion(gN,yN,"app-compat");var vN=["ngOnDestroy"],CS=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(vN.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(d=>t.run(()=>d)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,d)=>o.then(p=>{let m=p?.(...d);return r?.spy?.apply&&r.spy.apply(s,d,m),m})})})});var fu=class{constructor(e){return e}},oo=new Xe("angularfire2.app.options"),ao=new Xe("angularfire2.app.name");function ol(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Kt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Kt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;wN("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new fu(o)}var wN=(n,...e)=>{Cp()&&typeof console<"u"&&console[n](...e)},bN={provide:fu,useFactory:ol,deps:[oo,$r,[new U_,ao]]},ES=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:oo,useValue:t},{provide:ao,useValue:r}]}}constructor(t){Kt.registerVersion("angularfire",so.full,"core"),Kt.registerVersion("angularfire",so.full,"app-compat"),Kt.registerVersion("angular",$_.full,t.toString())}static \u0275fac=function(r){return new(r||n)(he(ro))};static \u0275mod=Wt({type:n});static \u0275inj=Ht({providers:[bN]})}return n})();function pu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return _N(i,o)||(SS("error",`${e} was already initialized on the ${t} Firebase App with different settings.${SN?" You may need to reload as Firebase is not HMR aware.":""}`),SS("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function _N(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var SN=typeof module<"u"&&!!module.hot,SS=(n,...e)=>{Cp()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Vp=new Xe("angularfire2.auth.use-emulator"),qp=new Xe("angularfire2.auth.settings"),Up=new Xe("angularfire2.auth.tenant-id"),zp=new Xe("angularfire2.auth.langugage-code"),jp=new Xe("angularfire2.auth.use-device-language"),Gp=new Xe("angularfire.auth.persistence"),Hp=(n,e,t,r,i,s,o,a)=>pu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[d,p]of Object.entries(o))l.settings[d]=p;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),TS=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,d,p,m,y,C){let x=new eu,O=Wr(void 0).pipe(ns(o.outsideAngular),rs(()=>s.runOutsideAngular(()=>import("./chunk-P75IKZQA.mjs"))),Dt(()=>ol(t,s,r)),Dt(k=>Hp(k,s,a,d,p,m,l,y)),hp({bufferSize:1,refCount:!1}));if(au(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Wr(null);else{O.pipe(V_()).subscribe();let k=O.pipe(rs(U=>U.getRedirectResult().then(j=>j,()=>null)),Qt,hp({bufferSize:1,refCount:!1})),q=O.pipe(rs(U=>new to(j=>({unsubscribe:s.runOutsideAngular(()=>U.onAuthStateChanged(Y=>j.next(Y),Y=>j.error(Y),()=>j.complete()))})))),P=O.pipe(rs(U=>new to(j=>({unsubscribe:s.runOutsideAngular(()=>U.onIdTokenChanged(Y=>j.next(Y),Y=>j.error(Y),()=>j.complete()))}))));this.authState=k.pipe(fp(q),no(o.outsideAngular),ns(o.insideAngular)),this.user=k.pipe(fp(P),no(o.outsideAngular),ns(o.insideAngular)),this.idToken=this.user.pipe(rs(U=>U?Wn(U.getIdToken()):Wr(null))),this.idTokenResult=this.user.pipe(rs(U=>U?Wn(U.getIdTokenResult()):Wr(null))),this.credential=L_(k,x,this.authState.pipe(Xa(U=>!U))).pipe(Dt(U=>U?.user?U:null),no(o.outsideAngular),ns(o.insideAngular))}return CS(this,O,s,{spy:{apply:(k,q,P)=>{(k.startsWith("signIn")||k.startsWith("createUser"))&&P.then(U=>x.next(U))}}})}static \u0275fac=function(r){return new(r||n)(he(oo),he(ao,8),he(ro),he($r),he(du),he(Vp,8),he(qp,8),he(Up,8),he(zp,8),he(jp,8),he(Gp,8),he(ss,8))};static \u0275prov=$n({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as NU,TextEncoder as PU,TextDecoder as FU}from"util";import{randomBytes as LU}from"crypto";var AS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},IS={};var Xr,Wp;(function(){var n;function e(T,_){function S(){}S.prototype=_.prototype,T.D=_.prototype,T.prototype=new S,T.prototype.constructor=T,T.C=function(E,w,A){for(var g=Array(arguments.length-2),v=2;v<arguments.length;v++)g[v-2]=arguments[v];return _.prototype[w].apply(E,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,_,S){S||(S=0);var E=Array(16);if(typeof _=="string")for(var w=0;16>w;++w)E[w]=_.charCodeAt(S++)|_.charCodeAt(S++)<<8|_.charCodeAt(S++)<<16|_.charCodeAt(S++)<<24;else for(w=0;16>w;++w)E[w]=_[S++]|_[S++]<<8|_[S++]<<16|_[S++]<<24;_=T.g[0],S=T.g[1],w=T.g[2];var A=T.g[3],g=_+(A^S&(w^A))+E[0]+3614090360&4294967295;_=S+(g<<7&4294967295|g>>>25),g=A+(w^_&(S^w))+E[1]+3905402710&4294967295,A=_+(g<<12&4294967295|g>>>20),g=w+(S^A&(_^S))+E[2]+606105819&4294967295,w=A+(g<<17&4294967295|g>>>15),g=S+(_^w&(A^_))+E[3]+3250441966&4294967295,S=w+(g<<22&4294967295|g>>>10),g=_+(A^S&(w^A))+E[4]+4118548399&4294967295,_=S+(g<<7&4294967295|g>>>25),g=A+(w^_&(S^w))+E[5]+1200080426&4294967295,A=_+(g<<12&4294967295|g>>>20),g=w+(S^A&(_^S))+E[6]+2821735955&4294967295,w=A+(g<<17&4294967295|g>>>15),g=S+(_^w&(A^_))+E[7]+4249261313&4294967295,S=w+(g<<22&4294967295|g>>>10),g=_+(A^S&(w^A))+E[8]+1770035416&4294967295,_=S+(g<<7&4294967295|g>>>25),g=A+(w^_&(S^w))+E[9]+2336552879&4294967295,A=_+(g<<12&4294967295|g>>>20),g=w+(S^A&(_^S))+E[10]+4294925233&4294967295,w=A+(g<<17&4294967295|g>>>15),g=S+(_^w&(A^_))+E[11]+2304563134&4294967295,S=w+(g<<22&4294967295|g>>>10),g=_+(A^S&(w^A))+E[12]+1804603682&4294967295,_=S+(g<<7&4294967295|g>>>25),g=A+(w^_&(S^w))+E[13]+4254626195&4294967295,A=_+(g<<12&4294967295|g>>>20),g=w+(S^A&(_^S))+E[14]+2792965006&4294967295,w=A+(g<<17&4294967295|g>>>15),g=S+(_^w&(A^_))+E[15]+1236535329&4294967295,S=w+(g<<22&4294967295|g>>>10),g=_+(w^A&(S^w))+E[1]+4129170786&4294967295,_=S+(g<<5&4294967295|g>>>27),g=A+(S^w&(_^S))+E[6]+3225465664&4294967295,A=_+(g<<9&4294967295|g>>>23),g=w+(_^S&(A^_))+E[11]+643717713&4294967295,w=A+(g<<14&4294967295|g>>>18),g=S+(A^_&(w^A))+E[0]+3921069994&4294967295,S=w+(g<<20&4294967295|g>>>12),g=_+(w^A&(S^w))+E[5]+3593408605&4294967295,_=S+(g<<5&4294967295|g>>>27),g=A+(S^w&(_^S))+E[10]+38016083&4294967295,A=_+(g<<9&4294967295|g>>>23),g=w+(_^S&(A^_))+E[15]+3634488961&4294967295,w=A+(g<<14&4294967295|g>>>18),g=S+(A^_&(w^A))+E[4]+3889429448&4294967295,S=w+(g<<20&4294967295|g>>>12),g=_+(w^A&(S^w))+E[9]+568446438&4294967295,_=S+(g<<5&4294967295|g>>>27),g=A+(S^w&(_^S))+E[14]+3275163606&4294967295,A=_+(g<<9&4294967295|g>>>23),g=w+(_^S&(A^_))+E[3]+4107603335&4294967295,w=A+(g<<14&4294967295|g>>>18),g=S+(A^_&(w^A))+E[8]+1163531501&4294967295,S=w+(g<<20&4294967295|g>>>12),g=_+(w^A&(S^w))+E[13]+2850285829&4294967295,_=S+(g<<5&4294967295|g>>>27),g=A+(S^w&(_^S))+E[2]+4243563512&4294967295,A=_+(g<<9&4294967295|g>>>23),g=w+(_^S&(A^_))+E[7]+1735328473&4294967295,w=A+(g<<14&4294967295|g>>>18),g=S+(A^_&(w^A))+E[12]+2368359562&4294967295,S=w+(g<<20&4294967295|g>>>12),g=_+(S^w^A)+E[5]+4294588738&4294967295,_=S+(g<<4&4294967295|g>>>28),g=A+(_^S^w)+E[8]+2272392833&4294967295,A=_+(g<<11&4294967295|g>>>21),g=w+(A^_^S)+E[11]+1839030562&4294967295,w=A+(g<<16&4294967295|g>>>16),g=S+(w^A^_)+E[14]+4259657740&4294967295,S=w+(g<<23&4294967295|g>>>9),g=_+(S^w^A)+E[1]+2763975236&4294967295,_=S+(g<<4&4294967295|g>>>28),g=A+(_^S^w)+E[4]+1272893353&4294967295,A=_+(g<<11&4294967295|g>>>21),g=w+(A^_^S)+E[7]+4139469664&4294967295,w=A+(g<<16&4294967295|g>>>16),g=S+(w^A^_)+E[10]+3200236656&4294967295,S=w+(g<<23&4294967295|g>>>9),g=_+(S^w^A)+E[13]+681279174&4294967295,_=S+(g<<4&4294967295|g>>>28),g=A+(_^S^w)+E[0]+3936430074&4294967295,A=_+(g<<11&4294967295|g>>>21),g=w+(A^_^S)+E[3]+3572445317&4294967295,w=A+(g<<16&4294967295|g>>>16),g=S+(w^A^_)+E[6]+76029189&4294967295,S=w+(g<<23&4294967295|g>>>9),g=_+(S^w^A)+E[9]+3654602809&4294967295,_=S+(g<<4&4294967295|g>>>28),g=A+(_^S^w)+E[12]+3873151461&4294967295,A=_+(g<<11&4294967295|g>>>21),g=w+(A^_^S)+E[15]+530742520&4294967295,w=A+(g<<16&4294967295|g>>>16),g=S+(w^A^_)+E[2]+3299628645&4294967295,S=w+(g<<23&4294967295|g>>>9),g=_+(w^(S|~A))+E[0]+4096336452&4294967295,_=S+(g<<6&4294967295|g>>>26),g=A+(S^(_|~w))+E[7]+1126891415&4294967295,A=_+(g<<10&4294967295|g>>>22),g=w+(_^(A|~S))+E[14]+2878612391&4294967295,w=A+(g<<15&4294967295|g>>>17),g=S+(A^(w|~_))+E[5]+4237533241&4294967295,S=w+(g<<21&4294967295|g>>>11),g=_+(w^(S|~A))+E[12]+1700485571&4294967295,_=S+(g<<6&4294967295|g>>>26),g=A+(S^(_|~w))+E[3]+2399980690&4294967295,A=_+(g<<10&4294967295|g>>>22),g=w+(_^(A|~S))+E[10]+4293915773&4294967295,w=A+(g<<15&4294967295|g>>>17),g=S+(A^(w|~_))+E[1]+2240044497&4294967295,S=w+(g<<21&4294967295|g>>>11),g=_+(w^(S|~A))+E[8]+1873313359&4294967295,_=S+(g<<6&4294967295|g>>>26),g=A+(S^(_|~w))+E[15]+4264355552&4294967295,A=_+(g<<10&4294967295|g>>>22),g=w+(_^(A|~S))+E[6]+2734768916&4294967295,w=A+(g<<15&4294967295|g>>>17),g=S+(A^(w|~_))+E[13]+1309151649&4294967295,S=w+(g<<21&4294967295|g>>>11),g=_+(w^(S|~A))+E[4]+4149444226&4294967295,_=S+(g<<6&4294967295|g>>>26),g=A+(S^(_|~w))+E[11]+3174756917&4294967295,A=_+(g<<10&4294967295|g>>>22),g=w+(_^(A|~S))+E[2]+718787259&4294967295,w=A+(g<<15&4294967295|g>>>17),g=S+(A^(w|~_))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(w+(g<<21&4294967295|g>>>11))&4294967295,T.g[2]=T.g[2]+w&4294967295,T.g[3]=T.g[3]+A&4294967295}r.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var S=_-this.blockSize,E=this.B,w=this.h,A=0;A<_;){if(w==0)for(;A<=S;)i(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<_;)if(E[w++]=T.charCodeAt(A++),w==this.blockSize){i(this,E),w=0;break}}else for(;A<_;)if(E[w++]=T[A++],w==this.blockSize){i(this,E),w=0;break}}this.h=w,this.o+=_},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var S=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=S&255,S/=256;for(this.u(T),T=Array(16),_=S=0;4>_;++_)for(var E=0;32>E;E+=8)T[S++]=this.g[_]>>>E&255;return T};function s(T,_){var S=a;return Object.prototype.hasOwnProperty.call(S,T)?S[T]:S[T]=_(T)}function o(T,_){this.h=_;for(var S=[],E=!0,w=T.length-1;0<=w;w--){var A=T[w]|0;E&&A==_||(S[w]=A,E=!1)}this.g=S}var a={};function l(T){return-128<=T&&128>T?s(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return m;if(0>T)return k(d(-T));for(var _=[],S=1,E=0;T>=S;E++)_[E]=T/S|0,S*=4294967296;return new o(_,0)}function p(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return k(p(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=d(Math.pow(_,8)),E=m,w=0;w<T.length;w+=8){var A=Math.min(8,T.length-w),g=parseInt(T.substring(w,w+A),_);8>A?(A=d(Math.pow(_,A)),E=E.j(A).add(d(g))):(E=E.j(S),E=E.add(d(g)))}return E}var m=l(0),y=l(1),C=l(16777216);n=o.prototype,n.m=function(){if(O(this))return-k(this).m();for(var T=0,_=1,S=0;S<this.g.length;S++){var E=this.i(S);T+=(0<=E?E:4294967296+E)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(O(this))return"-"+k(this).toString(T);for(var _=d(Math.pow(T,6)),S=this,E="";;){var w=j(S,_).g;S=q(S,w.j(_));var A=((0<S.g.length?S.g[0]:S.h)>>>0).toString(T);if(S=w,x(S))return A+E;for(;6>A.length;)A="0"+A;E=A+E}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function x(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function O(T){return T.h==-1}n.l=function(T){return T=q(this,T),O(T)?-1:x(T)?0:1};function k(T){for(var _=T.g.length,S=[],E=0;E<_;E++)S[E]=~T.g[E];return new o(S,~T.h).add(y)}n.abs=function(){return O(this)?k(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),S=[],E=0,w=0;w<=_;w++){var A=E+(this.i(w)&65535)+(T.i(w)&65535),g=(A>>>16)+(this.i(w)>>>16)+(T.i(w)>>>16);E=g>>>16,A&=65535,g&=65535,S[w]=g<<16|A}return new o(S,S[S.length-1]&-2147483648?-1:0)};function q(T,_){return T.add(k(_))}n.j=function(T){if(x(this)||x(T))return m;if(O(this))return O(T)?k(this).j(k(T)):k(k(this).j(T));if(O(T))return k(this.j(k(T)));if(0>this.l(C)&&0>T.l(C))return d(this.m()*T.m());for(var _=this.g.length+T.g.length,S=[],E=0;E<2*_;E++)S[E]=0;for(E=0;E<this.g.length;E++)for(var w=0;w<T.g.length;w++){var A=this.i(E)>>>16,g=this.i(E)&65535,v=T.i(w)>>>16,H=T.i(w)&65535;S[2*E+2*w]+=g*H,P(S,2*E+2*w),S[2*E+2*w+1]+=A*H,P(S,2*E+2*w+1),S[2*E+2*w+1]+=g*v,P(S,2*E+2*w+1),S[2*E+2*w+2]+=A*v,P(S,2*E+2*w+2)}for(E=0;E<_;E++)S[E]=S[2*E+1]<<16|S[2*E];for(E=_;E<2*_;E++)S[E]=0;return new o(S,0)};function P(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function U(T,_){this.g=T,this.h=_}function j(T,_){if(x(_))throw Error("division by zero");if(x(T))return new U(m,m);if(O(T))return _=j(k(T),_),new U(k(_.g),k(_.h));if(O(_))return _=j(T,k(_)),new U(k(_.g),_.h);if(30<T.g.length){if(O(T)||O(_))throw Error("slowDivide_ only works with positive integers.");for(var S=y,E=_;0>=E.l(T);)S=Y(S),E=Y(E);var w=ie(S,1),A=ie(E,1);for(E=ie(E,2),S=ie(S,2);!x(E);){var g=A.add(E);0>=g.l(T)&&(w=w.add(S),A=g),E=ie(E,1),S=ie(S,1)}return _=q(T,w.j(_)),new U(w,_)}for(w=m;0<=T.l(_);){for(S=Math.max(1,Math.floor(T.m()/_.m())),E=Math.ceil(Math.log(S)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),A=d(S),g=A.j(_);O(g)||0<g.l(T);)S-=E,A=d(S),g=A.j(_);x(A)&&(A=y),w=w.add(A),T=q(T,g)}return new U(w,T)}n.A=function(T){return j(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),S=[],E=0;E<_;E++)S[E]=this.i(E)&T.i(E);return new o(S,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),S=[],E=0;E<_;E++)S[E]=this.i(E)|T.i(E);return new o(S,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),S=[],E=0;E<_;E++)S[E]=this.i(E)^T.i(E);return new o(S,this.h^T.h)};function Y(T){for(var _=T.g.length+1,S=[],E=0;E<_;E++)S[E]=T.i(E)<<1|T.i(E-1)>>>31;return new o(S,T.h)}function ie(T,_){var S=_>>5;_%=32;for(var E=T.g.length-S,w=[],A=0;A<E;A++)w[A]=0<_?T.i(A+S)>>>_|T.i(A+S+1)<<32-_:T.i(A+S);return new o(w,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Wp=IS.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=p,Xr=IS.Integer=o}).apply(typeof AS<"u"?AS:typeof self<"u"?self:typeof window<"u"?window:{});var Ts=Zc(ZA(),1),dD=Zc(Ug(),1);var eI="@firebase/firestore",tI="4.6.4";var ft=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ft.UNAUTHENTICATED=new ft(null);ft.GOOGLE_CREDENTIALS=new ft("google-credentials-uid");ft.FIRST_PARTY=new ft("first-party-uid");ft.MOCK_USER=new ft("mock-user");var BU="10.12.3";var Da=BU;function VU(n){Da=n}function qU(n){return NU(n,{depth:100})}var Mi=new cu("@firebase/firestore");function na(){return Mi.logLevel}function hD(n){Mi.setLogLevel(n)}function z(n,...e){if(Mi.logLevel<=Yn.DEBUG){let t=e.map(wb);Mi.debug(`Firestore (${Da}): ${n}`,...t)}}function Ke(n,...e){if(Mi.logLevel<=Yn.ERROR){let t=e.map(wb);Mi.error(`Firestore (${Da}): ${n}`,...t)}}function Cn(n,...e){if(Mi.logLevel<=Yn.WARN){let t=e.map(wb);Mi.warn(`Firestore (${Da}): ${n}`,...t)}}function wb(n){if(typeof n=="string")return n;try{return qU(n)}catch{return n}}function Q(n="Unexpected state"){let e=`FIRESTORE (${Da}) INTERNAL ASSERTION FAILED: `+n;throw Ke(e),new Error(e)}function te(n,e){n||Q()}function fD(n,e){n||Q()}function $(n,e){return n}var M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},L=class extends sS{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var at=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var wh=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},bv=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ft.UNAUTHENTICATED))}shutdown(){}},_v=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Sv=class{constructor(e){this.authProvider=e,this.currentUser=ft.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new at;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new at,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>I(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(z("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new at)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string"),new wh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string"),new ft(e)}},Cv=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=ft.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},Ev=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Cv(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(ft.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Tv=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Av=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,z("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Tv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function UU(n){if(!n)return new bv;switch(n.type){case"firstParty":return new Ev(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new L(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function zU(n){return LU(n)}var bh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=zU(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function le(n,e){return n<e?-1:n>e?1:0}function As(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function pD(n){return n+"\0"}var nI=-62135596800,rI=1e6,Qe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<nI)throw new L(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*rI);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/rI}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-nI,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var re=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Qe(0,0))}static max(){return new n(new Qe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var iI="__name__",_h=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&Q(),r===void 0?r=e.length-t:r>e.length-t&&Q(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ve=class n extends _h{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new L(M.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},jU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ct=class n extends _h{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return jU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===iI}static keyField(){return new n([iI])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new L(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new L(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new L(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new L(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var W=class n{constructor(e){this.path=e}static fromPath(e){return new n(ve.fromString(e))}static fromName(e){return new n(ve.fromString(e).popFirst(5))}static empty(){return new n(ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ve.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ve(e.slice()))}};var da=-1,GU=0,Iv=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function bb(n){return n.fields.find(e=>e.kind===2)}function Is(n){return n.fields.filter(e=>e.kind!==2)}function HU(n){let e=Is(n);return e.length===0?0:e[e.length-1].kind}function WU(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var la=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var ec=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(GU,En.min())}};function mD(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=re.fromTimestamp(r===1e9?new Qe(t+1,0):new Qe(t,r));return new En(i,W.empty(),e)}function gD(n){return new En(n.readTime,n.key,da)}var En=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(re.min(),W.empty(),da)}static max(){return new n(re.max(),W.empty(),da)}};function _b(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=W.comparator(n.documentKey,e.documentKey),t!==0)?t:le(n.largestBatchId,e.largestBatchId)}var yD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Sh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Gi(n){return I(this,null,function*(){if(n.code===M.FAILED_PRECONDITION&&n.message===yD)z("LocalStore","Unexpectedly lost primary lease");else throw n})}var R=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Q(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(p=>{o[d]=p,++a,a===s&&r(o)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var an="SimpleDb",$U=3,Ch=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new at,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Es(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=Sb(r.target.error);this.completionDeferred.reject(new Es(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Es(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(z(an,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new kv(t)}},Ni=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(rl())===12.2&&Ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return z(an,"Removing database:",e),ys(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!lu())return!1;if(n.isMockPersistence())return!0;let e=rl(),t=n.getIOSVersion(e),r=0<t&&t<10,i=vD(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return I(this,null,function*(){return this.db||(z(an,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Es(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new L(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new L(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Es(e,o))},i.onupgradeneeded=s=>{z(an,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{z(an,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return I(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Ch.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(d=>(a.maybeCommit(),d)).catch(d=>(a.abort(d),R.reject(d))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,d=l.name!=="FirebaseError"&&o<$U;if(z(an,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function vD(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Dv=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ys(this.dbCursor.delete())}},Es=class extends L{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Hi(n){return n.name==="IndexedDbTransactionError"}var kv=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(z(an,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(z(an,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ys(r)}add(e){z(an,"ADD",this.store.name,e,e);let t=this.store.add(e);return ys(t)}get(e){let t=this.store.get(e);return ys(t).next(r=>(r===void 0&&(r=null),z(an,"GET",this.store.name,e,r),r))}delete(e){z(an,"DELETE",this.store.name,e);let t=this.store.delete(e);return ys(t)}count(){z(an,"COUNT",this.store.name);let e=this.store.count();return ys(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new R((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){z(an,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{let o=Sb(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new R((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Dv(a),d=t(a.primaryKey,a.value,l);if(d instanceof R){let p=d.catch(m=>(l.done(),R.reject(m)));r.push(p)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ys(n){return new R((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Sb(r.target.error);t(i)}})}var sI=!1;function Sb(n){let e=Ni.getIOSVersion(rl());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new L("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sI||(sI=!0,setTimeout(()=>{throw r},0)),r}}return n}var Kl="IndexBackfiller",KU=15*1e3,QU=60*1e3,YU=50,Rv=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(KU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){z(Kl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>I(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();z(Kl,`Documents written: ${t}`)}catch(t){Hi(t)?z(Kl,"Ignoring IndexedDB error during index backfill: ",t):yield Gi(t)}yield this.schedule(QU)}))}},xv=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return I(this,arguments,function*(e=YU){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return z(Kl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(z(Kl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=gD(s);_b(o,r)>0&&(r=o)}),new En(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var ln=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),ca="",Ov="",wD="",bD="";function qt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=oI(e)),e=JU(n.get(t),e);return oI(e)}function JU(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=ca+wD;break;case ca:t+=ca+bD;break;default:t+=s}}return t}function oI(n){return n+ca+Ov}function mr(n){let e=n.length;if(te(e>=2),e===2)return te(n.charAt(0)===ca&&n.charAt(1)===Ov),ve.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(ca,s);switch((o<0||o>t)&&Q(),n.charAt(o+1)){case Ov:let l=n.substring(s,o),d;i.length===0?d=l:(i+=l,d=i,i=""),r.push(d);break;case wD:i+=n.substring(s,o),i+="\0";break;case bD:i+=n.substring(s,o+1);break;default:Q()}s=o+2}return new ve(r)}var vs="remoteDocuments";var Tc="owner",Qo="owner",Ac="mutationQueues",XU="userId",Fn="mutations",_D="batchId",Ss="userMutationsIndex",SD=["userId","batchId"];function ZU(n){return[n]}function fh(n,e){return[n,qt(e)]}function CD(n,e,t){return[n,qt(e),t]}var e3={},ka="documentMutations",hf="remoteDocumentsV14",t3=["prefixPath","collectionGroup","readTime","documentId"],ph="documentKeyIndex",n3=["prefixPath","collectionGroup","documentId"],ED="collectionGroupIndex",r3=["collectionGroup","readTime","prefixPath","documentId"],Ic="remoteDocumentGlobal",Mv="remoteDocumentGlobalKey",Ra="targets",i3="targetId",TD="queryTargetsIndex",s3=["canonicalId","targetId"],xa="targetDocuments",o3=["targetId","path"],Cb="documentTargetsIndex",a3=["path","targetId"],Eh="targetGlobalKey",qs="targetGlobal",tc="collectionParents",l3=["collectionId","parent"],ha="clientMetadata",c3="clientId",ff="bundles",u3="bundleId",pf="namedQueries",d3="name",Eb="indexConfiguration",h3="indexId",Nv="collectionGroupIndex",f3="collectionGroup",mf="indexState",p3=["indexId","uid"],AD="sequenceNumberIndex",m3=["uid","sequenceNumber"],gf="indexEntries",g3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ID="documentKeyIndex",y3=["indexId","uid","orderedDocumentKey"],yf="documentOverlays",v3=["userId","collectionPath","documentId"],Pv="collectionPathOverlayIndex",w3=["userId","collectionPath","largestBatchId"],DD="collectionGroupOverlayIndex",b3=["userId","collectionGroup","largestBatchId"],_3=[Ac,Fn,ka,vs,Ra,Tc,qs,xa],S3=_3,C3=[...S3,ha],E3=[...C3,Ic],T3=[...E3,tc],kD=[...T3,ff,pf],A3=[...kD,yf],RD=[Ac,Fn,ka,hf,Ra,Tc,qs,xa,ha,Ic,tc,ff,pf,yf],xD=RD,OD=[...xD,Eb,mf,gf],I3=OD;function D3(n){if(n===16)return I3;if(n===15)return OD;if(n===14)return xD;if(n===13)return RD;if(n===12)return A3;if(n===11)return kD;Q()}var nc=class extends Sh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function At(n,e){let t=$(n);return Ni.getStore(t.simpleDbTransaction,e)}function aI(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Us(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function MD(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Be=class n{constructor(e,t){this.comparator=e,this.root=t||Ql.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ql.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ql.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new oa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new oa(this.root,e,this.comparator,!1)}getReverseIterator(){return new oa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new oa(this.root,e,this.comparator,!0)}},oa=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ql=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Q();let t=this.left.check();if(t!==this.right.check())throw Q();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Fv=class{constructor(){this.size=0}get key(){throw Q()}get value(){throw Q()}get color(){throw Q()}get left(){throw Q()}get right(){throw Q()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ql(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Ql.EMPTY=new Fv;var Oe=class n{constructor(e){this.comparator=e,this.data=new Be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Th(this.data.getIterator())}getIteratorFrom(e){return new Th(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Th=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function k3(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Yo(s),l=Yo(o);for(;a||l;){let d=!1,p=!1;if(a&&l){let m=t(a,l);m<0?p=!0:m>0&&(d=!0)}else a!=null?p=!0:d=!0;d?(r(l),l=Yo(o)):p?(i(a),a=Yo(s)):(a=Yo(s),l=Yo(o))}}function Yo(n){return n.hasNext()?n.getNext():void 0}var cn=class n{constructor(e){this.fields=e,e.sort(ct.comparator)}static empty(){return new n([])}unionWith(e){let t=new Oe(ct.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return As(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function R3(n){return Buffer.from(n,"base64").toString("binary")}function x3(n){return Buffer.from(n,"binary").toString("base64")}function ND(){return!0}var Tt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=R3(e);return new n(t)}static fromUint8Array(e){let t=O3(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return x3(this.binaryString)}toUint8Array(){return M3(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Tt.EMPTY_BYTE_STRING=new Tt("");function O3(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function M3(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var N3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fr(n){if(te(!!n),typeof n=="string"){let e=0,t=N3.exec(n);if(te(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=tt(n.seconds),t=tt(n.nanos);return{seconds:e,nanos:t}}}function tt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Pi(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}var PD="server_timestamp",FD="__type__",LD="__previous_value__",BD="__local_write_time__";function vf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[FD])===null||t===void 0?void 0:t.stringValue)===PD}function P3(n,e){let t={fields:{[FD]:{stringValue:PD},[BD]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&vf(e)&&(e=Tb(e)),e&&(t.fields[LD]=e),{mapValue:t}}function Tb(n){let e=n.mapValue.fields[LD];return vf(e)?Tb(e):e}function rc(n){let e=Fr(n.mapValue.fields[BD].timestampValue);return new Qe(e.seconds,e.nanos)}var Lv=class{constructor(e,t,r,i,s,o,a,l,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=d}},lI="(default)",Fi=class n{constructor(e,t){this.projectId=e,this.database=t||lI}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===lI}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function F3(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new L(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fi(n.options.projectId,e)}var Oi=-1;function Dc(n){return n==null}function ic(n){return n===0&&1/n===-1/0}function VD(n){return typeof n=="number"&&Number.isInteger(n)&&!ic(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var qD="__max__",Ri={mapValue:{fields:{__type__:{stringValue:qD}}}},mh={nullValue:"NULL_VALUE"};function Ds(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vf(n)?4:UD(n)?9007199254740991:10:Q()}function Ln(n,e){if(n===e)return!0;let t=Ds(n),r=Ds(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return rc(n).isEqual(rc(e));case 3:return L3(n,e);case 5:return n.stringValue===e.stringValue;case 6:return V3(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return B3(n,e);case 2:return q3(n,e);case 9:return As(n.arrayValue.values||[],e.arrayValue.values||[],Ln);case 10:return U3(n,e);case 9007199254740991:return!0;default:return Q()}}function L3(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Fr(n.timestampValue),r=Fr(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function B3(n,e){return tt(n.geoPointValue.latitude)===tt(e.geoPointValue.latitude)&&tt(n.geoPointValue.longitude)===tt(e.geoPointValue.longitude)}function V3(n,e){return Pi(n.bytesValue).isEqual(Pi(e.bytesValue))}function q3(n,e){if("integerValue"in n&&"integerValue"in e)return tt(n.integerValue)===tt(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=tt(n.doubleValue),r=tt(e.doubleValue);return t===r?ic(t)===ic(r):isNaN(t)&&isNaN(r)}return!1}function U3(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(aI(t)!==aI(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Ln(t[i],r[i])))return!1;return!0}function sc(n,e){return(n.values||[]).find(t=>Ln(t,e))!==void 0}function Li(n,e){if(n===e)return 0;let t=Ds(n),r=Ds(e);if(t!==r)return le(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(n.booleanValue,e.booleanValue);case 2:return z3(n,e);case 3:return cI(n.timestampValue,e.timestampValue);case 4:return cI(rc(n),rc(e));case 5:return le(n.stringValue,e.stringValue);case 6:return H3(n.bytesValue,e.bytesValue);case 7:return j3(n.referenceValue,e.referenceValue);case 8:return G3(n.geoPointValue,e.geoPointValue);case 9:return W3(n.arrayValue,e.arrayValue);case 10:return $3(n.mapValue,e.mapValue);default:throw Q()}}function z3(n,e){let t=tt(n.integerValue||n.doubleValue),r=tt(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function cI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return le(n,e);let t=Fr(n),r=Fr(e),i=le(t.seconds,r.seconds);return i!==0?i:le(t.nanos,r.nanos)}function j3(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=le(t[i],r[i]);if(s!==0)return s}return le(t.length,r.length)}function G3(n,e){let t=le(tt(n.latitude),tt(e.latitude));return t!==0?t:le(tt(n.longitude),tt(e.longitude))}function H3(n,e){let t=Pi(n),r=Pi(e);return t.compareTo(r)}function W3(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Li(t[i],r[i]);if(s)return s}return le(t.length,r.length)}function $3(n,e){if(n===Ri.mapValue&&e===Ri.mapValue)return 0;if(n===Ri.mapValue)return 1;if(e===Ri.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=le(r[o],s[o]);if(a!==0)return a;let l=Li(t[r[o]],i[s[o]]);if(l!==0)return l}return le(r.length,s.length)}function fa(n){return Ab(n)}function Ab(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?Q3(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?K3(n.bytesValue):"referenceValue"in n?J3(n.referenceValue):"geoPointValue"in n?Y3(n.geoPointValue):"arrayValue"in n?Z3(n.arrayValue):"mapValue"in n?X3(n.mapValue):Q()}function K3(n){return Pi(n).toBase64()}function Q3(n){let e=Fr(n);return`time(${e.seconds},${e.nanos})`}function Y3(n){return`geo(${n.latitude},${n.longitude})`}function J3(n){return W.fromName(n).toString()}function X3(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Ab(n.fields[i])}`;return t+"}"}function Z3(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Ab(r);return e+"]"}function ks(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Bv(n){return!!n&&"integerValue"in n}function e4(n){return!!n&&"doubleValue"in n}function t4(n){return Bv(n)||e4(n)}function oc(n){return!!n&&"arrayValue"in n}function uI(n){return!!n&&"nullValue"in n}function dI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function gh(n){return!!n&&"mapValue"in n}function Yl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Us(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Yl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Yl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function UD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qD}function n4(n){return"nullValue"in n?mh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ks(Fi.empty(),W.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:Q()}function r4(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ks(Fi.empty(),W.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ri:Q()}function hI(n,e){let t=Li(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function fI(n,e){let t=Li(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Pt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!gh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Yl(t)}setAll(e){let t=ct.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Yl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());gh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ln(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!gh(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Us(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Yl(this.value))}};function zD(n){let e=[];return Us(n.fields,(t,r)=>{let i=new ct([t]);if(gh(r)){let o=zD(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new cn(e)}var ht=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,re.min(),re.min(),re.min(),Pt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,re.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,re.min(),re.min(),Pt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,re.min(),re.min(),Pt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(re.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function i4(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Li(r,i):Q()}var wr=class{constructor(e,t){this.position=e,this.inclusive=t}};function jD(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=W.comparator(W.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Li(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function s4(n,e,t){let r=jD(n,e,t);return n.inclusive?r>=0:r>0}function o4(n,e,t){let r=jD(n,e,t);return n.inclusive?r<=0:r<0}function pI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Ln(r,i))return!1}return!0}var Rs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function a4(n){return n.field.canonicalString()+n.dir}function l4(n){return`${n.field.canonicalString()} (${n.dir})`}function c4(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ah=class{},pe=class n extends Ah{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Uv(e,t,r):t==="array-contains"?new Gv(e,r):t==="in"?new Ih(e,r):t==="not-in"?new Hv(e,r):t==="array-contains-any"?new Wv(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new zv(e,r):new jv(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Li(t,this.value)):t!==null&&Ds(this.value)===Ds(t)&&this.matchesComparison(Li(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Q()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ke=class n extends Ah{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return pa(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function pa(n){return n.op==="and"}function Vv(n){return n.op==="or"}function Ib(n){return GD(n)&&pa(n)}function GD(n){for(let e of n.filters)if(e instanceof ke)return!1;return!0}function qv(n){if(n instanceof pe)return n.field.canonicalString()+n.op.toString()+fa(n.value);if(Ib(n))return n.filters.map(e=>qv(e)).join(",");{let e=n.filters.map(t=>qv(t)).join(",");return`${n.op}(${e})`}}function HD(n,e){if(n instanceof pe)return u4(n,e);if(n instanceof ke)return d4(n,e);Q()}function u4(n,e){return e instanceof pe&&n.op===e.op&&n.field.isEqual(e.field)&&Ln(n.value,e.value)}function d4(n,e){return e instanceof ke&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&HD(i,e.filters[s]),!0):!1}function WD(n,e){let t=n.filters.concat(e);return ke.create(t,n.op)}function $D(n){return n instanceof pe?f4(n):n instanceof ke?h4(n):"Filter"}function h4(n){return n.op.toString()+" {"+n.getFilters().map($D).join(" ,")+"}"}function f4(n){return`${n.field.canonicalString()} ${n.op} ${fa(n.value)}`}var Uv=class extends pe{constructor(e,t,r){super(e,t,r),this.key=W.fromName(r.referenceValue)}matches(e){let t=W.comparator(e.key,this.key);return this.matchesComparison(t)}},zv=class extends pe{constructor(e,t){super(e,"in",t),this.keys=KD("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},jv=class extends pe{constructor(e,t){super(e,"not-in",t),this.keys=KD("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function KD(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>W.fromName(r.referenceValue))}var Gv=class extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return oc(t)&&sc(t.arrayValue,this.value)}},Ih=class extends pe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&sc(this.value.arrayValue,t)}},Hv=class extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(sc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!sc(this.value.arrayValue,t)}},Wv=class extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!oc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>sc(this.value.arrayValue,r))}};var $v=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function Kv(n,e=null,t=[],r=[],i=null,s=null,o=null){return new $v(n,e,t,r,i,s,o)}function xs(n){let e=$(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>qv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>a4(r)).join(","),Dc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>fa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>fa(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function p4(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>$D(t)).join(", ")}]`),Dc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>l4(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>fa(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>fa(t)).join(",")),`Target(${e})`}function kc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!c4(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!HD(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!pI(n.startAt,e.startAt)?!1:pI(n.endAt,e.endAt)}function Dh(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function wf(n,e){return n.filters.filter(t=>t instanceof pe&&t.field.isEqual(e))}function m4(n,e){let t=bb(e);if(t===void 0)return null;for(let r of wf(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function g4(n,e){let t=new Map;for(let r of Is(e))for(let i of wf(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function y4(n,e){let t=[],r=!0;for(let i of Is(e)){let s=i.kind===0?QD(n,i.fieldPath,n.startAt):YD(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new wr(t,r)}function v4(n,e){let t=[],r=!0;for(let i of Is(e)){let s=i.kind===0?YD(n,i.fieldPath,n.endAt):QD(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new wr(t,r)}function QD(n,e,t){let r=mh,i=!0;for(let s of wf(n,e)){let o=mh,a=!0;switch(s.op){case"<":case"<=":o=n4(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=mh;break}hI({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];hI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function YD(n,e,t){let r=Ri,i=!0;for(let s of wf(n,e)){let o=Ri,a=!0;switch(s.op){case">=":case">":o=r4(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ri;break}fI({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];fI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function w4(n){let e=new Oe(ct.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function b4(n){return n.limit!==null}var Bn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function JD(n,e,t,r,i,s,o,a){return new Bn(n,e,t,r,i,s,o,a)}function Oa(n){return new Bn(n)}function _4(n,e){return new Bn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function mI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function S4(n){let e=new Oe(ct.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function C4(n){return new Bn(ve.emptyPath(),n)}function E4(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Db(n){return n.collectionGroup!==null}function ma(n){let e=$(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";S4(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Rs(s,r))}),t.has(ct.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Rs(ct.keyField(),r))}return e.memoizedNormalizedOrderBy}function Ut(n){let e=$(n);return e.memoizedTarget||(e.memoizedTarget=T4(e,ma(n))),e.memoizedTarget}function T4(n,e){if(n.limitType==="F")return Kv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Rs(i.field,s)});let t=n.endAt?new wr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new wr(n.startAt.position,n.startAt.inclusive):null;return Kv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function kb(n,e){let t=n.filters.concat([e]);return new Bn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function A4(n,e){let t=n.explicitOrderBy.concat([e]);return new Bn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function kh(n,e,t){return new Bn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function I4(n,e){return new Bn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function D4(n,e){return new Bn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Rc(n,e){return kc(Ut(n),Ut(e))&&n.limitType===e.limitType}function XD(n){return`${xs(Ut(n))}|lt:${n.limitType}`}function ra(n){return`Query(target=${p4(Ut(n))}; limitType=${n.limitType})`}function xc(n,e){return e.isFoundDocument()&&k4(n,e)&&R4(n,e)&&x4(n,e)&&O4(n,e)}function k4(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):W.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function R4(n,e){for(let t of ma(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function x4(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function O4(n,e){return!(n.startAt&&!o4(n.startAt,ma(n),e)||n.endAt&&!s4(n.endAt,ma(n),e))}function ZD(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function e1(n){return(e,t)=>{let r=!1;for(let i of ma(n)){let s=M4(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function M4(n,e,t){let r=n.field.isKeyField()?W.comparator(e.key,t.key):i4(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Q()}}var br=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Us(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return MD(this.inner)}size(){return this.innerSize}};var N4=new Be(W.comparator);function en(){return N4}var t1=new Be(W.comparator);function Wl(...n){let e=t1;for(let t of n)e=e.insert(t.key,t);return e}function P4(){return ac()}function n1(n){let e=t1;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function gr(){return ac()}function r1(){return ac()}function ac(){return new br(n=>n.toString(),(n,e)=>n.isEqual(e))}var F4=new Be(W.comparator);function L4(){return F4}var B4=new Oe(W.comparator);function ce(...n){let e=B4;for(let t of n)e=e.add(t);return e}var V4=new Oe(le);function Rb(){return V4}function i1(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ic(e)?"-0":e}}function s1(n){return{integerValue:""+n}}function o1(n,e){return VD(e)?s1(e):i1(n,e)}var ga=class{constructor(){this._=void 0}};function q4(n,e,t){return n instanceof Bi?P3(t,e):n instanceof Lr?l1(n,e):n instanceof Br?c1(n,e):j4(n,e)}function U4(n,e,t){return n instanceof Lr?l1(n,e):n instanceof Br?c1(n,e):t}function a1(n,e){return n instanceof Vi?t4(e)?e:{integerValue:0}:null}function z4(n,e){return n instanceof Lr&&e instanceof Lr||n instanceof Br&&e instanceof Br?As(n.elements,e.elements,Ln):n instanceof Vi&&e instanceof Vi?Ln(n.operand,e.operand):n instanceof Bi&&e instanceof Bi}var Bi=class extends ga{},Lr=class extends ga{constructor(e){super(),this.elements=e}};function l1(n,e){let t=u1(e);for(let r of n.elements)t.some(i=>Ln(i,r))||t.push(r);return{arrayValue:{values:t}}}var Br=class extends ga{constructor(e){super(),this.elements=e}};function c1(n,e){let t=u1(e);for(let r of n.elements)t=t.filter(i=>!Ln(i,r));return{arrayValue:{values:t}}}var Vi=class extends ga{constructor(e,t){super(),this.serializer=e,this.operand=t}};function j4(n,e){let t=a1(n,e),r=gI(t)+gI(n.operand);return Bv(t)&&Bv(n.operand)?s1(r):i1(n.serializer,r)}function gI(n){return tt(n.integerValue||n.doubleValue)}function u1(n){return oc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Os=class{constructor(e,t){this.field=e,this.transform=t}};function G4(n,e){return n.field.isEqual(e.field)&&z4(n.transform,e.transform)}function H4(n,e){return n===void 0&&e===void 0?!0:n&&e?As(n,e,(t,r)=>G4(t,r)):!1}var Qv=class{constructor(e,t){this.version=e,this.transformResults=t}},et=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function bf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var ya=class{};function d1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ui(n.key,et.none()):new qi(n.key,n.data,et.none());{let t=n.data,r=Pt.empty(),i=new Oe(ct.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Vn(n.key,r,new cn(i.toArray()),et.none())}}function W4(n,e,t){n instanceof qi?K4(n,e,t):n instanceof Vn?Y4(n,e,t):X4(n,e,t)}function Jl(n,e,t,r){return n instanceof qi?Q4(n,e,t,r):n instanceof Vn?J4(n,e,t,r):Z4(n,e,t)}function $4(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=a1(r.transform,i||null);s!=null&&(t===null&&(t=Pt.empty()),t.set(r.field,s))}return t||null}function yI(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!H4(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var qi=class extends ya{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function K4(n,e,t){let r=n.value.clone(),i=f1(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function Q4(n,e,t,r){if(!bf(n.precondition,e))return t;let i=n.value.clone(),s=p1(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Vn=class extends ya{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Y4(n,e,t){if(!bf(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=f1(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(h1(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function J4(n,e,t,r){if(!bf(n.precondition,e))return t;let i=p1(n.fieldTransforms,r,e),s=e.data;return s.setAll(h1(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function h1(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function f1(n,e,t){let r=new Map;te(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,U4(o,a,t[i]))}return r}function p1(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,q4(s,o,e))}return r}var Ui=class extends ya{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function X4(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function Z4(n,e,t){return bf(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var lc=class extends ya{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var cc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];W4(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Jl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Jl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=r1();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=d1(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(re.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ce())}isEqual(e){return this.batchId===e.batchId&&As(this.mutations,e.mutations,(t,r)=>yI(t,r))&&As(this.baseMutations,e.baseMutations,(t,r)=>yI(t,r))}},Yv=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){te(e.mutations.length===r.length);let i=L4(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var uc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Jv=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Et=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Et||{});function m1(n){switch(n){case M.OK:return Q();case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return Q()}}function ez(n){return m1(n)&&n!==M.ABORTED}function yh(n){if(n===void 0)return Ke("GRPC error has no .code"),M.UNKNOWN;switch(n){case Et.OK:return M.OK;case Et.CANCELLED:return M.CANCELLED;case Et.UNKNOWN:return M.UNKNOWN;case Et.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Et.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Et.INTERNAL:return M.INTERNAL;case Et.UNAVAILABLE:return M.UNAVAILABLE;case Et.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Et.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Et.NOT_FOUND:return M.NOT_FOUND;case Et.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Et.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Et.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Et.ABORTED:return M.ABORTED;case Et.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Et.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Et.DATA_LOSS:return M.DATA_LOSS;default:return Q()}}var Xv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var dv=null;function g1(){return new PU}function tz(){return new FU("utf-8")}var nz=new Xr([4294967295,4294967295],0);function vI(n){let e=g1().encode(n),t=new Wp;return t.update(e),new Uint8Array(t.digest())}function wI(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Xr([t,r],0),a=new Xr([i,s],0);return[o,a]}var Zv=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Cs(`Invalid padding: ${t}`);if(r<0)throw new Cs(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Cs(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Cs(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Xr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Xr.fromNumber(r)));return i.compare(nz)===1&&(i=new Xr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=vI(e),[r,i]=wI(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=vI(e),[r,i]=wI(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Cs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var dc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,hc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(re.min(),i,new Be(le),en(),ce())}},hc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ce(),ce(),ce())}};var ua=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Rh=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},xh=class{constructor(e,t,r=Tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Oh=class{constructor(){this.pendingResponses=0,this.documentChanges=_I(),this._resumeToken=Tt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ce(),t=ce(),r=ce();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Q()}}),new hc(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=_I()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,te(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},rz="WatchChangeAggregator",ew=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=en(),this.pendingDocumentTargetMapping=bI(),this.pendingTargetResets=new Be(le)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:Q()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Dh(s))if(r===0){let o=new W(s.path);this.removeDocumentFromTarget(t,o,ht.newNoDocument(o,re.min()))}else te(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,d)}dv?.notifyOnExistenceFilterMismatch(iz(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Pi(r).toUint8Array()}catch(l){if(l instanceof Xv)return Cn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new Zv(o,i,s)}catch(l){return l instanceof Cs?Cn("BloomFilter error: ",l):Cn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Dh(a.target)){let l=new W(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,ht.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ce();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let d=this.targetDataForActiveTarget(l);return d&&d.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new dc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=en(),this.pendingDocumentTargetMapping=bI(),this.pendingTargetResets=new Be(le),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Oh,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Oe(le),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||z(rz,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Oh),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function bI(){return new Be(W.comparator)}function _I(){return new Be(W.comparator)}function iz(n,e,t,r,i){var s,o,a,l,d,p;let m={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},y=e.unchangedNames;return y&&(m.bloomFilter={applied:i===0,hashCount:(s=y?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=y?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(p=(d=y?.bits)===null||d===void 0?void 0:d.padding)!==null&&p!==void 0?p:0,mightContain:C=>{var x;return(x=r?.mightContain(C))!==null&&x!==void 0?x:!1}}),m}var sz=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),oz=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),az=(()=>{let n={};return n.and="AND",n.or="OR",n})();var tw=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function lz(n){let e=n.code===void 0?M.UNKNOWN:yh(n.code);return new L(e,n.message||"")}function nw(n,e){return n.useProto3Json||Dc(e)?e:{value:e}}function cz(n){let e;return typeof n=="object"?e=n.value:e=n,Dc(e)?null:e}function va(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function uz(n){let e=Fr(n);return new Qe(e.seconds,e.nanos)}function y1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function dz(n,e){return n.useProto3Json?(te(e===void 0||typeof e=="string"),Tt.fromBase64String(e||"")):(te(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Tt.fromUint8Array(e||new Uint8Array))}function hz(n,e){return va(n,e.toTimestamp())}function lt(n){return te(!!n),re.fromTimestamp(uz(n))}function xb(n,e){return rw(n,e).canonicalString()}function rw(n,e){let t=fz(n).child("documents");return e===void 0?t:t.child(e)}function v1(n){let e=ve.fromString(n);return te(D1(e)),e}function fc(n,e){return xb(n.databaseId,e.path)}function yr(n,e){let t=v1(e);if(t.get(1)!==n.databaseId.projectId)throw new L(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new W(_1(t))}function w1(n,e){return xb(n.databaseId,e)}function b1(n){let e=v1(n);return e.length===4?ve.emptyPath():_1(e)}function iw(n){return new ve(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fz(n){return new ve(["projects",n.projectId,"databases",n.database])}function _1(n){return te(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function SI(n,e,t){return{name:fc(n,e),fields:t.value.mapValue.fields}}function pz(n,e){return{name:fc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:va(n,e.version.toTimestamp()),createTime:va(n,e.createTime.toTimestamp())}}function S1(n,e,t){let r=yr(n,e.name),i=lt(e.updateTime),s=e.createTime?lt(e.createTime):re.min(),o=new Pt({mapValue:{fields:e.fields}}),a=ht.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function mz(n,e){te(!!e.found),e.found.name,e.found.updateTime;let t=yr(n,e.found.name),r=lt(e.found.updateTime),i=e.found.createTime?lt(e.found.createTime):re.min(),s=new Pt({mapValue:{fields:e.found.fields}});return ht.newFoundDocument(t,r,i,s)}function gz(n,e){te(!!e.missing),te(!!e.readTime);let t=yr(n,e.missing),r=lt(e.readTime);return ht.newNoDocument(t,r)}function yz(n,e){return"found"in e?mz(n,e):"missing"in e?gz(n,e):Q()}function vz(n,e){let t;if("targetChange"in e){e.targetChange;let r=wz(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=dz(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&lz(o);t=new xh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=yr(n,r.document.name),s=lt(r.document.updateTime),o=r.document.createTime?lt(r.document.createTime):re.min(),a=new Pt({mapValue:{fields:r.document.fields}}),l=ht.newFoundDocument(i,s,o,a),d=r.targetIds||[],p=r.removedTargetIds||[];t=new ua(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=yr(n,r.document),s=r.readTime?lt(r.readTime):re.min(),o=ht.newNoDocument(i,s),a=r.removedTargetIds||[];t=new ua([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=yr(n,r.document),s=r.removedTargetIds||[];t=new ua([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Jv(i,s),a=r.targetId;t=new Rh(a,o)}else return Q();return t}function wz(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:Q()}function bz(n){if(!("targetChange"in n))return re.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?re.min():lt(e.readTime)}function pc(n,e){let t;if(e instanceof qi)t={update:SI(n,e.key,e.value)};else if(e instanceof Ui)t={delete:fc(n,e.key)};else if(e instanceof Vn)t={update:SI(n,e.key,e.data),updateMask:Zz(e.fieldMask)};else if(e instanceof lc)t={verify:fc(n,e.key)};else return Q();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>Tz(n,r))),e.precondition.isNone||(t.currentDocument=_z(n,e.precondition)),t}function sw(n,e){let t=e.currentDocument?Sz(e.currentDocument):et.none(),r=e.updateTransforms?e.updateTransforms.map(i=>Az(n,i)):[];if(e.update){e.update.name;let i=yr(n,e.update.name),s=new Pt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=e6(e.updateMask);return new Vn(i,s,o,t,r)}else return new qi(i,s,t,r)}else if(e.delete){let i=yr(n,e.delete);return new Ui(i,t)}else if(e.verify){let i=yr(n,e.verify);return new lc(i,t)}else return Q()}function _z(n,e){return e.updateTime!==void 0?{updateTime:hz(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:Q()}function Sz(n){return n.updateTime!==void 0?et.updateTime(lt(n.updateTime)):n.exists!==void 0?et.exists(n.exists):et.none()}function Cz(n,e){let t=n.updateTime?lt(n.updateTime):lt(e);return t.isEqual(re.min())&&(t=lt(e)),new Qv(t,n.transformResults||[])}function Ez(n,e){return n&&n.length>0?(te(e!==void 0),n.map(t=>Cz(t,e))):[]}function Tz(n,e){let t=e.transform;if(t instanceof Bi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Lr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Br)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Vi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw Q()}function Az(n,e){let t=null;if("setToServerValue"in e)te(e.setToServerValue==="REQUEST_TIME"),t=new Bi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Lr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Br(i)}else"increment"in e?t=new Vi(n,e.increment):Q();let r=ct.fromServerFormat(e.fieldPath);return new Os(r,t)}function C1(n,e){return{documents:[w1(n,e.path)]}}function Iz(n){let e=n.documents.length;te(e===1);let t=n.documents[0];return Ut(Oa(b1(t)))}function E1(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=w1(n,i);let s=Oz(e.filters);s&&(t.structuredQuery.where=s);let o=Nz(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=nw(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=Fz(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Lz(e.endAt)),{queryTarget:t,parent:i}}function T1(n){let e=b1(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){te(r===1);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=Mz(t.where));let o=[];t.orderBy&&(o=Pz(t.orderBy));let a=null;t.limit&&(a=cz(t.limit));let l=null;t.startAt&&(l=Bz(t.startAt));let d=null;return t.endAt&&(d=Vz(t.endAt)),JD(e,i,o,s,a,"F",l,d)}function Dz(n){return Ut(T1(n))}function kz(n,e){let t=Rz(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Rz(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q()}}function xz(n,e){let t,r=e.target;if(Dh(r)?t={documents:C1(n,r)}:t={query:E1(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=y1(n,e.resumeToken);let i=nw(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(re.min())>0){t.readTime=va(n,e.snapshotVersion.toTimestamp());let i=nw(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function Oz(n){if(n.length!==0)return I1(ke.create(n,"and"))}function Mz(n){let e=A1(n);return e instanceof ke&&Ib(e)?e.getFilters():[e]}function A1(n){return n.unaryFilter!==void 0?Yz(n):n.fieldFilter!==void 0?Jz(n):n.compositeFilter!==void 0?Xz(n):Q()}function Nz(n){if(n.length!==0)return n.map(e=>Wz(e))}function Pz(n){return n.map(e=>$z(e))}function Fz(n){return{before:n.inclusive,values:n.position}}function Lz(n){return{before:!n.inclusive,values:n.position}}function Bz(n){let e=!!n.before,t=n.values||[];return new wr(t,e)}function Vz(n){let e=!n.before,t=n.values||[];return new wr(t,e)}function qz(n){return sz[n]}function Uz(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function zz(n){return oz[n]}function jz(n){return az[n]}function Gz(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Q();default:return Q()}}function Hz(n){switch(n){case"AND":return"and";case"OR":return"or";default:return Q()}}function ia(n){return{fieldPath:n.canonicalString()}}function aa(n){return ct.fromServerFormat(n.fieldPath)}function Wz(n){return{field:ia(n.field),direction:qz(n.dir)}}function $z(n){return new Rs(aa(n.field),Uz(n.direction))}function I1(n){return n instanceof pe?Qz(n):n instanceof ke?Kz(n):Q()}function Kz(n){let e=n.getFilters().map(t=>I1(t));return e.length===1?e[0]:{compositeFilter:{op:jz(n.op),filters:e}}}function Qz(n){if(n.op==="=="){if(dI(n.value))return{unaryFilter:{field:ia(n.field),op:"IS_NAN"}};if(uI(n.value))return{unaryFilter:{field:ia(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(dI(n.value))return{unaryFilter:{field:ia(n.field),op:"IS_NOT_NAN"}};if(uI(n.value))return{unaryFilter:{field:ia(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ia(n.field),op:zz(n.op),value:n.value}}}function Yz(n){switch(n.unaryFilter.op){case"IS_NAN":let e=aa(n.unaryFilter.field);return pe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=aa(n.unaryFilter.field);return pe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aa(n.unaryFilter.field);return pe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aa(n.unaryFilter.field);return pe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Q();default:return Q()}}function Jz(n){return pe.create(aa(n.fieldFilter.field),Gz(n.fieldFilter.op),n.fieldFilter.value)}function Xz(n){return ke.create(n.compositeFilter.filters.map(e=>A1(e)),Hz(n.compositeFilter.op))}function Zz(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function e6(n){let e=n.fieldPaths||[];return new cn(e.map(t=>ct.fromServerFormat(t)))}function D1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var wa=class n{constructor(e,t,r,i,s=re.min(),o=re.min(),a=Tt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Mh=class{constructor(e){this.remoteSerializer=e}};function t6(n,e){let t;if(e.document)t=S1(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=W.fromSegments(e.noDocument.path),i=Ns(e.noDocument.readTime);t=ht.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=W.fromSegments(e.unknownDocument.path),i=Ns(e.unknownDocument.version);t=ht.newUnknownDocument(r,i)}else return Q();return e.readTime&&t.setReadTime(n6(e.readTime)),t}function CI(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_f(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=pz(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ms(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Ms(e.version)};else return Q();return r}function _f(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function n6(n){let e=new Qe(n[0],n[1]);return re.fromTimestamp(e)}function Ms(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ns(n){let e=new Qe(n.seconds,n.nanoseconds);return re.fromTimestamp(e)}function r6(n,e,t){let r=t.baseMutations.map(s=>pc(n.remoteSerializer,s)),i=t.mutations.map(s=>pc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function ws(n,e){let t=(e.baseMutations||[]).map(s=>sw(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>sw(n.remoteSerializer,s)),i=Qe.fromMillis(e.localWriteTimeMs);return new cc(e.batchId,i,t,r)}function $l(n){let e=Ns(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ns(n.lastLimboFreeSnapshotVersion):re.min(),r;return i6(n.query)?r=Iz(n.query):r=Dz(n.query),new wa(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Tt.fromBase64String(n.resumeToken))}function k1(n,e){let t=Ms(e.snapshotVersion),r=Ms(e.lastLimboFreeSnapshotVersion),i;Dh(e.target)?i=C1(n.remoteSerializer,e.target):i=E1(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:xs(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function i6(n){return n.documents!==void 0}function s6(n){return{id:n.bundleId,createTime:Ns(n.createTime),version:n.version}}function o6(n){return{bundleId:n.id,createTime:Ms(lt(n.createTime)),version:n.version}}function a6(n){return{name:n.name,query:Ob(n.bundledQuery),readTime:Ns(n.readTime)}}function l6(n){return{name:n.name,readTime:Ms(lt(n.readTime)),bundledQuery:n.bundledQuery}}function Ob(n){let e=T1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kh(e,e.limit,"L"):e}function c6(n){return{name:n.name,query:Ob(n.bundledQuery),readTime:lt(n.readTime)}}function u6(n){return{id:n.id,version:n.version,createTime:lt(n.createTime)}}function hv(n,e){return new uc(e.largestBatchId,sw(n.remoteSerializer,e.overlayMutation))}function d6(n,e,t){let[r,i,s]=R1(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:pc(n.remoteSerializer,t.mutation)}}function R1(n,e){let t=e.path.lastSegment(),r=qt(e.path.popLast());return[n,r,t]}function h6(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function f6(n,e){let t=e?new ec(e.sequenceNumber,new En(Ns(e.readTime),new W(mr(e.documentKey)),e.largestBatchId)):ec.empty(),r=n.fields.map(([i,s])=>new la(ct.fromServerFormat(i),s));return new Iv(n.indexId,n.collectionGroup,r,t)}function EI(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ms(r.readTime),documentKey:qt(r.documentKey.path),largestBatchId:r.largestBatchId}}var ow=class{getBundleMetadata(e,t){return TI(e).get(t).next(r=>{if(r)return s6(r)})}saveBundleMetadata(e,t){return TI(e).put(o6(t))}getNamedQuery(e,t){return AI(e).get(t).next(r=>{if(r)return a6(r)})}saveNamedQuery(e,t){return AI(e).put(l6(t))}};function TI(n){return At(n,ff)}function AI(n){return At(n,pf)}var Nh=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return zl(e).get(R1(this.userId,t)).next(r=>r?hv(this.serializer,r):null)}getOverlays(e,t){let r=gr();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new uc(t,o);i.push(this.saveOverlay(e,a))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(qt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(zl(e).deleteAll(Pv,a))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){let i=gr(),s=qt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return zl(e).loadAll(Pv,o).next(a=>{for(let l of a){let d=hv(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=gr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return zl(e).iterate({index:DD,range:a},(l,d,p)=>{let m=hv(this.serializer,d);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):p.done()}).next(()=>s)}saveOverlay(e,t){return zl(e).put(d6(this.serializer,this.userId,t))}};function zl(n){return At(n,yf)}var p6=5,m6=10,g6=13,II=15,y6=20,v6=25,w6=30,b6=37,_6=45,S6=50,C6=55,E6=60,T6=2,Pr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,p6);else if("booleanValue"in e)this.writeValueTypeLabel(t,m6),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,II),t.writeNumber(tt(e.integerValue));else if("doubleValue"in e){let r=tt(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,g6):(this.writeValueTypeLabel(t,II),ic(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,y6),typeof r=="string"&&(r=Fr(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,w6),t.writeBytes(Pi(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,_6),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?UD(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):Q()}writeIndexString(e,t){this.writeValueTypeLabel(t,v6),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,C6);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,S6);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,b6),W.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,E6),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(T6)}};Pr.INSTANCE=new Pr;var DI="\uD800",kI="\uDBFF",Jo=0,RI=255,xI=1,Xo=255,OI=255,MI=0,A6=64,I6=8,D6=1024;function k6(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function R6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function x6(n){let e=0;for(let t=0;t<8;++t){let r=R6(n[t]&255);if(e+=r,r!==8)break}return e}function NI(n){let e=A6-x6(n);return Math.ceil(e/I6)}var aw=class{constructor(){this.buffer=new Uint8Array(D6),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<DI||kI<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<DI||kI<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=NI(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=NI(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Xo),this.writeEscapedByteAscending(OI)}writeInfinityDescending(){this.writeEscapedByteDescending(Xo),this.writeEscapedByteDescending(OI)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=k6(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Jo?(this.writeEscapedByteAscending(Jo),this.writeEscapedByteAscending(RI)):t===Xo?(this.writeEscapedByteAscending(Xo),this.writeEscapedByteAscending(MI)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Jo?(this.writeEscapedByteDescending(Jo),this.writeEscapedByteDescending(RI)):t===Xo?(this.writeEscapedByteDescending(Xo),this.writeEscapedByteDescending(MI)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Jo),this.writeEscapedByteAscending(xI)}writeSeparatorDescending(){this.writeEscapedByteDescending(Jo),this.writeEscapedByteDescending(xI)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},lw=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},cw=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},bs=class{constructor(){this.orderedCode=new aw,this.ascending=new lw(this.orderedCode),this.descending=new cw(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var _s=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Ai(n,e){let t=n.indexId-e.indexId;return t!==0||(t=PI(n.arrayValue,e.arrayValue),t!==0)||(t=PI(n.directionalValue,e.directionalValue),t!==0)?t:W.comparator(n.documentKey,e.documentKey)}function PI(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Ph=class{constructor(e){this.inequalityFilters=new Oe((t,r)=>ct.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(te(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=bb(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=Is(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Oe(ct.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new la(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new la(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new la(r.field,r.dir==="asc"?0:1)));return new Iv(Iv.UNKNOWN_ID,this.collectionId,t,ec.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function x1(n){var e,t;if(te(n instanceof pe||n instanceof ke),n instanceof pe)if(n instanceof Ih){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>pe.create(n.field,"==",s)))||[];return ke.create(i,"or")}else return n;let r=n.filters.map(i=>x1(i));return ke.create(r,n.op)}function O6(n){if(n.getFilters().length===0)return[];let e=uw(x1(n));return te(O1(e)),Mb(e)||Nb(e)?[e]:e.getFilters()}function Mb(n){return n instanceof pe}function Nb(n){return n instanceof ke&&Ib(n)}function O1(n){return Mb(n)||Nb(n)||M6(n)}function M6(n){if(n instanceof ke&&Vv(n)){for(let e of n.getFilters())if(!Mb(e)&&!Nb(e))return!1;return!0}return!1}function uw(n){if(te(n instanceof pe||n instanceof ke),n instanceof pe)return n;if(n.filters.length===1)return uw(n.filters[0]);let e=n.filters.map(r=>uw(r)),t=ke.create(e,n.op);return t=Fh(t),O1(t)?t:(te(t instanceof ke),te(pa(t)),te(t.filters.length>1),t.filters.reduce((r,i)=>Pb(r,i)))}function Pb(n,e){te(n instanceof pe||n instanceof ke),te(e instanceof pe||e instanceof ke);let t;return n instanceof pe?e instanceof pe?t=N6(n,e):t=FI(n,e):e instanceof pe?t=FI(e,n):t=P6(n,e),Fh(t)}function N6(n,e){return ke.create([n,e],"and")}function P6(n,e){if(te(n.filters.length>0&&e.filters.length>0),pa(n)&&pa(e))return WD(n,e.getFilters());let t=Vv(n)?n:e,r=Vv(n)?e:n,i=t.filters.map(s=>Pb(s,r));return ke.create(i,"or")}function FI(n,e){if(pa(e))return WD(e,n.getFilters());{let t=e.filters.map(r=>Pb(n,r));return ke.create(t,"or")}}function Fh(n){if(te(n instanceof pe||n instanceof ke),n instanceof pe)return n;let e=n.getFilters();if(e.length===1)return Fh(e[0]);if(GD(n))return n;let t=e.map(i=>Fh(i)),r=[];return t.forEach(i=>{i instanceof pe?r.push(i):i instanceof ke&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ke.create(r,n.op)}var dw=class{constructor(){this.collectionParentIndex=new mc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(En.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(En.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}},mc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Oe(ve.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Oe(ve.comparator)).toArray()}};var LI="IndexedDbIndexManager",ch=new Uint8Array(0),hw=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new mc,this.targetToDnfSubTargets=new br(r=>xs(r),(r,i)=>kc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:qt(i)};return BI(e).put(s)}return R.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[pD(t),""],!1,!0);return BI(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(mr(o.parent))}return r})}addFieldIndex(e,t){let r=jl(e),i=h6(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=ea(e);return s.next(a=>{o.put(EI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=jl(e),i=ea(e),s=Zo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=jl(e),r=Zo(e),i=ea(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return R.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Ph(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Zo(e),i=!0,s=new Map;return R.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ce(),a=[];return R.forEach(s,(l,d)=>{z(LI,`Using index ${WU(l)} to execute ${xs(t)}`);let p=m4(d,l),m=g4(d,l),y=y4(d,l),C=v4(d,l),x=this.encodeBound(l,d,y),O=this.encodeBound(l,d,C),k=this.encodeValues(l,d,m),q=this.generateIndexRanges(l.indexId,p,x,y.inclusive,O,C.inclusive,k);return R.forEach(q,P=>r.loadFirst(P,t.limit).next(U=>{U.forEach(j=>{let Y=W.fromSegments(j.documentKey);o.has(Y)||(o=o.add(Y),a.push(Y))})}))}).next(()=>a)}else return R.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=O6(ke.create(e.filters,"and")).map(i=>Kv(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),d=l/(t!=null?t.length:1),p=[];for(let m=0;m<l;++m){let y=t?this.encodeSingleElement(t[m/d]):ch,C=this.generateLowerBound(e,y,r[m%d],i),x=this.generateUpperBound(e,y,s[m%d],o),O=a.map(k=>this.generateLowerBound(e,y,k,!0));p.push(...this.createRange(C,x,O))}return p}generateLowerBound(e,t,r,i){let s=new _s(e,W.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new _s(e,W.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new Ph(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return R.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<w4(s)&&(r=1):r=0})).next(()=>b4(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new bs;for(let i of Is(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Pr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new bs;return Pr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new bs;return Pr.INSTANCE.writeIndexValue(ks(this.databaseId,t),r.forKind(HU(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new bs);let s=0;for(let o of Is(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&oc(a))i=this.expandIndexValues(i,o,a);else{let d=l.forKind(o.kind);Pr.INSTANCE.writeIndexValue(a,d)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new bs;l.seed(a.encodedBytes()),Pr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof pe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=jl(e),i=ea(e);return(t?r.loadAll(Nv,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return R.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(f6(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:le(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=jl(e),s=ea(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Nv,IDBKeyRange.bound(t,t)).next(a=>R.forEach(a,l=>s.put(EI(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return R.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),R.forEach(l,d=>this.getExistingIndexEntries(e,i,d).next(p=>{let m=this.computeIndexEntries(s,d);return p.isEqual(m)?R.resolve():this.updateEntries(e,s,d,p,m)}))))})}addIndexEntry(e,t,r,i){return Zo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Zo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Zo(e),s=new Oe(Ai);return i.iterate({index:ID,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new _s(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Oe(Ai),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=bb(t);if(s!=null){let o=e.data.field(s.fieldPath);if(oc(o))for(let a of o.arrayValue.values||[])r=r.add(new _s(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new _s(t.indexId,e.key,ch,i));return r}updateEntries(e,t,r,i,s){z(LI,"Updating index entries for document '%s'",t.key);let o=[];return k3(i,s,Ai,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),R.waitFor(o)}getNextSequenceNumber(e){let t=1;return ea(e).iterate({index:AD,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ai(o,a)).filter((o,a,l)=>!a||Ai(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Ai(o,e),l=Ai(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,ch,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,ch,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return Ai(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(VI)}getMinOffset(e,t){return R.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||Q())).next(VI)}};function BI(n){return At(n,tc)}function Zo(n){return At(n,gf)}function jl(n){return At(n,Eb)}function ea(n){return At(n,mf)}function VI(n){te(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;_b(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new En(e.readTime,e.documentKey,t)}function M1(n,e,t){let r=n.store(Fn),i=n.store(ka),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(p,m,y)=>(a++,y.delete()));s.push(l.next(()=>{te(a===1)}));let d=[];for(let p of t.mutations){let m=CD(e,p.key.path,t.batchId);s.push(i.delete(m)),d.push(p.key)}return R.waitFor(s).next(()=>d)}function Lh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw Q();return JSON.stringify(e).length}var Bh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){te(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ii(e).iterate({index:Ss,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=sa(e),o=Ii(e);return o.add({}).next(a=>{te(typeof a=="number");let l=new cc(a,t,r,i),d=r6(this.serializer,this.userId,l),p=[],m=new Oe((y,C)=>le(y.canonicalString(),C.canonicalString()));for(let y of i){let C=CD(this.userId,y.key.path,a);m=m.add(y.key.path.popLast()),p.push(o.put(d)),p.push(s.put(C,e3))}return m.forEach(y=>{p.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),R.waitFor(p).next(()=>l)})}lookupMutationBatch(e,t){return Ii(e).get(t).next(r=>r?(te(r.userId===this.userId),ws(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?R.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Ii(e).iterate({index:Ss,range:i},(o,a,l)=>{a.userId===this.userId&&(te(a.batchId>=r),s=ws(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Oi;return Ii(e).iterate({index:Ss,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Oi],[this.userId,Number.POSITIVE_INFINITY]);return Ii(e).loadAll(Ss,t).next(r=>r.map(i=>ws(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=fh(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return sa(e).iterate({range:i},(o,a,l)=>{let[d,p,m]=o,y=mr(p);if(d!==this.userId||!t.path.isEqual(y)){l.done();return}return Ii(e).get(m).next(C=>{if(!C)throw Q();te(C.userId===this.userId),s.push(ws(this.serializer,C))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Oe(le),i=[];return t.forEach(s=>{let o=fh(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=sa(e).iterate({range:a},(d,p,m)=>{let[y,C,x]=d,O=mr(C);if(y!==this.userId||!s.path.isEqual(O)){m.done();return}r=r.add(x)});i.push(l)}),R.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=fh(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Oe(le);return sa(e).iterate({range:o},(l,d,p)=>{let[m,y,C]=l,x=mr(y);if(m!==this.userId||!r.isPrefixOf(x)){p.done();return}x.length===i&&(a=a.add(C))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Ii(e).get(s).next(o=>{if(o===null)throw Q();te(o.userId===this.userId),r.push(ws(this.serializer,o))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return M1(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();let r=IDBKeyRange.lowerBound(ZU(this.userId)),i=[];return sa(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let d=mr(s[1]);i.push(d)}}).next(()=>{te(i.length===0)})})}containsKey(e,t){return N1(e,this.userId,t)}getMutationQueueMetadata(e){return P1(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Oi,lastStreamToken:""})}};function N1(n,e,t){let r=fh(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return sa(n).iterate({range:s,keysOnly:!0},(a,l,d)=>{let[p,m,y]=a;p===e&&m===i&&(o=!0),d.done()}).next(()=>o)}function F6(n,e){let t=!1;return P1(n).iterateSerial(r=>N1(n,r,e).next(i=>(i&&(t=!0),R.resolve(!i)))).next(()=>t)}function Ii(n){return At(n,Fn)}function sa(n){return At(n,ka)}function P1(n){return At(n,Ac)}var fv=2,ba=class n{constructor(e){this.lastId=e}next(){return this.lastId+=fv,this.lastId}static forTargetCache(){return new n(2-fv)}static forSyncEngine(){return new n(1-fv)}};var fw=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ba(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>re.fromTimestamp(new Qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ta(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(te(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return ta(e).iterate((o,a)=>{let l=$l(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ta(e).iterate((r,i)=>{let s=$l(i);t(s)})}retrieveMetadata(e){return qI(e).get(Eh).next(t=>(te(t!==null),t))}saveMetadata(e,t){return qI(e).put(Eh,t)}saveTargetData(e,t){return ta(e).put(k1(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=xs(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return ta(e).iterate({range:i,index:TD},(o,a,l)=>{let d=$l(a);kc(t,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=ki(e);return t.forEach(o=>{let a=qt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),R.waitFor(i)}removeMatchingKeys(e,t,r){let i=ki(e);return R.forEach(t,s=>{let o=qt(s.path);return R.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=ki(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=ki(e),s=ce();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let d=mr(o[1]),p=new W(d);s=s.add(p)}).next(()=>s)}containsKey(e,t){let r=qt(t.path),i=IDBKeyRange.bound([r],[pD(r)],!1,!0),s=0;return ki(e).iterate({index:Cb,keysOnly:!0,range:i},([o,a],l,d)=>{o!==0&&(s++,d.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return ta(e).get(t).next(r=>r?$l(r):null)}};function ta(n){return At(n,Ra)}function qI(n){return At(n,qs)}function ki(n){return At(n,xa)}var UI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Oc=-1,F1=40*1024*1024,Sn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Sn.DEFAULT_COLLECTION_PERCENTILE=10;Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Sn.DEFAULT=new Sn(F1,Sn.DEFAULT_COLLECTION_PERCENTILE,Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Sn.DISABLED=new Sn(Oc,0,0);var zI="LruGarbageCollector",jI=1*1024*1024,L6=1*60*1e3,B6=5*60*1e3;function GI([n,e],[t,r]){let i=le(n,t);return i===0?le(e,r):i}var pw=class{constructor(e){this.maxElements=e,this.buffer=new Oe(GI),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();GI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},mw=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Oc&&this.scheduleGC(L6)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){z(zI,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>I(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Hi(t)?z(zI,"Ignoring IndexedDB error during garbage collection: ",t):yield Gi(t)}yield this.scheduleGC(B6)}))}},gw=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(ln.INVALID);let r=new pw(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Oc?(z("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(UI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(z("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),UI):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,a=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>{if(d=Date.now(),na()<=Yn.DEBUG){let y=`LRU Garbage Collection
	Counted targets in ${o-p}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${m} documents in ${d-l}ms
Total Duration: ${d-p}ms`;z("LruGarbageCollector",y)}return R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})})}};function V6(n,e){return new gw(n,e)}var yw=class{constructor(e,t){this.db=e,this.garbageCollector=V6(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return uh(e,r)}removeReference(e,t,r){return uh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return uh(e,t)}isPinned(e,t){return F6(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,d)=>{if(d<=t){let p=this.isPinned(e,l).next(m=>{if(!m)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,re.min()),ki(e).delete(q6(l))))});s.push(p)}}).next(()=>R.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return uh(e,t)}forEachOrphanedDocument(e,t){let r=ki(e),i=ln.INVALID,s;return r.iterate({index:Cb},([o,a],{path:l,sequenceNumber:d})=>{o===0?(i!==ln.INVALID&&t(new W(mr(s)),i),i=d,s=l):i=ln.INVALID}).next(()=>{i!==ln.INVALID&&t(new W(mr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function q6(n){return[0,qt(n.path)]}function U6(n,e){return{targetId:0,path:qt(n.path),sequenceNumber:e}}function uh(n,e){return ki(n).put(U6(e,n.currentSequenceNumber))}var Vh=class{constructor(){this.changes=new br(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ht.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var vw=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return gs(e).put(r)}removeEntry(e,t,r){return gs(e).delete(z6(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=ht.newInvalidDocument(t);return gs(e).iterate({index:ph,range:IDBKeyRange.only(Gl(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:ht.newInvalidDocument(t)};return gs(e).iterate({index:ph,range:IDBKeyRange.only(Gl(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:Lh(s)}}).next(()=>r)}getEntries(e,t){let r=en();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=en(),i=new Be(W.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,Lh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return R.resolve();let i=new Oe($I);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Gl(i.first()),Gl(i.last())),o=i.getIterator(),a=o.getNext();return gs(e).iterate({index:ph,range:s},(l,d,p)=>{let m=W.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;a&&$I(a,m)<0;)r(a,null),a=o.getNext();a&&a.isEqual(m)&&(r(a,d),a=o.hasNext()?o.getNext():null),a?p.skip(Gl(a)):p.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),_f(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gs(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let p=en();for(let m of d){let y=this.maybeDecodeDocument(W.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);y.isFoundDocument()&&(xc(t,y)||i.has(y.key))&&(p=p.insert(y.key,y))}return p})}getAllFromCollectionGroup(e,t,r,i){let s=en(),o=WI(t,r),a=WI(t,En.max());return gs(e).iterate({index:ED,range:IDBKeyRange.bound(o,a,!0)},(l,d,p)=>{let m=this.maybeDecodeDocument(W.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(m.key,m),s.size===i&&p.done()}).next(()=>s)}newChangeBuffer(e){return new ww(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return HI(e).get(Mv).next(t=>(te(!!t),t))}setMetadata(e,t){return HI(e).put(Mv,t)}maybeDecodeDocument(e,t){if(t){let r=t6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(re.min())))return r}return ht.newInvalidDocument(e)}};function L1(n){return new vw(n)}var ww=class extends Vh{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new br(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Oe((s,o)=>le(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=CI(this.documentCache.serializer,o);i=i.add(s.path.popLast());let d=Lh(l);r+=d-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=CI(this.documentCache.serializer,o.convertToNoDocument(re.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function HI(n){return At(n,Ic)}function gs(n){return At(n,hf)}function Gl(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function z6(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],_f(e),t[t.length-1]]}function WI(n,e){let t=e.documentKey.path.toArray();return[n,_f(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function $I(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=le(t[s],r[s]),i)return i;return i=le(t.length,r.length),i||(i=le(t[t.length-2],r[r.length-2]),i)?i:le(t[t.length-1],r[r.length-1])}var j6=16;var bw=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var qh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Jl(r.mutation,i,cn.empty(),Qe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ce()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ce()){let i=gr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Wl();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=gr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ce()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=en(),o=ac(),a=P4();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof Vn)?s=s.insert(d.key,d):p!==void 0?(o.set(d.key,p.mutation.getFieldMask()),Jl(p.mutation,d,p.mutation.getFieldMask(),Qe.now())):o.set(d.key,cn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,p)=>o.set(d,p)),t.forEach((d,p)=>{var m;return a.set(d,new bw(p,(m=o.get(d))!==null&&m!==void 0?m:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ac(),i=new Be((o,a)=>o-a),s=ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||cn.empty();p=a.applyToLocalView(d,p),r.set(l,p);let m=(i.get(a.batchId)||ce()).add(l);i=i.insert(a.batchId,m)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),d=l.key,p=l.value,m=r1();p.forEach(y=>{if(!s.has(y)){let C=d1(t.get(y),r.get(y));C!==null&&m.set(y,C),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,m))}return R.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return E4(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Db(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve(gr()),a=da,l=s;return o.next(d=>R.forEach(d,(p,m)=>(a<m.largestBatchId&&(a=m.largestBatchId),s.get(p)?R.resolve():this.remoteDocumentCache.getEntry(e,p).next(y=>{l=l.insert(p,y)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,ce())).next(p=>({batchId:a,changes:n1(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next(r=>{let i=Wl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Wl();return this.indexManager.getCollectionParents(e,s).next(a=>R.forEach(a,l=>{let d=_4(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((m,y)=>{o=o.insert(m,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,d)=>{let p=d.getKey();o.get(p)===null&&(o=o.insert(p,ht.newInvalidDocument(p)))});let a=Wl();return o.forEach((l,d)=>{let p=s.get(l);p!==void 0&&Jl(p.mutation,d,cn.empty(),Qe.now()),xc(t,d)&&(a=a.insert(l,d))}),a})}};var _w=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return R.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,u6(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,c6(t)),R.resolve()}};var Sw=class{constructor(){this.overlays=new Be(W.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){let r=gr();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){let i=gr(),s=t.length+1,o=new W(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let d=a.getNext().value,p=d.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Be((d,p)=>d-p),o=this.overlays.getIterator();for(;o.hasNext();){let p=o.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let y=s.get(p.largestBatchId);y===null&&(y=gr(),s=s.insert(p.largestBatchId,y)),y.set(p.getKey(),p)}}let a=gr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((m,y)=>a.set(m,y)),!(a.size()>=i)););return R.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new uc(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ce(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var gc=class{constructor(){this.refsByKey=new Oe(dt.compareByKey),this.refsByTarget=new Oe(dt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new dt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new dt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new W(new ve([])),r=new dt(t,e),i=new dt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new W(new ve([])),r=new dt(t,e),i=new dt(t,e+1),s=ce();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new dt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},dt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return W.comparator(e.key,t.key)||le(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return le(e.targetOrBatchId,t.targetOrBatchId)||W.comparator(e.key,t.key)}};var Cw=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Oe(dt.compareByKey)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new cc(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Oi:this.nextBatchId-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dt(t,0),i=new dt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Oe(le);return t.forEach(i=>{let s=new dt(i,0),o=new dt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),R.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;W.isDocumentKey(s)||(s=s.child(""));let o=new dt(new W(s),0),a=new Oe(le);return this.batchesByDocumentKey.forEachWhile(l=>{let d=l.key.path;return r.isPrefixOf(d)?(d.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),R.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");te(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return R.forEach(t.mutations,s=>{let o=new dt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new dt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function G6(){return new Be(W.comparator)}var Ew=class{constructor(e){this.sizer=e,this.docs=G6(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():ht.newInvalidDocument(t))}getEntries(e,t){let r=en();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ht.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=en(),o=t.path,a=new W(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||_b(gD(p),r)<=0||!i.has(p.key)&&!xc(t,p)||(s=s.insert(p.key,p.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Q()}forEachDocumentKey(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Tw(this)}getSize(e){return R.resolve(this.size)}};function H6(n){return new Ew(n)}var Tw=class extends Vh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Aw=class{constructor(e){this.persistence=e,this.targets=new br(t=>xs(t),kc),this.lastRemoteSnapshotVersion=re.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new gc,this.targetCount=0,this.targetIdGenerator=ba.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),R.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ba(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.saveTargetData(t),R.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),R.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.references.containsKey(t))}};var W6="MemoryPersistence",Uh=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new ln(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new Aw(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new dw,this.remoteDocumentCache=H6(r),this.serializer=new Mh(t),this.bundleCache=new _w(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Sw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Cw(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){z(W6,"Starting transaction:",e);let i=new Iw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return R.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Iw=class extends Sh{constructor(e){super(),this.currentSequenceNumber=e}},zh=class n{constructor(e){this.persistence=e,this.localViewReferences=new gc,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Q()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),R.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.orphanedDocuments,i=>{let s=W.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,re.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return R.or([()=>R.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var Dw=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new Ch("createOrUpgrade",t);r<1&&i>=1&&(K6(e),Q6(e),KI(e),J6(e));let o=R.resolve();return r<3&&i>=3&&(r!==0&&(e5(e),KI(e)),o=o.next(()=>n5(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>Y6(e,s))),o=o.next(()=>{r5(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(Z6(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{t5(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{i5(e),s5(e)})),r<12&&i>=12&&(o=o.next(()=>{a5(e)})),r<13&&i>=13&&(o=o.next(()=>X6(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(vs))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>o5(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(mf).clear()}).next(()=>{t.objectStore(gf).clear()})),o}addDocumentGlobal(e){let t=0;return e.store(vs).iterate((r,i)=>{t+=Lh(i)}).next(()=>{let r={byteSize:t};return e.store(Ic).put(Mv,r)})}removeAcknowledgedMutations(e){let t=e.store(Ac),r=e.store(Fn);return t.loadAll().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Oi],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Ss,o).next(a=>R.forEach(a,l=>{te(l.userId===s.userId);let d=ws(this.serializer,l);return M1(e,s.userId,d).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(xa),r=e.store(vs);return e.store(qs).get(Eh).next(s=>{let o=l=>t.put({targetId:0,path:qt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,d)=>{let p=new ve(l),m=$6(p);a.push(t.get(m).next(y=>y?R.resolve():o(p)))}).next(()=>R.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(tc,{keyPath:l3});let r=t.store(tc),i=new mc,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:qt(l)})}};return t.store(vs).iterate({keysOnly:!0},(o,a)=>{let l=new ve(o);return s(l.popLast())}).next(()=>t.store(ka).iterate({keysOnly:!0},([o,a,l],d)=>{let p=mr(a);return s(p.popLast())}))}rewriteCanonicalIds(e){let t=e.store(Ra);return t.iterate((r,i)=>{let s=$l(i),o=k1(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(vs),i=[];return r.iterate((s,o)=>{let a=t.store(hf),l=l5(o).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(d))}).next(()=>R.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Fn),i=L1(this.serializer),s=new Uh(zh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var d;let p=(d=a.get(l.userId))!==null&&d!==void 0?d:ce();ws(this.serializer,l).keys().forEach(y=>p=p.add(y)),a.set(l.userId,p)}),R.forEach(a,(l,d)=>{let p=new ft(d),m=Nh.forUser(this.serializer,p),y=s.getIndexManager(p),C=Bh.forUser(p,this.serializer,y,s.referenceDelegate);return new qh(i,C,m,y).recalculateAndSaveOverlaysForDocumentKeys(new nc(t,ln.INVALID),l).next()})})}};function $6(n){return[0,qt(n)]}function K6(n){n.createObjectStore(Tc)}function Q6(n){n.createObjectStore(Ac,{keyPath:XU}),n.createObjectStore(Fn,{keyPath:_D,autoIncrement:!0}).createIndex(Ss,SD,{unique:!0}),n.createObjectStore(ka)}function Y6(n,e){return e.store(Fn).loadAll().next(r=>{n.deleteObjectStore(Fn),n.createObjectStore(Fn,{keyPath:_D,autoIncrement:!0}).createIndex(Ss,SD,{unique:!0});let s=e.store(Fn),o=r.map(a=>s.put(a));return R.waitFor(o)})}function J6(n){n.createObjectStore(vs)}function X6(n){let e=n.createObjectStore(hf,{keyPath:t3});e.createIndex(ph,n3),e.createIndex(ED,r3)}function Z6(n){n.createObjectStore(Ic)}function KI(n){n.createObjectStore(xa,{keyPath:o3}).createIndex(Cb,a3,{unique:!0}),n.createObjectStore(Ra,{keyPath:i3}).createIndex(TD,s3,{unique:!0}),n.createObjectStore(qs)}function e5(n){n.deleteObjectStore(xa),n.deleteObjectStore(Ra),n.deleteObjectStore(qs)}function t5(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function n5(n){let e=n.store(qs),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:re.min().toTimestamp(),targetCount:0};return e.put(Eh,t)}function r5(n){n.createObjectStore(ha,{keyPath:c3})}function i5(n){n.createObjectStore(ff,{keyPath:u3})}function s5(n){n.createObjectStore(pf,{keyPath:d3})}function o5(n){n.createObjectStore(Eb,{keyPath:h3,autoIncrement:!0}).createIndex(Nv,f3,{unique:!1}),n.createObjectStore(mf,{keyPath:p3}).createIndex(AD,m3,{unique:!1}),n.createObjectStore(gf,{keyPath:g3}).createIndex(ID,y3,{unique:!1})}function a5(n){let e=n.createObjectStore(yf,{keyPath:v3});e.createIndex(Pv,w3,{unique:!1}),e.createIndex(DD,b3,{unique:!1})}function l5(n){return n.document?new W(ve.fromString(n.document.name).popFirst(5)):n.noDocument?W.fromSegments(n.noDocument.path):n.unknownDocument?W.fromSegments(n.unknownDocument.path):Q()}var Di="IndexedDbPersistence",pv=30*60*1e3,mv=5e3,c5=4e3,gv="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",u5="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",d5="firestore_zombie",B1="main",kw=class n{constructor(e,t,r,i,s,o,a,l,d,p,m=j6){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=d,this.forceOwningTab=p,this.schemaVersion=m,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=y=>Promise.resolve(),!n.isAvailable())throw new L(M.UNIMPLEMENTED,u5);this.referenceDelegate=new yw(this,i),this.dbName=t+B1,this.serializer=new Mh(l),this.simpleDb=new Ni(this.dbName,this.schemaVersion,new Dw(this.serializer)),this.targetCache=new fw(this.referenceDelegate,this.serializer),this.remoteDocumentCache=L1(this.serializer),this.bundleCache=new ow,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,p===!1&&Ke(Di,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new L(M.FAILED_PRECONDITION,gv);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new ln(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>I(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>I(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>I(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Hi(e))return z(Di,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return z(Di,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Hl(e).get(Qo).next(r=>R.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return dh(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return I(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,pv)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=At(t,ha);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,pv),o=i.filter(a=>s.indexOf(a)===-1);return R.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",c5,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?R.resolve(!0):Hl(e).get(Qo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,mv)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new L(M.FAILED_PRECONDITION,gv);return!1}}return this.networkEnabled&&this.inForeground?!0:dh(e).loadAll().next(s=>this.filterActiveClients(s,mv).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,d=!this.inForeground&&a.inForeground,p=this.networkEnabled===a.networkEnabled;if(l||d&&p)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&z(Di,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return I(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Tc,ha],e=>{let t=new nc(e,ln.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>dh(e).loadAll().next(t=>this.filterActiveClients(t,pv).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return Bh.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new hw(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Nh.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){z(Di,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=D3(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new nc(a,this.listenSequence?this.listenSequence.next():ln.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new L(M.FAILED_PRECONDITION,yD);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Hl(e).get(Qo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,mv)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new L(M.FAILED_PRECONDITION,gv)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Hl(e).put(Qo,t)}static isAvailable(){return Ni.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Hl(e);return t.get(Qo).next(r=>this.isLocalClient(r)?(z(Di,"Releasing primary lease."),t.delete(Qo)):R.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ke(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Ip()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return z(Di,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ke(Di,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ke("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${d5}_${this.persistenceKey}_${e}`}};function Hl(n){return At(n,Tc)}function dh(n){return At(n,ha)}function Fb(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function h5(n){return I(this,null,function*(){if(!Ni.isAvailable())return Promise.resolve();let e=n+B1;yield Ni.delete(e)})}var Lb="LocalStore",f5=5*60*1e6,yc=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Be(le),this.targetIdByTarget=new br(s=>xs(s),kc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new qh(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function V1(n,e,t,r){return new yc(n,e,t,r)}function q1(n,e){return I(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],d=ce();for(let p of s){a.push(p.batchId);for(let m of p.mutations)d=d.add(m.key)}for(let p of o){l.push(p.batchId);for(let m of p.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(i,d).next(p=>({affectedDocuments:p,removedBatchIds:a,addedBatchIds:l}))})})})}function p5(n,e){let t=$(n),r=Qe.now(),i=e.reduce((a,l)=>a.add(l.key),ce()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=en(),d=ce();return t.remoteDocuments.getEntries(a,i).next(p=>{l=p,l.forEach((m,y)=>{y.isValidDocument()||(d=d.add(m))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(p=>{s=p;let m=[];for(let y of e){let C=$4(y,s.get(y.key).overlayedDocument);C!=null&&m.push(new Vn(y.key,C,zD(C.value.mapValue),et.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,m,e)}).next(p=>{o=p;let m=p.applyToLocalDocumentSet(s,d);return t.documentOverlayCache.saveOverlays(a,p.batchId,m)})}).then(()=>({batchId:o.batchId,changes:n1(s)}))}function m5(n,e){let t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return T5(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,g5(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function g5(n){let e=ce();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function y5(n,e){let t=$(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(te(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function v5(n){let e=$(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function U1(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function w5(n,e){let t=$(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((p,m)=>{let y=i.get(m);if(!y)return;a.push(t.targetCache.removeMatchingKeys(s,p.removedDocuments,m).next(()=>t.targetCache.addMatchingKeys(s,p.addedDocuments,m)));let C=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?C=C.withResumeToken(Tt.EMPTY_BYTE_STRING,re.min()).withLastLimboFreeSnapshotVersion(re.min()):p.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(p.resumeToken,r)),i=i.insert(m,C),b5(y,C,p)&&a.push(t.targetCache.updateTargetData(s,C))});let l=en(),d=ce();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),a.push(z1(s,o,e.documentUpdates).next(p=>{l=p.changedDocuments,d=p.existenceChangedKeys})),!r.isEqual(re.min())){let p=t.targetCache.getLastRemoteSnapshotVersion(s).next(m=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(p)}return R.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function z1(n,e,t){let r=ce(),i=ce();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=en();return t.forEach((a,l)=>{let d=s.get(a);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(re.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):z(Lb,"Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function b5(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=f5?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function _5(n,e){return I(this,null,function*(){let t=$(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>R.forEach(e,i=>R.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>R.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Hi(r))z(Lb,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function S5(n,e){let t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Oi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function C5(n,e){let t=$(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function _a(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new wa(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function E5(n,e,t){let r=$(n),i=r.targetIdByTarget.get(t);return i!==void 0?R.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function Sa(n,e,t){return I(this,null,function*(){let r=$(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Hi(o))z(Lb,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function Sf(n,e,t){let r=$(n),i=re.min(),s=ce();return r.persistence.runTransaction("Execute query","readwrite",o=>E5(r,o,Ut(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:re.min(),t?s:ce())).next(a=>(H1(r,ZD(e),a),{documents:a,remoteKeys:s})))}function T5(n,e,t,r){let i=t.batch,s=i.keys(),o=R.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let d=t.docVersions.get(a);te(d!==null),l.version.compareTo(d)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function A5(n,e){let t=$(n),r=$(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):R.resolve(null)))}function I5(n,e){$($(n,yc).mutationQueue).removeCachedMutationKeys(e)}function D5(n){return $($(n,yc).persistence).getActiveClients()}function j1(n,e){let t=$(n),r=$(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function G1(n,e){let t=$(n),r=t.collectionGroupReadTime.get(e)||re.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,mD(r,da),Number.MAX_SAFE_INTEGER)).then(i=>(H1(t,e,i),i))}function H1(n,e,t){let r=n.collectionGroupReadTime.get(e)||re.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function k5(n){return Ut(Oa(ve.fromString(`__bundle__/docs/${n}`)))}function R5(n,e,t,r){return I(this,null,function*(){let i=$(n),s=ce(),o=en();for(let d of t){let p=e.toDocumentKey(d.metadata.name);d.document&&(s=s.add(p));let m=e.toMutableDocument(d);m.setReadTime(e.toSnapshotVersion(d.metadata.readTime)),o=o.insert(p,m)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield _a(i,k5(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>z1(d,a,o).next(p=>(a.apply(d),p)).next(p=>i.targetCache.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.targetCache.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,p.changedDocuments,p.existenceChangedKeys)).next(()=>p.changedDocuments)))})}function x5(n,e){let t=$(n),r=lt(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function O5(n,e){let t=$(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function M5(n,e){let t=$(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function N5(r,i){return I(this,arguments,function*(n,e,t=ce()){let s=yield _a(n,Ut(Ob(e.bundledQuery))),o=$(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=lt(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let d=s.withResumeToken(Tt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(d.targetId,d),o.targetCache.updateTargetData(a,d).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Rw=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var P5=100;function F5(){return Ip()?8:vD(rl())>0?6:4}var jh=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=P5,this.relativeIndexReadCostPerDocument=F5()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Rw;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(na()<=Yn.DEBUG&&z("QueryEngine","SDK will not create cache indexes for query:",ra(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),R.resolve()):(na()<=Yn.DEBUG&&z("QueryEngine","Query:",ra(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(na()<=Yn.DEBUG&&z("QueryEngine","The SDK decides to create cache indexes for query:",ra(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ut(t))):R.resolve())}performQueryUsingIndex(e,t){if(mI(t))return R.resolve(null);let r=Ut(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=kh(t,null,"F"),r=Ut(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ce(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.applyQuery(t,a);return this.needsRefill(t,d,o,l.readTime)?this.performQueryUsingIndex(e,kh(t,null,"F")):this.appendRemainingResults(e,d,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return mI(t)||i.isEqual(re.min())?R.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?R.resolve(null):(na()<=Yn.DEBUG&&z("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ra(t)),this.appendRemainingResults(e,o,t,mD(i,da)).next(a=>a))})}applyQuery(e,t){let r=new Oe(e1(e));return t.forEach((i,s)=>{xc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return na()<=Yn.DEBUG&&z("QueryEngine","Using full collection scan to execute query:",ra(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,En.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var W1="firestore_clients";function QI(n,e){return`${W1}_${n}_${e}`}var $1="firestore_mutations";function YI(n,e,t){let r=`${$1}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var K1="firestore_targets";function yv(n,e){return`${K1}_${n}_${e}`}var L5="firestore_online_state";function B5(n){return`${L5}_${n}`}var V5="firestore_bundle_loaded_v2";function q5(n){return`${V5}_${n}`}var U5="firestore_sequence_number";function z5(n){return`${U5}_${n}`}var pr="SharedClientState",Gh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new L(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ke(pr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Xl=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new L(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ke(pr,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Hh=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Rb();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=VD(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ke(pr,`Failed to parse client data for instance '${e}': ${t}`),null)}},xw=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ke(pr,`Failed to parse online state: ${e}`),null)}},vc=class{constructor(){this.activeTargetIds=Rb()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Zl=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Be(le),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=QI(this.persistenceKey,this.localClientId),this.sequenceNumberKey=z5(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new vc),this.clientStateKeyRe=new RegExp(`^${W1}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${$1}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${K1}_${o}_(\\d+)$`),this.onlineStateKey=B5(this.persistenceKey),this.bundleLoadedKey=q5(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return I(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(QI(this.persistenceKey,r));if(i){let s=Hh.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(yv(this.persistenceKey,e));if(r){let i=Xl.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yv(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return z(pr,"READ",e,t),t}setItem(e,t){z(pr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){z(pr,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(z(pr,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ke("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>I(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=j5(t.newValue);r!==ln.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Gh(this.currentUser,e,t,r),s=YI(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=YI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=yv(this.persistenceKey,e),s=new Xl(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Hh.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Gh.fromWebStorageEntry(new ft(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Xl.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return xw.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return I(this,null,function*(){if(e.user.uid!==this.currentUser.uid){z(pr,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Rb();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function j5(n){let e=ln.INVALID;if(n!=null)try{let t=JSON.parse(n);te(typeof t=="number"),e=t}catch(t){Ke(pr,"Failed to read sequence number from WebStorage",t)}return e}var Wh=class{constructor(){this.localState=new vc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new vc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Ow=class{addCallback(e){}shutdown(){}};var Mw=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var hh=null;function G5(){return 268435456+Math.round(2147483648*Math.random())}function vv(){return hh===null?hh=G5():hh++,"0x"+hh.toString(16)}function H5(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var W5="1.9.1",Vt="GrpcConnection",$5=`gl-node/${process.versions.node} fire/${Da} grpc/${W5}`;function wv(n,e,t,r){te(e===null||e.type==="OAuth");let i=new Ts.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",$5),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Nw=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){z(Vt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Ts.credentials.createSsl():Ts.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=vv(),a=this.ensureActiveStub(),l=wv(this.databasePath,i,s,this.databaseInfo.appId),d=Object.assign({database:this.databasePath},r);return H5(p=>(z(Vt,`RPC '${e}' ${o} invoked with request:`,r),a[e](d,l,(m,y)=>{m?(z(Vt,`RPC '${e}' ${o} failed with error:`,m),p(new L(yh(m.code),m.message))):(z(Vt,`RPC '${e}' ${o} completed with response:`,y),p(void 0,y))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=vv(),l=[],d=new at;z(Vt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let p=this.ensureActiveStub(),m=wv(this.databasePath,i,s,this.databaseInfo.appId),y=Object.assign(Object.assign({},r),{database:this.databasePath}),C=p[e](y,m),x=!1;return C.on("data",O=>{z(Vt,`RPC ${e} ${a} received result:`,O),l.push(O),o!==void 0&&l.length===o&&(x=!0,d.resolve(l))}),C.on("end",()=>{z(Vt,`RPC '${e}' ${a} completed.`),x||(x=!0,d.resolve(l))}),C.on("error",O=>{z(Vt,`RPC '${e}' ${a} failed with error:`,O);let k=yh(O.code);d.reject(new L(k,O.message))}),d.promise}openStream(e,t,r){let i=vv(),s=this.ensureActiveStub(),o=wv(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,d=y=>{l||(l=!0,p.callOnClose(y),a.end())},p=new Mw({sendFn:y=>{if(l)z(Vt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,y);else{z(Vt,`RPC '${e}' stream ${i} sending:`,y);try{a.write(y)}catch(C){throw Ke("Failure sending:",y),Ke("Error:",C),C}}},closeFn:()=>{z(Vt,`RPC '${e}' stream ${i} closed locally via close().`),d()}}),m=!1;return a.on("data",y=>{l||(z(Vt,`RPC '${e}' stream ${i} received:`,y),m||(p.callOnConnected(),m=!0),p.callOnMessage(y))}),a.on("end",()=>{z(Vt,`RPC '${e}' stream ${i} ended.`),d()}),a.on("error",y=>{if(!l){Cn(Vt,`RPC '${e}' stream ${i} error. Code:`,y.code,"Message:",y.message);let C=yh(y.code);d(new L(C,y.message))}}),z(Vt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{p.callOnOpen()},0),p}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},Q1={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},K5={nested:Q1},Q5=Object.freeze({__proto__:null,nested:Q1,default:K5});var Y5={longs:String,enums:String,defaults:!0,oneofs:!1};function J5(){let n=dD.fromJSON(Q5,Y5);return Ts.loadPackageDefinition(n)}function X5(n){let e=J5();return new Nw(e,n)}function Z5(){return new Ow}function Y1(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function ej(){return null}function Mc(n){return new tw(n,!1)}var tj="ExponentialBackoff",nj=1e3,rj=1.5,ij=60*1e3,wc=class{constructor(e,t,r=nj,i=rj,s=ij){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&z(tj,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var JI="PersistentStream",sj=60*1e3,oj=10*1e3,$h=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new wc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return I(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,sj,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return I(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return I(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(Ke(t.toString()),Ke("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new L(M.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,oj,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>I(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return z(JI,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(z(JI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Pw=class extends $h{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=vz(this.serializer,e),r=bz(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=iw(this.serializer),t.addTarget=xz(this.serializer,e);let r=kz(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=iw(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Fw=class extends $h{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=Ez(e.writeResults,e.commitTime),r=lt(e.commitTime);return this.listener.onMutationResult(r,t)}else return te(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=iw(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>pc(this.serializer,r))};this.sendRequest(t)}};var Lw=class{},Bw=class extends Lw{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new L(M.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,rw(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new L(M.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,rw(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new L(M.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function aj(n,e,t,r){return new Bw(n,e,t,r)}function lj(n,e){return I(this,null,function*(){let t=$(n),r={writes:e.map(i=>pc(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ve.emptyPath(),r)})}function cj(n,e){return I(this,null,function*(){let t=$(n),r={documents:e.map(a=>fc(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ve.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=yz(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());te(!!l),o.push(l)}),o})}function uj(n,e,t){let r=$(n);return r.verifyInitialized(),new Fw(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function dj(n,e,t){let r=$(n);return r.verifyInitialized(),new Pw(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var hj="OnlineStateTracker",XI=1,ZI=10*1e3,Vw=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",ZI,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${ZI/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=XI&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${XI} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ke(t),this.shouldWarnClientIsOffline=!1):z(hj,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Ps="RemoteStore",fj=10,qw=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>I(this,null,function*(){Wi(this)&&(z(Ps,"Restarting streams for network reachability change."),yield xj(this))}))}),this.onlineStateTracker=new Vw(r,i)}};function pj(n,e,t,r,i){return new qw(n,e,t,r,i)}function mj(n){let e=$(n);return e.offlineCauses.delete(0),Nc(e)}function Nc(n){return I(this,null,function*(){if(Wi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function gj(n){return I(this,null,function*(){let e=$(n);e.offlineCauses.add(0),yield Ma(e),e.onlineStateTracker.set("Offline")})}function Ma(n){return I(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function yj(n){return I(this,null,function*(){let e=$(n);z(Ps,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ma(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Cf(n,e){let t=$(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),qb(t)?Vb(t):Fa(t).isOpen()&&Bb(t,e))}function Na(n,e){let t=$(n),r=Fa(t);t.listenTargets.delete(e),r.isOpen()&&J1(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Wi(t)&&t.onlineStateTracker.set("Unknown"))}function Bb(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(re.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Fa(n).watch(e)}function J1(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Fa(n).unwatch(e)}function Vb(n){n.watchChangeAggregator=new ew({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Fa(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function qb(n){return Wi(n)&&!Fa(n).isStarted()&&n.listenTargets.size>0}function Wi(n){return $(n).offlineCauses.size===0}function X1(n){n.watchChangeAggregator=void 0}function vj(n){return I(this,null,function*(){n.onlineStateTracker.set("Online")})}function wj(n){return I(this,null,function*(){n.listenTargets.forEach((e,t)=>{Bb(n,e)})})}function bj(n,e){return I(this,null,function*(){X1(n),qb(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),Vb(n)):n.onlineStateTracker.set("Unknown")})}function _j(n,e,t){return I(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof xh&&e.state===2&&e.cause){try{yield Cj(n,e)}catch(r){z(Ps,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Kh(n,r)}return}if(e instanceof ua?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Rh?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(re.min()))try{let r=yield U1(n.localStore);t.compareTo(r)>=0&&(yield Sj(n,t))}catch(r){z(Ps,"Failed to raise snapshot:",r),yield Kh(n,r)}})}function Kh(n,e,t){return I(this,null,function*(){if(Hi(e))n.offlineCauses.add(1),yield Ma(n),n.onlineStateTracker.set("Offline"),t||(t=()=>U1(n.localStore)),n.asyncQueue.enqueueRetryable(()=>I(this,null,function*(){z(Ps,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Nc(n)}));else throw e})}function Z1(n,e){return e().catch(t=>Kh(n,t,e))}function Sj(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Tt.EMPTY_BYTE_STRING,s.snapshotVersion)),J1(n,r);let o=new wa(s.target,r,i,s.sequenceNumber);Bb(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function Cj(n,e){return I(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function Pa(n){return I(this,null,function*(){let e=$(n),t=$i(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Oi;for(;Ej(e);)try{let i=yield S5(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,Tj(e,i)}catch(i){yield Kh(e,i)}ek(e)&&tk(e)})}function Ej(n){return Wi(n)&&n.writePipeline.length<fj}function Tj(n,e){n.writePipeline.push(e);let t=$i(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function ek(n){return Wi(n)&&!$i(n).isStarted()&&n.writePipeline.length>0}function tk(n){$i(n).start()}function Aj(n){return I(this,null,function*(){$i(n).writeHandshake()})}function Ij(n){return I(this,null,function*(){let e=$i(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function Dj(n,e,t){return I(this,null,function*(){let r=n.writePipeline.shift(),i=Yv.from(r,e,t);yield Z1(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Pa(n)})}function kj(n,e){return I(this,null,function*(){e&&$i(n).handshakeComplete&&(yield Rj(n,e)),ek(n)&&tk(n)})}function Rj(n,e){return I(this,null,function*(){if(ez(e.code)){let t=n.writePipeline.shift();$i(n).inhibitBackoff(),yield Z1(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Pa(n)}})}function xj(n){return I(this,null,function*(){let e=$(n);e.offlineCauses.add(4),yield Ma(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Nc(e)})}function eD(n,e){return I(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),z(Ps,"RemoteStore received new credentials");let r=Wi(t);t.offlineCauses.add(3),yield Ma(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Nc(t)})}function Uw(n,e){return I(this,null,function*(){let t=$(n);e?(t.offlineCauses.delete(2),yield Nc(t)):e||(t.offlineCauses.add(2),yield Ma(t),t.onlineStateTracker.set("Unknown"))})}function Fa(n){return n.watchStream||(n.watchStream=dj(n.datastore,n.asyncQueue,{onConnected:vj.bind(null,n),onOpen:wj.bind(null,n),onClose:bj.bind(null,n),onWatchChange:_j.bind(null,n)}),n.onNetworkStatusChange.push(e=>I(this,null,function*(){e?(n.watchStream.inhibitBackoff(),qb(n)?Vb(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),X1(n))}))),n.watchStream}function $i(n){return n.writeStream||(n.writeStream=uj(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:Aj.bind(null,n),onClose:kj.bind(null,n),onHandshakeComplete:Ij.bind(null,n),onMutationResult:Dj.bind(null,n)}),n.onNetworkStatusChange.push(e=>I(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Pa(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(z(Ps,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var Oj="AsyncQueue",zw=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new at,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function La(n,e){if(Ke(Oj,`${e}: ${n}`),Hi(n))return new L(M.UNAVAILABLE,`${e}: ${n}`);throw n}var Qh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||W.comparator(t.key,r.key):this.comparator=(t,r)=>W.comparator(t.key,r.key),this.keyedMap=Wl(),this.sortedSet=new Be(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Yh=class{constructor(){this.changeMap=new Be(W.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):Q()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},Ca=class n{constructor(e,t,r,i,s,o,a,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Qh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Rc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var jw=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function Mj(){return new Gw}var Gw=class{constructor(){this.queries=new br(e=>XD(e),Rc),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function Ub(n,e){return I(this,null,function*(){let t=$(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new jw,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=La(o,`Initialization of query '${ra(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&jb(t)})}function zb(n,e){return I(this,null,function*(){let t=$(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Nj(n,e){let t=$(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&jb(t)}function Pj(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function Fj(n,e){let t=$(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&jb(t)}function Lj(n,e){$(n).snapshotsInSyncListeners.add(e),e.next()}function Bj(n,e){$(n).snapshotsInSyncListeners.delete(e)}function jb(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var nk=function(n){return n.Default="default",n.Cache="cache",n}(nk||{}),bc=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ca(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=Ca.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==nk.Cache}};var Hw=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ce(),i=ce();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Jh=class{constructor(e){this.serializer=e}toDocumentKey(e){return yr(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?S1(this.serializer,e.document,!1):ht.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return lt(e)}},Ww=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=rk(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ve.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Jh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ce()).add(s);t.set(o,a)}}return t}complete(){return I(this,null,function*(){let e=yield R5(this.localStore,new Jh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield N5(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function rk(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function Vj(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Xh=class{constructor(e){this.key=e}},Zh=class{constructor(e){this.key=e}},ef=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ce(),this.mutatedKeys=ce(),this.docComparator=e1(e),this.documentSet=new Qh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Yh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,m)=>{let y=i.get(p),C=xc(this.query,m)?m:null,x=y?this.mutatedKeys.has(y.key):!1,O=C?C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations:!1,k=!1;y&&C?y.data.isEqual(C.data)?x!==O&&(r.track({type:3,doc:C}),k=!0):this.shouldWaitForSyncedDocument(y,C)||(r.track({type:2,doc:C}),k=!0,(l&&this.docComparator(C,l)>0||d&&this.docComparator(C,d)<0)&&(a=!0)):!y&&C?(r.track({type:0,doc:C}),k=!0):y&&!C&&(r.track({type:1,doc:y}),k=!0,(l||d)&&(a=!0)),k&&(C?(o=o.add(C),O?s=s.add(p):s=s.delete(p)):(o=o.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let p=this.query.limitType==="F"?o.last():o.first();o=o.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((m,y)=>qj(m.type,y.type)||this.docComparator(m.doc,y.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],d=this.limboDocuments.size===0&&this.current&&!i?1:0,p=d!==this.syncState;return this.syncState=d,o.length===0&&!p?{limboChanges:a}:{snapshot:new Ca(this.query,e.documentSet,s,o,e.mutatedKeys,d===0,p,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Yh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ce(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Zh(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Xh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ce();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return Ca.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function qj(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return Q()}};return t(n)-t(e)}var Ki="SyncEngine",$w=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Kw=class{constructor(e){this.key=e,this.receivedDocument=!1}},Qw=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new br(a=>XD(a),Rc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Be(W.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new gc,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ba.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function Uj(n,e,t,r,i,s,o){let a=new Qw(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function zj(n,e,t=!0){return I(this,null,function*(){let r=Ef(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield ik(r,e,t,!0),i})}function jj(n,e){return I(this,null,function*(){let t=Ef(n);yield ik(t,e,!0,!1)})}function ik(n,e,t,r){return I(this,null,function*(){let i=yield _a(n.localStore,Ut(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Gb(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Cf(n.remoteStore,i),a})}function Gb(n,e,t,r,i){return I(this,null,function*(){n.applyDocChanges=(m,y,C)=>e9(n,m,y,C);let s=yield Sf(n.localStore,e,!0),o=new ef(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=hc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=o.applyChanges(a,n.isPrimaryClient,l);$b(n,t,d.limboChanges);let p=new $w(e,t,o);return n.queryViewsByQuery.set(e,p),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),d.snapshot})}function Gj(n,e,t){return I(this,null,function*(){let r=$(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Rc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Sa(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Na(r.remoteStore,i.targetId),Ea(r,i.targetId)}).catch(Gi))):(Ea(r,i.targetId),yield Sa(r.localStore,i.targetId,!0))})}function Hj(n,e){return I(this,null,function*(){let t=$(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Na(t.remoteStore,r.targetId))})}function Wj(n,e,t){return I(this,null,function*(){let r=Qb(n);try{let i=yield p5(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),Xj(r,i.batchId,t),yield zr(r,i.changes),yield Pa(r.remoteStore)}catch(i){let s=La(i,"Failed to persist write");t.reject(s)}})}function sk(n,e){return I(this,null,function*(){let t=$(n);try{let r=yield w5(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?te(o.receivedDocument):i.removedDocuments.size>0&&(te(o.receivedDocument),o.receivedDocument=!1))}),yield zr(t,r,e)}catch(r){yield Gi(r)}})}function tD(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),Fj(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $j(n,e,t){return I(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Be(W.comparator);o=o.insert(s,ht.newNoDocument(s,re.min()));let a=ce().add(s),l=new dc(re.min(),new Map,new Be(le),o,a);yield sk(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),Kb(r)}else yield Sa(r.localStore,e,!1).then(()=>Ea(r,e,t)).catch(Gi)})}function Kj(n,e){return I(this,null,function*(){let t=$(n),r=e.batch.batchId;try{let i=yield m5(t.localStore,e);Wb(t,r,null),Hb(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield zr(t,i)}catch(i){yield Gi(i)}})}function Qj(n,e,t){return I(this,null,function*(){let r=$(n);try{let i=yield y5(r.localStore,e);Wb(r,e,t),Hb(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield zr(r,i)}catch(i){yield Gi(i)}})}function Yj(n,e){return I(this,null,function*(){let t=$(n);Wi(t.remoteStore)||z(Ki,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield v5(t.localStore);if(r===Oi){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=La(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Hb(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function Jj(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new L(M.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Xj(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Be(le)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function Wb(n,e,t){let r=$(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Ea(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||ok(n,i)})}function ok(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Na(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),Kb(n))}function $b(n,e,t){for(let r of t)r instanceof Xh?(n.limboDocumentRefs.addReference(r.key,e),Zj(n,r)):r instanceof Zh?(z(Ki,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||ok(n,r.key)):Q()}function Zj(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(z(Ki,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),Kb(n))}function Kb(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new W(ve.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new Kw(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),Cf(n.remoteStore,new wa(Ut(Oa(t.path)),r,"TargetPurposeLimboResolution",ln.INVALID))}}function zr(n,e,t){return I(this,null,function*(){let r=$(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let m=d?!d.fromCache:(p=t?.targetChanges.get(l.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(l.targetId,m?"current":"not-current")}if(d){i.push(d);let m=Hw.fromSnapshot(l.targetId,d);s.push(m)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield _5(r.localStore,s))})}function e9(n,e,t,r){return I(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield Sf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return $b(n,e.targetId,a.limboChanges),a.snapshot})}function t9(n,e){return I(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){z(Ki,"User change. New user:",e.toKey());let i=yield q1(t.localStore,e);t.currentUser=e,Jj(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield zr(t,i.affectedDocuments)}})}function n9(n,e){let t=$(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ce().add(r.key);{let i=ce(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function r9(n,e){return I(this,null,function*(){let t=$(n),r=yield Sf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&$b(t,e.targetId,i.limboChanges),i})}function i9(n,e){return I(this,null,function*(){let t=$(n);return G1(t.localStore,e).then(r=>zr(t,r))})}function s9(n,e,t,r){return I(this,null,function*(){let i=$(n),s=yield A5(i.localStore,e);if(s===null){z(Ki,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield Pa(i.remoteStore):t==="acknowledged"||t==="rejected"?(Wb(i,e,r||null),Hb(i,e),I5(i.localStore,e)):Q(),yield zr(i,s)})}function o9(n,e){return I(this,null,function*(){let t=$(n);if(Ef(t),Qb(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield nD(t,r.toArray());t._isPrimaryClient=!0,yield Uw(t.remoteStore,!0);for(let s of i)Cf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Ea(t,o),Sa(t.localStore,o,!0))),Na(t.remoteStore,o)}),yield i,yield nD(t,r),a9(t),t._isPrimaryClient=!1,yield Uw(t.remoteStore,!1)}})}function a9(n){let e=$(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Na(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Be(W.comparator)}function nD(n,e,t){return I(this,null,function*(){let r=$(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield _a(r.localStore,Ut(l[0]));for(let d of l){let p=r.queryViewsByQuery.get(d),m=yield r9(r,p);m.snapshot&&s.push(m.snapshot)}}else{let d=yield j1(r.localStore,o);a=yield _a(r.localStore,d),yield Gb(r,ak(d),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function ak(n){return JD(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function l9(n){let e=$(n);return D5(e.localStore)}function c9(n,e,t,r){return I(this,null,function*(){let i=$(n);if(i._isPrimaryClient){z(Ki,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield G1(i.localStore,ZD(s[0])),a=dc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Tt.EMPTY_BYTE_STRING);yield zr(i,o,a);break}case"rejected":{yield Sa(i.localStore,e,!0),Ea(i,e,r);break}default:Q()}})}function u9(n,e,t){return I(this,null,function*(){let r=Ef(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){z(Ki,"Adding an already active target "+i);continue}let o=yield j1(r.localStore,i),a=yield _a(r.localStore,o);yield Gb(r,ak(o),a.targetId,!1,a.resumeToken),Cf(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield Sa(r.localStore,i,!1).then(()=>{Na(r.remoteStore,i),Ea(r,i)}).catch(Gi))}})}function Ef(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=sk.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=n9.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$j.bind(null,e),e.syncEngineListener.onWatchChange=Nj.bind(null,e.eventManager),e.syncEngineListener.onWatchError=Pj.bind(null,e.eventManager),e}function Qb(n){let e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qj.bind(null,e),e}function d9(n,e,t){let r=$(n);h9(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function h9(n,e,t){return I(this,null,function*(){try{let r=yield e.getMetadata();if(yield x5(n.localStore,r))return yield e.close(),t._completeWith(Vj(r)),Promise.resolve(new Set);t._updateProgress(rk(r));let s=new Ww(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield zr(n,a.changedDocs,void 0),yield O5(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return Cn(Ki,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var _c=class{constructor(){this.synchronizeTabs=!1}initialize(e){return I(this,null,function*(){this.serializer=Mc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return V1(this.persistence,new jh,e.initialUser,this.serializer)}createPersistence(e){return new Uh(zh.factory,this.serializer)}createSharedClientState(e){return new Wh}terminate(){return I(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var tf=class n extends _c{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return I(this,null,function*(){yield dp(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield Qb(this.onlineComponentProvider.syncEngine),yield Pa(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return V1(this.persistence,new jh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new mw(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new xv(t,this.persistence);return new Rv(e.asyncQueue,r)}createPersistence(e){let t=Fb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Sn.withCacheSize(this.cacheSizeBytes):Sn.DEFAULT;return new kw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Y1(),ej(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Wh}},Yw=class n extends tf{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return I(this,null,function*(){yield dp(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Zl&&(this.sharedClientState.syncEngine={applyBatchState:s9.bind(null,t),applyTargetState:c9.bind(null,t),applyActiveTargetsChange:u9.bind(null,t),getActiveClients:l9.bind(null,t),synchronizeWithChangedDocuments:i9.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>I(this,null,function*(){yield o9(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=Y1();if(!Zl.isAvailable(t))throw new L(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Fb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Zl(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Sc=class{initialize(e,t){return I(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>tD(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=t9.bind(null,this.syncEngine),yield Uw(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return Mj()}createDatastore(e){let t=Mc(e.databaseInfo.databaseId),r=X5(e.databaseInfo);return aj(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return pj(this.localStore,this.datastore,e.asyncQueue,t=>tD(this.syncEngine,t,0),Z5())}createSyncEngine(e,t){return Uj(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return I(this,null,function*(){var e;yield yj(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var f9=10240;function p9(n,e=f9){let t=0;return{read(){return I(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return I(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function Yb(n,e,t){if(!t)throw new L(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Jb(n,e,t,r){if(e===!0&&r===!0)throw new L(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function rD(n){if(!W.isDocumentKey(n))throw new L(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function iD(n){if(W.isDocumentKey(n))throw new L(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function m9(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Pc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=g9(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":Q()}function g9(n){return n.constructor?n.constructor.name:null}function we(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Pc(n);throw new L(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function lk(n,e){if(e<=0)throw new L(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function y9(n,e){if(!(n instanceof Uint8Array))throw new L(M.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Pc(n)}`);return p9(n,e)}var Ta=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ke("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Jw=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var Xw=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new at,this.buffer=new Uint8Array,this.textDecoder=tz(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return I(this,null,function*(){return this.metadata.promise})}nextElement(){return I(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return I(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new Jw(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return I(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return I(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return I(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function v9(n,e){return new Xw(n,e)}var Zw=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return I(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new L(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield cj(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ui(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return I(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=W.fromPath(r);this.mutations.push(new lc(i,this.precondition(i)))}),yield lj(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=re.min();else throw Q();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new L(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(re.min())?et.exists(!1):et.updateTime(t):et.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(re.min()))throw new L(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return et.updateTime(t)}else return et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var eb=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new wc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>I(this,null,function*(){let e=new Zw(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Dc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!m1(t)}return!1}};var zi="FirestoreClient",w9=100,b9=11,_9=20,S9=22,tb=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ft.UNAUTHENTICATED,this.clientId=bh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>I(this,null,function*(){z(zi,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(z(zi,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:w9}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new L(M.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new at;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>I(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=La(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function vh(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),z(zi,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>I(this,null,function*(){r.isEqual(i)||(yield q1(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function nb(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Xb(n);z(zi,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>eD(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>eD(e.remoteStore,i)),n._onlineComponents=e})}function ck(n){return n.name==="FirebaseError"?n.code===M.FAILED_PRECONDITION||n.code===M.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===S9||n.code===_9||n.code===b9:!0}function Xb(n){return I(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){z(zi,"Using user provided OfflineComponentProvider");try{yield vh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!ck(t))throw t;Cn("Error using user provided cache. Falling back to memory cache: "+t),yield vh(n,new _c)}}else z(zi,"Using default OfflineComponentProvider"),yield vh(n,new _c);return n._offlineComponents})}function Tf(n){return I(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(z(zi,"Using user provided OnlineComponentProvider"),yield nb(n,n._uninitializedComponentsProvider._online)):(z(zi,"Using default OnlineComponentProvider"),yield nb(n,new Sc))),n._onlineComponents})}function uk(n){return Xb(n).then(e=>e.persistence)}function Zb(n){return Xb(n).then(e=>e.localStore)}function dk(n){return Tf(n).then(e=>e.remoteStore)}function e0(n){return Tf(n).then(e=>e.syncEngine)}function C9(n){return Tf(n).then(e=>e.datastore)}function Aa(n){return I(this,null,function*(){let e=yield Tf(n),t=e.eventManager;return t.onListen=zj.bind(null,e.syncEngine),t.onUnlisten=Gj.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jj.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Hj.bind(null,e.syncEngine),t})}function E9(n){return n.asyncQueue.enqueue(()=>I(this,null,function*(){let e=yield uk(n),t=yield dk(n);return e.setNetworkEnabled(!0),mj(t)}))}function T9(n){return n.asyncQueue.enqueue(()=>I(this,null,function*(){let e=yield uk(n),t=yield dk(n);return e.setNetworkEnabled(!1),gj(t)}))}function A9(n){let e=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let t=yield e0(n);return Yj(t,e)})),e.promise}function I9(n,e,t,r){let i=new Ta(r),s=new bc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let o=yield Aa(n);return Ub(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let o=yield Aa(n);return zb(o,s)}))}}function D9(n,e){let t=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let r=yield Zb(n);return M9(r,e,t)})),t.promise}function hk(n,e,t={}){let r=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let i=yield Aa(n);return N9(i,n.asyncQueue,e,t,r)})),r.promise}function k9(n,e){let t=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let r=yield Zb(n);return P9(r,e,t)})),t.promise}function fk(n,e,t={}){let r=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let i=yield Aa(n);return F9(i,n.asyncQueue,e,t,r)})),r.promise}function R9(n,e){let t=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let r=yield e0(n);return Wj(r,e,t)})),t.promise}function x9(n,e){let t=new Ta(e);return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let r=yield Aa(n);return Lj(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let r=yield Aa(n);return Bj(r,t)}))}}function O9(n,e,t){let r=new at;return n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){let i=yield C9(n);new eb(n.asyncQueue,i,t,e,r).run()})),r.promise}function M9(n,e,t){return I(this,null,function*(){try{let r=yield C5(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new L(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=La(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function N9(n,e,t,r,i){let s=new Ta({next:a=>{e.enqueueAndForget(()=>zb(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new L(M.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new L(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new bc(Oa(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Ub(n,o)}function P9(n,e,t){return I(this,null,function*(){try{let r=yield Sf(n,e,!0),i=new ef(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=La(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function F9(n,e,t,r,i){let s=new Ta({next:a=>{e.enqueueAndForget(()=>zb(n,o)),a.fromCache&&r.source==="server"?i.reject(new L(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new bc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Ub(n,o)}function L9(n,e,t,r){let i=V9(t,Mc(e));n.asyncQueue.enqueueAndForget(()=>I(this,null,function*(){d9(yield e0(n),i,r)}))}function B9(n,e){return n.asyncQueue.enqueue(()=>I(this,null,function*(){return M5(yield Zb(n),e)}))}function V9(n,e){let t;return typeof n=="string"?t=g1().encode(n):t=n,v9(y9(t),e)}function q9(n,e){return n.timeoutSeconds===e.timeoutSeconds}function pk(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var U9="ComponentProvider",sD=new Map;function z9(n){let e=sD.get(n);e&&(z(U9,"Removing Datastore"),sD.delete(n),e.terminate())}function j9(n,e,t,r){return new Lv(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,pk(r.experimentalLongPollingOptions),r.useFetchStreams)}var mk="firestore.googleapis.com",oD=!0,aD=5,lD=30,G9=!0,nf=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new L(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=mk,this.ssl=oD}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:oD;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=F1;else{if(e.cacheSizeBytes!==Oc&&e.cacheSizeBytes<jI)throw new L(M.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${jI}`);this.cacheSizeBytes=e.cacheSizeBytes}Jb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=G9:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pk((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),H9(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&q9(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function H9(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new L(M.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<aD)throw new L(M.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${aD})`);if(n.timeoutSeconds>lD)throw new L(M.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${lD})`)}}var Fs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new L(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new L(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nf(e),e.credentials!==void 0&&(this._authCredentials=UU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return z9(this),Promise.resolve()}};function gk(n,e,t,r={}){var i;n=we(n,Fs);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==mk&&s.host!==o&&Cn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=ft.MOCK_USER;else{a=iS(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new L(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ft(d)}n._authCredentials=new _v(new wh(a,l))}}var kt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Fe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},vr=class n extends kt{constructor(e,t,r){super(e,t,Oa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Fe(this.firestore,null,new W(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function t0(n,e,...t){if(n=$e(n),Yb("collection","path",e),n instanceof Fs){let r=ve.fromString(e,...t);return iD(r),new vr(n,null,r)}else{if(!(n instanceof Fe)&&!(n instanceof vr))throw new L(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ve.fromString(e,...t));return iD(r),new vr(n.firestore,null,r)}}function yk(n,e){if(n=we(n,Fs),Yb("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new L(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new kt(n,null,C4(e))}function Fc(n,e,...t){if(n=$e(n),arguments.length===1&&(e=bh.newId()),Yb("doc","path",e),n instanceof Fs){let r=ve.fromString(e,...t);return rD(r),new Fe(n,null,new W(r))}else{if(!(n instanceof Fe)&&!(n instanceof vr))throw new L(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ve.fromString(e,...t));return rD(r),new Fe(n.firestore,n instanceof vr?n.converter:null,new W(r))}}function n0(n,e){return n=$e(n),e=$e(e),(n instanceof Fe||n instanceof vr)&&(e instanceof Fe||e instanceof vr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function r0(n,e){return n=$e(n),e=$e(e),n instanceof kt&&e instanceof kt?n.firestore===e.firestore&&Rc(n._query,e._query)&&n.converter===e.converter:!1}var W9="AsyncQueue",rb=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new wc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new at;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return I(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Hi(e))z(W9,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=K9(r);throw Ke("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=zw.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&Q()}verifyOperationInProgress(){}drain(){return I(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function $9(){return new rb}function K9(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var ib=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new at,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var vk=Oc,ze=class extends Fs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=$9(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||wk(this),this._firestoreClient.terminate()}};function vt(n){return n._firestoreClient||wk(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function wk(n){var e,t,r;let i=n._freezeSettings(),s=j9(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new tb(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function bk(n,e){n=we(n,ze),kk(n);let t=vt(n);if(t._uninitializedComponentsProvider)throw new L(M.FAILED_PRECONDITION,"SDK cache is already specified.");Cn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Sc,s=new tf(i,r.cacheSizeBytes,e?.forceOwnership);return Sk(t,i,s)}function _k(n){n=we(n,ze),kk(n);let e=vt(n);if(e._uninitializedComponentsProvider)throw new L(M.FAILED_PRECONDITION,"SDK cache is already specified.");Cn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Sc,i=new Yw(r,t.cacheSizeBytes);return Sk(e,r,i)}function Sk(n,e,t){let r=new at;return n.asyncQueue.enqueue(()=>I(this,null,function*(){try{yield vh(n,t),yield nb(n,e),r.resolve()}catch(i){let s=i;if(!ck(s))throw s;Cn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Ck(n){if(n._initialized&&!n._terminated)throw new L(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new at;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>I(this,null,function*(){try{yield h5(Fb(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Ek(n){n=we(n,ze);let e=vt(n);return A9(e)}function Tk(n){n=we(n,ze);let e=vt(n);return E9(e)}function Ak(n){n=we(n,ze);let e=vt(n);return T9(e)}function Ik(n,e){n=we(n,ze);let t=vt(n),r=new ib;return L9(t,n._databaseId,e,r),r}function Dk(n,e){n=we(n,ze);let t=vt(n);return B9(t,e).then(r=>r?new kt(n,null,r.query):null)}function kk(n){if(n._initialized||n._terminated)throw new L(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function Q9(n,e=!0){VU(aS),il(new is("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new ze(new Sv(t.getProvider("auth-internal")),new Av(t.getProvider("app-check-internal")),F3(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Yr(eI,tI,n),Yr(eI,tI,"esm2017")}var _r=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Tt.fromBase64String(e))}catch(t){throw new L(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var qn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ct(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Vr=class{constructor(e){this._methodName=e}};var Ls=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}};var Y9=/^__.*__$/,sb=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms):new qi(e,this.data,t,this.fieldTransforms)}},rf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Rk(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q()}}var sf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return of(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Rk(this.dataSource)&&Y9.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},ob=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Mc(e)}createContext(e,t,r,i=!1){return new sf({dataSource:e,methodName:t,targetDoc:r,path:ct.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function zs(n){let e=n._freezeSettings(),t=Mc(n._databaseId);return new ob(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Af(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);o0("Data must be an object, but it was:",o,r);let a=Mk(r,o),l,d;if(s.merge)l=new cn(o.fieldMask),d=o.fieldTransforms;else if(s.mergeFields){let p=[];for(let m of s.mergeFields){let y=db(e,m,t);if(!o.contains(y))throw new L(M.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Pk(p,y)||p.push(y)}l=new cn(p),d=o.fieldTransforms.filter(m=>l.covers(m.field))}else l=null,d=o.fieldTransforms;return new sb(new Pt(a),l,d)}var Cc=class n extends Vr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function xk(n,e,t){return new sf({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var ab=class n extends Vr{_toFieldTransform(e){return new Os(e.path,new Bi)}isEqual(e){return e instanceof n}},lb=class n extends Vr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=xk(this,e,!0),r=this._elements.map(s=>js(s,t)),i=new Lr(r);return new Os(e.path,i)}isEqual(e){return e instanceof n&&Dp(this._elements,e._elements)}},cb=class n extends Vr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=xk(this,e,!0),r=this._elements.map(s=>js(s,t)),i=new Br(r);return new Os(e.path,i)}isEqual(e){return e instanceof n&&Dp(this._elements,e._elements)}},ub=class n extends Vr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Vi(e.serializer,o1(e.serializer,this._operand));return new Os(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function i0(n,e,t,r){let i=n.createContext(1,e,t);o0("Data must be an object, but it was:",i,r);let s=[],o=Pt.empty();Us(r,(l,d)=>{let p=a0(e,l,t);d=$e(d);let m=i.childContextForFieldPath(p);if(d instanceof Cc)s.push(p);else{let y=js(d,m);y!=null&&(s.push(p),o.set(p,y))}});let a=new cn(s);return new rf(o,a,i.fieldTransforms)}function s0(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[db(e,r,t)],l=[i];if(s.length%2!==0)throw new L(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)a.push(db(e,s[y])),l.push(s[y+1]);let d=[],p=Pt.empty();for(let y=a.length-1;y>=0;--y)if(!Pk(d,a[y])){let C=a[y],x=l[y];x=$e(x);let O=o.childContextForFieldPath(C);if(x instanceof Cc)d.push(C);else{let k=js(x,O);k!=null&&(d.push(C),p.set(C,k))}}let m=new cn(d);return new rf(p,m,o.fieldTransforms)}function Ok(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return js(t,i)}function js(n,e){if(n=$e(n),Nk(n))return o0("Unsupported field value:",e,n),Mk(n,e);if(n instanceof Vr)return X9(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return J9(n,e)}else return Z9(n,e)}function Mk(n,e){let t={};return MD(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Us(n,(r,i)=>{let s=js(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function J9(n,e){let t=[],r=0;for(let i of n){let s=js(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function X9(n,e){if(!Rk(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function Z9(n,e){if(n=$e(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return o1(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Qe.fromDate(n);return{timestampValue:va(e.serializer,t)}}else if(n instanceof Qe){let t=new Qe(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:va(e.serializer,t)}}else{if(n instanceof Ls)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof _r)return{bytesValue:y1(e.serializer,n._byteString)};if(n instanceof Fe){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:xb(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Pc(n)}`)}}function Nk(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Qe)&&!(n instanceof Ls)&&!(n instanceof _r)&&!(n instanceof Fe)&&!(n instanceof Vr)}function o0(n,e,t){if(!Nk(t)||!m9(t)){let r=Pc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function db(n,e,t){if(e=$e(e),e instanceof qn)return e._internalPath;if(typeof e=="string")return a0(n,e);throw of("Field path arguments must be of type string or ",n,!1,void 0,t)}var eG=new RegExp("[~\\*/\\[\\]]");function a0(n,e,t){if(e.search(eG)>=0)throw of(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qn(...e.split("."))._internalPath}catch{throw of(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function of(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new L(M.INVALID_ARGUMENT,a+n+l)}function Pk(n,e){return n.some(t=>t.isEqual(e))}var Bs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Fe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new hb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(If("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},hb=class extends Bs{data(){return super.data()}};function If(n,e){return typeof e=="string"?a0(n,e):e instanceof qn?e._internalPath:e._delegate._internalPath}function Fk(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ec=class{},Vs=class extends Ec{};function jr(n,e,...t){let r=[];e instanceof Ec&&r.push(e),r=r.concat(t),lG(r);for(let i of r)n=i._apply(n);return n}var af=class n extends Vs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Wk(e._query,t),new kt(e.firestore,e.converter,kb(e._query,t))}_parse(e){let t=zs(e.firestore);return tG(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Lk(n,e,t){let r=e,i=If("where",n);return af._create(i,r,t)}var fb=class n extends Ec{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ke.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(oG(e._query,t),new kt(e.firestore,e.converter,kb(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var pb=class n extends Vs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=nG(e._query,this._field,this._direction);return new kt(e.firestore,e.converter,A4(e._query,t))}};function Bk(n,e="asc"){let t=e,r=If("orderBy",n);return pb._create(r,t)}var lf=class n extends Vs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new kt(e.firestore,e.converter,kh(e._query,this._limit,this._limitType))}};function Vk(n){return lk("limit",n),lf._create("limit",n,"F")}function qk(n){return lk("limitToLast",n),lf._create("limitToLast",n,"L")}var cf=class n extends Vs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Hk(e,this.type,this._docOrFields,this._inclusive);return new kt(e.firestore,e.converter,I4(e._query,t))}};function Uk(...n){return cf._create("startAt",n,!0)}function zk(...n){return cf._create("startAfter",n,!1)}var uf=class n extends Vs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Hk(e,this.type,this._docOrFields,this._inclusive);return new kt(e.firestore,e.converter,D4(e._query,t))}};function jk(...n){return uf._create("endBefore",n,!1)}function Gk(...n){return uf._create("endAt",n,!0)}function Hk(n,e,t,r){if(t[0]=$e(t[0]),t[0]instanceof Bs)return rG(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=zs(n.firestore);return iG(n._query,n.firestore._databaseId,i,e,t,r)}}function tG(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new L(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){uD(o,s);let d=[];for(let p of o)d.push(cD(r,n,p));a={arrayValue:{values:d}}}else a=cD(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&uD(o,s),a=Ok(t,e,o,s==="in"||s==="not-in");return pe.create(i,s,a)}function nG(n,e,t){if(n.startAt!==null)throw new L(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new L(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Rs(e,t)}function rG(n,e,t,r,i){if(!r)throw new L(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of ma(n))if(o.field.isKeyField())s.push(ks(e,r.key));else{let a=r.data.field(o.field);if(vf(a))throw new L(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new L(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new wr(s,i)}function iG(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new L(M.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let d=i[l];if(o[l].field.isKeyField()){if(typeof d!="string")throw new L(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof d}`);if(!Db(n)&&d.indexOf("/")!==-1)throw new L(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${d}' contains a slash.`);let m=n.path.child(ve.fromString(d));if(!W.isDocumentKey(m))throw new L(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${m}' is not because it contains an odd number of segments.`);let y=new W(m);a.push(ks(e,y))}else{let m=Ok(t,r,d);a.push(m)}}return new wr(a,s)}function cD(n,e,t){if(t=$e(t),typeof t=="string"){if(t==="")throw new L(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Db(e)&&t.indexOf("/")!==-1)throw new L(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ve.fromString(t));if(!W.isDocumentKey(r))throw new L(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ks(n,new W(r))}else{if(t instanceof Fe)return ks(n,t._key);throw new L(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Pc(t)}.`)}}function uD(n,e){if(!Array.isArray(n)||n.length===0)throw new L(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sG(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function Wk(n,e){let t=aG(n.filters,sG(e.op));if(t!==null)throw t===e.op?new L(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new L(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function oG(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)Wk(t,i),t=kb(t,i)}function aG(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function lG(n){let e=n.filter(r=>r instanceof fb).length,t=n.filter(r=>r instanceof af).length;if(e>1||e>0&&t>0)throw new L(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Ia=class{convertValue(e,t="none"){switch(Ds(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Q()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Us(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ls(tt(e.latitude),tt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Tb(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rc(e));default:return null}}convertTimestamp(e){let t=Fr(e);return new Qe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ve.fromString(e);te(D1(r));let i=new Fi(r.get(1),r.get(3)),s=new W(r.popFirst(5));return i.isEqual(t)||Ke(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Df(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var mb=class extends Ia{constructor(e){super(),this.firestore=e}convertBytes(e){return new _r(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fe(this.firestore,null,t)}};function gb(n){return cG(n,["next","error","complete"])}function cG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var qr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Tn=class extends Bs{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new ji(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(If("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ji=class extends Tn{data(e={}){return super.data(e)}},Un=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new qr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ji(this._firestore,this._userDataWriter,r.key,r,new qr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=uG(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function uG(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new ji(n._firestore,n._userDataWriter,r.doc.key,r.doc,new qr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new ji(n._firestore,n._userDataWriter,r.doc.key,r.doc,new qr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:dG(r.type),doc:i,oldIndex:s,newIndex:o}})}}function dG(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q()}}function l0(n,e){return n instanceof Tn&&e instanceof Tn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Un&&e instanceof Un?n._firestore===e._firestore&&r0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function $k(n){n=we(n,Fe);let e=we(n.firestore,ze),t=vt(e);return hk(t,n._key).then(r=>h0(e,n,r))}var Ur=class extends Ia{constructor(e){super(),this.firestore=e}convertBytes(e){return new _r(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fe(this.firestore,null,t)}};function Kk(n){n=we(n,Fe);let e=we(n.firestore,ze),t=vt(e),r=new Ur(e);return D9(t,n._key).then(i=>new Tn(e,r,n._key,i,new qr(i!==null&&i.hasLocalMutations,!0),n.converter))}function Qk(n){n=we(n,Fe);let e=we(n.firestore,ze),t=vt(e);return hk(t,n._key,{source:"server"}).then(r=>h0(e,n,r))}function Yk(n){n=we(n,kt);let e=we(n.firestore,ze),t=vt(e),r=new Ur(e);return Fk(n._query),fk(t,n._query).then(i=>new Un(e,r,n,i))}function Jk(n){n=we(n,kt);let e=we(n.firestore,ze),t=vt(e),r=new Ur(e);return k9(t,n._query).then(i=>new Un(e,r,n,i))}function Xk(n){n=we(n,kt);let e=we(n.firestore,ze),t=vt(e),r=new Ur(e);return fk(t,n._query,{source:"server"}).then(i=>new Un(e,r,n,i))}function c0(n,e,t){n=we(n,Fe);let r=we(n.firestore,ze),i=Df(n.converter,e,t),s=zs(r),a=Af(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,et.none());return Ba(r,[a])}function u0(n,e,t,...r){n=we(n,Fe);let i=we(n.firestore,ze),s=zs(i);e=$e(e);let o;typeof e=="string"||e instanceof qn?o=s0(s,"updateDoc",n._key,e,t,r):o=i0(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,et.exists(!0));return Ba(i,[a])}function Zk(n){let e=we(n.firestore,ze),t=[new Ui(n._key,et.none())];return Ba(e,t)}function eR(n,e){let t=we(n.firestore,ze),r=Fc(n),i=Df(n.converter,e),s=zs(n.firestore),a=Af(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,et.exists(!1));return Ba(t,[a]).then(()=>r)}function d0(n,...e){var t,r,i;n=$e(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!gb(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(gb(e[o])){let y=e[o];e[o]=(t=y.next)===null||t===void 0?void 0:t.bind(y),e[o+1]=(r=y.error)===null||r===void 0?void 0:r.bind(y),e[o+2]=(i=y.complete)===null||i===void 0?void 0:i.bind(y)}let l,d,p;if(n instanceof Fe)d=we(n.firestore,ze),p=Oa(n._key.path),l={next:y=>{e[o]&&e[o](h0(d,n,y))},error:e[o+1],complete:e[o+2]};else{let y=we(n,kt);d=we(y.firestore,ze),p=y._query;let C=new Ur(d);l={next:x=>{e[o]&&e[o](new Un(d,C,y,x))},error:e[o+1],complete:e[o+2]},Fk(n._query)}let m=vt(d);return I9(m,p,a,l)}function tR(n,e){n=we(n,ze);let t=vt(n),r=gb(e)?e:{next:e};return x9(t,r)}function Ba(n,e){let t=vt(n);return R9(t,e)}function h0(n,e,t){let r=t.docs.get(e._key),i=new Ur(n);return new Tn(n,i,e._key,r,new qr(t.hasPendingWrites,t.fromCache),e.converter)}var hG={maxAttempts:5};function fG(n){if(n.maxAttempts<1)throw new L(M.INVALID_ARGUMENT,"Max attempts must be at least 1")}var df=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=zs(e)}set(e,t,r){this._verifyNotCommitted();let i=xi(e,this._firestore),s=Df(i.converter,t,r),o=Af(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,et.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=xi(e,this._firestore);t=$e(t);let o;return typeof t=="string"||t instanceof qn?o=s0(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=i0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,et.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=xi(e,this._firestore);return this._mutations=this._mutations.concat(new Ui(t._key,et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function xi(n,e){if(n=$e(n),n.firestore!==e)throw new L(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var yb=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=zs(e)}get(e){let t=xi(e,this._firestore),r=new mb(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return Q();let s=i[0];if(s.isFoundDocument())return new Bs(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Bs(this._firestore,r,t._key,null,t.converter);throw Q()})}set(e,t,r){let i=xi(e,this._firestore),s=Df(i.converter,t,r),o=Af(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=xi(e,this._firestore);t=$e(t);let o;return typeof t=="string"||t instanceof qn?o=s0(this._dataReader,"Transaction.update",s._key,t,r,i):o=i0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=xi(e,this._firestore);return this._transaction.delete(t._key),this}};var vb=class extends yb{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=xi(e,this._firestore),r=new Ur(this._firestore);return super.get(e).then(i=>new Tn(this._firestore,r,t._key,i._document,new qr(!1,!1),t.converter))}};function nR(n,e,t){n=we(n,ze);let r=Object.assign(Object.assign({},hG),t);fG(r);let i=vt(n);return O9(i,s=>e(new vb(n,s)),r)}function rR(){return new Cc("deleteField")}function iR(){return new ab("serverTimestamp")}function sR(...n){return new lb("arrayUnion",n)}function oR(...n){return new cb("arrayRemove",n)}function aR(n){return new ub("increment",n)}Q9("node");var pG="@firebase/firestore-compat",mG="0.3.33";function v0(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new L("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function lR(){if(typeof Uint8Array>"u")throw new L("unimplemented","Uint8Arrays are not available in this environment.")}function cR(){if(!ND())throw new L("unimplemented","Blobs are unavailable in Firestore in this environment.")}var kf=class n{constructor(e){this._delegate=e}static fromBase64String(e){return cR(),new n(_r.fromBase64String(e))}static fromUint8Array(e){return lR(),new n(_r.fromUint8Array(e))}toBase64(){return cR(),this._delegate.toBase64()}toUint8Array(){return lR(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function f0(n){return gG(n,["next","error","complete"])}function gG(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var p0=class{enableIndexedDbPersistence(e,t){return bk(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return _k(e._delegate)}clearIndexedDbPersistence(e){return Ck(e._delegate)}},Rf=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Fi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Cn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){gk(this._delegate,e,t,r)}enableNetwork(){return Tk(this._delegate)}disableNetwork(){return Ak(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Jb("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ek(this._delegate)}onSnapshotsInSync(e){return tR(this._delegate,e)}get app(){if(!this._appCompat)throw new L("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ua(this,t0(this._delegate,e))}catch(t){throw zt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Sr(this,Fc(this._delegate,e))}catch(t){throw zt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new $s(this,yk(this._delegate,e))}catch(t){throw zt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return nR(this._delegate,t=>e(new xf(this,t)))}batch(){return vt(this._delegate),new Of(new df(this._delegate,e=>Ba(this._delegate,e)))}loadBundle(e){return Ik(this._delegate,e)}namedQuery(e){return Dk(this._delegate,e).then(t=>t?new $s(this,t):null)}},Va=class extends Ia{constructor(e){super(),this.firestore=e}convertBytes(e){return new kf(new _r(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Sr.forKey(t,this.firestore,null)}};function yG(n){hD(n)}var xf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Va(e)}get(e){let t=Gs(e);return this._delegate.get(t).then(r=>new Hs(this._firestore,new Tn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Gs(e);return r?(v0("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Gs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Gs(e);return this._delegate.delete(t),this}},Of=class{constructor(e){this._delegate=e}set(e,t,r){let i=Gs(e);return r?(v0("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Gs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Gs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},qa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new ji(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ws(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Va(e),t),i.set(t,s)),s}};qa.INSTANCES=new WeakMap;var Sr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Va(e)}static forPath(e,t,r){if(e.length%2!==0)throw new L("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Fe(t._delegate,r,new W(e)))}static forKey(e,t,r){return new n(t,new Fe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Ua(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ua(this.firestore,t0(this._delegate,e))}catch(t){throw zt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=$e(e),e instanceof Fe?n0(this._delegate,e):!1}set(e,t){t=v0("DocumentReference.set",t);try{return t?c0(this._delegate,e,t):c0(this._delegate,e)}catch(r){throw zt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?u0(this._delegate,e):u0(this._delegate,e,t,...r)}catch(i){throw zt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Zk(this._delegate)}onSnapshot(...e){let t=uR(e),r=dR(e,i=>new Hs(this.firestore,new Tn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return d0(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=Kk(this._delegate):e?.source==="server"?t=Qk(this._delegate):t=$k(this._delegate),t.then(r=>new Hs(this.firestore,new Tn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(qa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function zt(n,e,t){return n.message=n.message.replace(e,t),n}function uR(n){for(let e of n)if(typeof e=="object"&&!f0(e))return e;return{}}function dR(n,e){var t,r;let i;return f0(n[0])?i=n[0]:f0(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Hs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Sr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return l0(this._delegate,e._delegate)}},Ws=class extends Hs{data(e){let t=this._delegate.data(e);return this._delegate._converter||fD(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},$s=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Va(e)}where(e,t,r){try{return new n(this.firestore,jr(this._delegate,Lk(e,t,r)))}catch(i){throw zt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,jr(this._delegate,Bk(e,t)))}catch(r){throw zt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,jr(this._delegate,Vk(e)))}catch(t){throw zt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,jr(this._delegate,qk(e)))}catch(t){throw zt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,jr(this._delegate,Uk(...e)))}catch(t){throw zt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,jr(this._delegate,zk(...e)))}catch(t){throw zt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,jr(this._delegate,jk(...e)))}catch(t){throw zt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,jr(this._delegate,Gk(...e)))}catch(t){throw zt(t,"endAt()","Query.endAt()")}}isEqual(e){return r0(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Jk(this._delegate):e?.source==="server"?t=Xk(this._delegate):t=Yk(this._delegate),t.then(r=>new Lc(this.firestore,new Un(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=uR(e),r=dR(e,i=>new Lc(this.firestore,new Un(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return d0(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(qa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},m0=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ws(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Lc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new $s(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ws(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new m0(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ws(this._firestore,r))})}isEqual(e){return l0(this._delegate,e._delegate)}},Ua=class n extends $s{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Sr(this.firestore,e):null}doc(e){try{return e===void 0?new Sr(this.firestore,Fc(this._delegate)):new Sr(this.firestore,Fc(this._delegate,e))}catch(t){throw zt(t,"doc()","CollectionReference.doc()")}}add(e){return eR(this._delegate,e).then(t=>new Sr(this.firestore,t))}isEqual(e){return n0(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(qa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Gs(n){return we(n,Fe)}var g0=class n{constructor(...e){this._delegate=new qn(...e)}static documentId(){return new n(ct.keyField().canonicalString())}isEqual(e){return e=$e(e),e instanceof qn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var y0=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=iR();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=rR();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=sR(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=oR(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=aR(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var vG={Firestore:Rf,GeoPoint:Ls,Timestamp:Qe,Blob:kf,Transaction:xf,WriteBatch:Of,DocumentReference:Sr,DocumentSnapshot:Hs,Query:$s,QueryDocumentSnapshot:Ws,QuerySnapshot:Lc,CollectionReference:Ua,FieldPath:g0,FieldValue:y0,setLogLevel:yG,CACHE_SIZE_UNLIMITED:vk};function wG(n,e){n.INTERNAL.registerComponent(new is("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},vG)))}function bG(n){wG(n,(e,t)=>new Rf(e,t,new p0)),n.registerVersion(pG,mG,"node")}bG(Kt);function _G(n,e=tu){return new to(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function hR(n,e){return _G(n,e)}function SG(n,e){return hR(n,e).pipe(iu(void 0),nu(),Dt(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function _0(n,e){return hR(n,e).pipe(Dt(t=>({payload:t,type:"query"})))}var Mf=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=yR(r,t);return new Pf(i,s,this.afs)}snapshotChanges(){return SG(this.ref,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(e={}){return this.snapshotChanges().pipe(Dt(({payload:t})=>e.idField?Gt(gt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Wn(this.ref.get(e)).pipe(Qt)}};function Nf(n,e){return _0(n,e).pipe(iu(void 0),nu(),Dt(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let d=s.find(m=>m.doc.ref.isEqual(a.ref)),p=r?.payload.docs.find(m=>m.ref.isEqual(a.ref));d&&JSON.stringify(d.doc.metadata)===JSON.stringify(a.metadata)||!d&&p&&JSON.stringify(p.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function fR(n,e,t){return Nf(n,t).pipe(ru((r,i)=>CG(r,i.map(s=>s.payload),e),[]),B_(),Dt(r=>r.map(i=>({type:i.type,payload:i}))))}function CG(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=EG(n,r))}),n}function w0(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function EG(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return w0(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return w0(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return w0(n,e.oldIndex,1);break}return n}function pR(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Pf=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Nf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Dt(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(iu(void 0),nu(),Xa(([r,i])=>i.length>0||!r),Dt(([,r])=>r),Qt)}auditTrail(e){return this.stateChanges(e).pipe(ru((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=pR(e);return fR(this.query,t,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(e={}){return _0(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(t=>t.payload.docs.map(r=>e.idField?Gt(gt({},r.data()),{[e.idField]:r.id}):r.data())),Qt)}get(e){return Wn(this.query.get(e)).pipe(Qt)}add(e){return this.ref.add(e)}doc(e){return new Mf(this.ref.doc(e),this.afs)}},b0=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Nf(this.query,this.afs.schedulers.outsideAngular).pipe(Qt):Nf(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(t=>t.filter(r=>e.indexOf(r.type)>-1)),Xa(t=>t.length>0),Qt)}auditTrail(e){return this.stateChanges(e).pipe(ru((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=pR(e);return fR(this.query,t,this.afs.schedulers.outsideAngular).pipe(Qt)}valueChanges(e={}){return _0(this.query,this.afs.schedulers.outsideAngular).pipe(Dt(r=>r.payload.docs.map(i=>e.idField?gt({[e.idField]:i.id},i.data()):i.data())),Qt)}get(e){return Wn(this.query.get(e)).pipe(Qt)}},mR=new Xe("angularfire2.enableFirestorePersistence"),gR=new Xe("angularfire2.firestore.persistenceSettings"),TG=new Xe("angularfire2.firestore.settings"),AG=new Xe("angularfire2.firestore.use-emulator");function yR(n,e=t=>t){return{query:e(n),ref:n}}var S0=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,d,p,m,y,C,x,O,k,q,P){this.schedulers=l;let U=ol(t,a,r),j=p;m&&Hp(U,a,y,x,O,k,C,q),[this.firestore,this.persistenceEnabled$]=pu(`${U.name}.firestore`,"AngularFirestore",U.name,()=>{let Y=a.runOutsideAngular(()=>U.firestore());if(s&&Y.settings(s),j&&Y.useEmulator(...j),i&&!au(o)){let ie=()=>{try{return Wn(Y.enablePersistence(d||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),Wr(!1)}};return[Y,a.runOutsideAngular(ie)]}else return[Y,Wr(!1)]},[s,j,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=yR(i,r),a=this.schedulers.ngZone.run(()=>s);return new Pf(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new b0(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Mf(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(he(oo),he(ao,8),he(mR,8),he(TG,8),he(ro),he($r),he(du),he(gR,8),he(AG,8),he(TS,8),he(Vp,8),he(qp,8),he(Up,8),he(zp,8),he(jp,8),he(Gp,8),he(ss,8))};static \u0275prov=$n({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),vR=(()=>{class n{constructor(){Kt.registerVersion("angularfire",so.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:mR,useValue:!0},{provide:gR,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Wt({type:n});static \u0275inj=Ht({providers:[S0]})}return n})();var Ff=(()=>{let e=class e{constructor(r){this.firestore=r}agregarEmpleado(r){return this.firestore.collection("empleados").add(r)}getEmpleados(){return this.firestore.collection("empleados",r=>r.orderBy("fechaCreacion","asc")).snapshotChanges()}deleteEmpleado(r){return this.firestore.collection("empleados").doc(r).delete()}getEmpleado(r){return this.firestore.collection("empleados").doc(r).snapshotChanges()}updateEmpleado(r,i){return this.firestore.collection("empleados").doc(r).update(i)}};e.\u0275fac=function(i){return new(i||e)(he(S0))},e.\u0275prov=$n({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var kG=n=>["/editar-empleados/",n];function RG(n,e){if(n&1){let t=H_();fe(0,"tr")(1,"td"),xe(2),ge(),fe(3,"td"),xe(4),ge(),fe(5,"td"),xe(6),ge(),fe(7,"td"),xe(8),bp(9,"currency"),ge(),fe(10,"td",9),$t(11,"i",10),fe(12,"i",11),An("click",function(){let i=z_(t).$implicit,s=wp(2);return j_(s.eliminarEmpleado(i.id))}),ge()()()}if(n&2){let t=e.$implicit;Ft(2),Tr(t.nombre),Ft(2),Tr(t.apellido),Ft(2),Tr(t.documento),Ft(2),Tr(_p(9,5,t.salario)),Ft(3),Qr("routerLink",W_(7,kG,t.id))}}function xG(n,e){if(n&1&&(fe(0,"table",7)(1,"thead")(2,"tr")(3,"th"),xe(4,"Nombre"),ge(),fe(5,"th"),xe(6,"Apellido"),ge(),fe(7,"th"),xe(8,"Documento"),ge(),fe(9,"th"),xe(10,"Salario"),ge(),$t(11,"th"),ge()(),fe(12,"tbody"),tl(13,RG,13,9,"tr",8),fe(14,"tr")(15,"th"),xe(16,"Total:"),ge(),$t(17,"td")(18,"td"),fe(19,"th"),xe(20),bp(21,"currency"),ge(),$t(22,"td"),ge()()()),n&2){let t=wp();Ft(13),Qr("ngForOf",t.empleados),Ft(7),Tr(_p(21,2,t.TotalSalarios))}}var bR=(()=>{let e=class e{constructor(r){this._empleadosService=r,this.empleados=[],this.TotalSalarios=0}ngOnInit(){this.getEmpleados()}getEmpleados(){this.empleados=[],this._empleadosService.getEmpleados().subscribe(r=>{this.empleados=r.map(i=>gt({id:i.payload.doc.id},i.payload.doc.data())),this.empleados.length===0?Lf.default.fire({title:"Lista Vac\xEDa",text:"No hay empleados para mostrar",icon:"warning",footer:'<a routerLink="/crear-empleado">Registrar Empleado</a>'}):(this.TotalSalarios=0,this.empleados.forEach(i=>{this.TotalSalarios+=i.salario}))})}eliminarEmpleado(r){this._empleadosService.deleteEmpleado(r).then(()=>{Lf.default.fire({title:"Empleado Eliminado",text:"Los datos han sido removidos de la base de datos",icon:"success"})}).catch(i=>{console.log(i),Lf.default.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error al eliminar los datos del empleado (x_x)",footer:'<a href="#">\xBFQue acaba de suceder?</a>'})})}};e.\u0275fac=function(i){return new(i||e)(We(Ff))},e.\u0275cmp=Kn({type:e,selectors:[["app-list-empleados"]],decls:9,vars:1,consts:[[1,"listaEmpleado"],[1,"contenido"],[1,"encabezado"],[1,"h3"],["routerLink","/crear-empleados",1,"btn","btn-dark","btn-lg"],[1,"containTable"],["class","list",4,"ngIf"],[1,"list"],[4,"ngFor","ngForOf"],[1,"options"],[1,"fa-regular","fa-pen-to-square","fa-lg","text-info","mr-2",3,"routerLink"],[1,"fa-solid","fa-trash","fa-lg","text-danger","mf-1",3,"click"]],template:function(i,s){i&1&&(fe(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),xe(4,"Lista de Empleados"),ge(),fe(5,"button",4),xe(6,"Agregar"),ge()(),fe(7,"div",5),tl(8,xG,23,4,"table",6),ge()()()),i&2&&(Ft(8),Qr("ngIf",s.empleados.length>0))},dependencies:[Q_,ou,io,Y_],styles:[".encabezado[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.options[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{cursor:pointer;margin:0 5px}.contenido[_ngcontent-%COMP%], .containTable[_ngcontent-%COMP%]{width:100%}.list[_ngcontent-%COMP%]{margin-top:1%;width:100%;table-layout:fixed;border-collapse:collapse;border:1px solid #04044076;border-radius:10px}thead[_ngcontent-%COMP%]{background-color:#262626;color:#fff}th[_ngcontent-%COMP%]{font-size:20px;padding:20px;font-weight:650;text-transform:uppercase}td[_ngcontent-%COMP%]{font-size:17px;padding:15px;font-weight:500;text-transform:uppercase}tr[_ngcontent-%COMP%]{border-bottom:1px solid #0404401e}tr[_ngcontent-%COMP%]:hover{background-color:#0404401e}.listaEmpleado[_ngcontent-%COMP%]{background:#f5f5f5;width:50%;height:100hv;margin:2.5% auto auto;padding:1%;border-radius:10px}@media screen and (max-width:800px){.listaEmpleado[_ngcontent-%COMP%]{width:98%}.list[_ngcontent-%COMP%]{width:auto}th[_ngcontent-%COMP%]{font-size:15px;padding:5px}td[_ngcontent-%COMP%]{font-size:12px;padding:3px}.containTable[_ngcontent-%COMP%]{overflow-x:auto}}"]});let n=e;return n})();var kR=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(We(yp),We(gp))},e.\u0275dir=Qn({type:e});let n=e;return n})(),RR=(()=>{let e=class e extends kR{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=mp(e)))(s||e)}})(),e.\u0275dir=Qn({type:e,features:[Kr]});let n=e;return n})(),k0=new Xe("");var OG={provide:k0,useExisting:Za(()=>$f),multi:!0};function MG(){let n=Ep()?Ep().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var NG=new Xe(""),$f=(()=>{let e=class e extends kR{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!MG())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(We(yp),We(gp),We(NG,8))},e.\u0275dir=Qn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&An("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[nl([OG]),Kr]});let n=e;return n})();function Qi(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function xR(n){return n!=null&&typeof n.length=="number"}var OR=new Xe(""),MR=new Xe(""),PG=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,zn=class{static min(e){return FG(e)}static max(e){return LG(e)}static required(e){return BG(e)}static requiredTrue(e){return VG(e)}static email(e){return qG(e)}static minLength(e){return UG(e)}static maxLength(e){return zG(e)}static pattern(e){return jG(e)}static nullValidator(e){return NR(e)}static compose(e){return qR(e)}static composeAsync(e){return zR(e)}};function FG(n){return e=>{if(Qi(e.value)||Qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function LG(n){return e=>{if(Qi(e.value)||Qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function BG(n){return Qi(n.value)?{required:!0}:null}function VG(n){return n.value===!0?null:{required:!0}}function qG(n){return Qi(n.value)||PG.test(n.value)?null:{email:!0}}function UG(n){return e=>Qi(e.value)||!xR(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function zG(n){return e=>xR(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function jG(n){if(!n)return NR;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Qi(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function NR(n){return null}function PR(n){return n!=null}function FR(n){return K_(n)?Wn(n):n}function LR(n){let e={};return n.forEach(t=>{e=t!=null?gt(gt({},e),t):e}),Object.keys(e).length===0?null:e}function BR(n,e){return e.map(t=>t(n))}function GG(n){return!n.validate}function VR(n){return n.map(e=>GG(e)?e:t=>e.validate(t))}function qR(n){if(!n)return null;let e=n.filter(PR);return e.length==0?null:function(t){return LR(BR(t,e))}}function UR(n){return n!=null?qR(VR(n)):null}function zR(n){if(!n)return null;let e=n.filter(PR);return e.length==0?null:function(t){let r=BR(t,e).map(FR);return F_(r).pipe(Dt(LR))}}function jR(n){return n!=null?zR(VR(n)):null}function _R(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function GR(n){return n._rawValidators}function HR(n){return n._rawAsyncValidators}function E0(n){return n?Array.isArray(n)?n:[n]:[]}function qf(n,e){return Array.isArray(n)?n.includes(e):n===e}function SR(n,e){let t=E0(e);return E0(n).forEach(i=>{qf(t,i)||t.push(i)}),t}function CR(n,e){return E0(e).filter(t=>!qf(n,t))}var Uf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=UR(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=jR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ga=class extends Uf{get formDirective(){return null}get path(){return null}},zc=class extends Uf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},zf=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},HG={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},E7=Gt(gt({},HG),{"[class.ng-submitted]":"isSubmitted"}),WR=(()=>{let e=class e extends zf{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(We(zc,2))},e.\u0275dir=Qn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&vp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Kr]});let n=e;return n})(),$R=(()=>{let e=class e extends zf{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(We(Ga,10))},e.\u0275dir=Qn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&vp("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Kr]});let n=e;return n})();var Bc="VALID",Bf="INVALID",za="PENDING",Vc="DISABLED",Yi=class{},jf=class extends Yi{constructor(e,t){super(),this.value=e,this.source=t}},qc=class extends Yi{constructor(e,t){super(),this.pristine=e,this.source=t}},Uc=class extends Yi{constructor(e,t){super(),this.touched=e,this.source=t}},ja=class extends Yi{constructor(e,t){super(),this.status=e,this.source=t}},T0=class extends Yi{constructor(e){super(),this.source=e}},A0=class extends Yi{constructor(e){super(),this.source=e}};function R0(n){return(Kf(n)?n.validators:n)||null}function WG(n){return Array.isArray(n)?UR(n):n||null}function x0(n,e){return(Kf(e)?e.asyncValidators:n)||null}function $G(n){return Array.isArray(n)?jR(n):n||null}function Kf(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function KR(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new su(1e3,"");if(!r[t])throw new su(1001,"")}function QR(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new su(1002,"")})}var Ha=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._events=new eu,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Bc}get invalid(){return this.status===Bf}get pending(){return this.status==za}get disabled(){return this.status===Vc}get enabled(){return this.status!==Vc}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(SR(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(SR(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(CR(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(CR(e,this._rawAsyncValidators))}hasValidator(e){return qf(this._rawValidators,e)}hasAsyncValidator(e){return qf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Gt(gt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Uc(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Uc(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Gt(gt({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new qc(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new qc(!0,r))}markAsPending(e={}){this.status=za;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new ja(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Gt(gt({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Vc,this.errors=null,this._forEachChild(i=>{i.disable(Gt(gt({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new jf(this.value,r)),this._events.next(new ja(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Gt(gt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Bc,this._forEachChild(r=>{r.enable(Gt(gt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Gt(gt({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Bc||this.status===za)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new jf(this.value,t)),this._events.next(new ja(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Gt(gt({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Vc:Bc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=za,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=FR(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new ja(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new el,this.statusChanges=new el}_calculateStatus(){return this._allControlsDisabled()?Vc:this.errors?Bf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(za)?za:this._anyControlsHaveStatus(Bf)?Bf:Bc}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new qc(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Uc(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Kf(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=WG(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=$G(this._rawAsyncValidators)}},Gf=class extends Ha{constructor(e,t,r){super(R0(t),x0(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){QR(this,!0,e),Object.keys(e).forEach(r=>{KR(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var I0=class extends Gf{};var YR=new Xe("CallSetDisabledState",{providedIn:"root",factory:()=>O0}),O0="always";function KG(n,e){return[...e.path,n]}function ER(n,e,t=O0){M0(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),YG(n,e),XG(n,e),JG(n,e),QG(n,e)}function TR(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Wf(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Hf(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function QG(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function M0(n,e){let t=GR(n);e.validator!==null?n.setValidators(_R(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=HR(n);e.asyncValidator!==null?n.setAsyncValidators(_R(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Hf(e._rawValidators,i),Hf(e._rawAsyncValidators,i)}function Wf(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=GR(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=HR(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Hf(e._rawValidators,r),Hf(e._rawAsyncValidators,r),t}function YG(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&JR(n,e)})}function JG(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&JR(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function JR(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function XG(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function ZG(n,e){n==null,M0(n,e)}function eH(n,e){return Wf(n,e)}function tH(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function nH(n){return Object.getPrototypeOf(n.constructor)===RR}function rH(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function iH(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===$f?t=s:nH(s)?r=s:i=s}),i||r||t||null}function sH(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function AR(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function IR(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Vf=class extends Ha{constructor(e=null,t,r){super(R0(t),x0(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Kf(t)&&(t.nonNullable||t.initialValueIsDefault)&&(IR(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){AR(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){AR(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){IR(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var oH=n=>n instanceof Vf;var XR=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Qn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})(),aH={provide:k0,useExisting:Za(()=>N0),multi:!0},N0=(()=>{let e=class e extends RR{writeValue(r){let i=r??"";this.setProperty("value",i)}registerOnChange(r){this.onChange=i=>{r(i==""?null:parseFloat(i))}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=mp(e)))(s||e)}})(),e.\u0275dir=Qn({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,s){i&1&&An("input",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},features:[nl([aH]),Kr]});let n=e;return n})();var ZR=new Xe("");var lH={provide:Ga,useExisting:Za(()=>P0)},P0=(()=>{let e=class e extends Ga{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new el,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Wf(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return ER(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){TR(r.control||null,r,!1),sH(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,rH(this.form,this.directives),this.ngSubmit.emit(r),this.form._events.next(new T0(this.control)),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1,this.form._events.next(new A0(this.form))}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(TR(i||null,r),oH(s)&&(ER(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);ZG(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&eH(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){M0(this.form,this),this._oldForm&&Wf(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(We(OR,10),We(MR,10),We(YR,8))},e.\u0275dir=Qn({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&An("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[nl([lH]),Kr,pp]});let n=e;return n})();var cH={provide:zc,useExisting:Za(()=>F0)},F0=(()=>{let e=class e extends zc{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new el,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=iH(this,o)}ngOnChanges(r){this._added||this._setUpControl(),tH(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return KG(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(We(Ga,13),We(OR,10),We(MR,10),We(k0,10),We(ZR,8))},e.\u0275dir=Qn({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[nl([cH]),Kr,pp]});let n=e;return n})();var uH=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Wt({type:e}),e.\u0275inj=Ht({});let n=e;return n})(),D0=class extends Ha{constructor(e,t,r){super(R0(t),x0(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){QR(this,!1,e),e.forEach((r,i)=>{KR(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function DR(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var ex=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return DR(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Gf(s,o)}record(r,i=null){let s=this._reduceControls(r);return new I0(s,i)}control(r,i,s){let o={};return this.useNonNullable?(DR(i)?o=i:(o.validators=i,o.asyncValidators=s),new Vf(r,Gt(gt({},o),{nonNullable:!0}))):new Vf(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new D0(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof Vf)return r;if(r instanceof Ha)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$n({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var tx=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:ZR,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:YR,useValue:r.callSetDisabledState??O0}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Wt({type:e}),e.\u0275inj=Ht({imports:[uH]});let n=e;return n})();var Wa=Zc(Rp());function hH(n,e){n&1&&(fe(0,"div",14)(1,"span",15),xe(2,"Loading..."),ge()())}function fH(n,e){n&1&&(fe(0,"span",16),xe(1,"Todos los campos son obligatorios"),ge())}var L0=(()=>{let e=class e{constructor(r,i,s,o){this.fb=r,this.empleadoService=i,this.router=s,this.aRoute=o,this.submitted=!1,this.loading=!1,this.title="Agregar Empleado",this.action="Registrar",this.createEmpleado=this.fb.group({nombre:["",[zn.required,zn.maxLength(20)]],apellido:["",[zn.required,zn.maxLength(20)]],documento:["",[zn.required,zn.pattern(/^\d{8}$|^\d{10}$/)]],salario:["",[zn.required,zn.min(250001)]]}),this.id=this.aRoute.snapshot.paramMap.get("id")}ngOnInit(){this.validarAccion()}validarAccion(){this.id!=null&&(this.title="Editar datos de Empleado",this.action="Modificar",this.loading=!0,this.empleadoService.getEmpleado(this.id).subscribe(r=>{this.loading=!1,this.createEmpleado.setValue({nombre:r.payload.data().nombre,apellido:r.payload.data().apellido,documento:r.payload.data().documento,salario:r.payload.data().salario})}))}ejecucion(){if(this.submitted=!0,this.createEmpleado.invalid){Wa.default.fire({title:"Informacion Invalida",text:"Verifique que la informacion sea correta y est\xE9 completa!",icon:"warning"});return}let r={nombre:this.createEmpleado.value.nombre,apellido:this.createEmpleado.value.apellido,documento:this.createEmpleado.value.documento,salario:this.createEmpleado.value.salario,fechaCreacion:new Date,fechaActualizacion:new Date};this.id===null?this.agregarEmpleado(r):this.editarEmpleado(r,this.id)}agregarEmpleado(r){this.loading=!0,this.empleadoService.agregarEmpleado(r).then(()=>{Wa.default.fire({title:"Empleado Registrado",text:"El empleado ha sido registrado con exito!",icon:"success"}),this.router.navigate(["/list-empleados"])}).catch(i=>{Wa.default.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error al registrar el empleado (x_x)",footer:'<a href="#">\xBFQue acaba de suceder?</a>'}),this.loading=!1,console.log(i)})}editarEmpleado(r,i){this.loading=!0,this.empleadoService.updateEmpleado(i,r).then(()=>{Wa.default.fire({title:"Datos Actualizados",text:"los datos han sido actualizados con \xE9xito!",icon:"success"}),this.router.navigate(["/list-empleados"])}).catch(s=>{Wa.default.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error al actualizar los datos del empleado (x_x)",footer:'<a href="#">\xBFQue acaba de suceder?</a>'}),this.loading=!1,console.log(s)})}};e.\u0275fac=function(i){return new(i||e)(We(ex),We(Ff),We(nS),We(eS))},e.\u0275cmp=Kn({type:e,selectors:[["app-crear-empleados"]],decls:21,vars:5,consts:[[1,"crearEmpleado"],[1,"contenedorFormulario"],["class","spinner-border text-success","role","status",4,"ngIf"],["class","spanError",4,"ngIf"],[1,"mt-4",3,"ngSubmit","formGroup"],[1,"campos"],["type","text","formControlName","nombre","placeholder","Nombre"],["type","text","formControlName","apellido","placeholder","Apellido"],[1,"campo"],["type","number","formControlName","documento","placeholder","Documento"],["type","number","formControlName","salario","placeholder","Salario"],[1,"botones"],["type","button","routerLink","/lista-empleados",1,"btn","btn-secondary","btn-lg"],["type","submit",1,"btn","btn-dark","btn-lg"],["role","status",1,"spinner-border","text-success"],[1,"visually-hidden"],[1,"spanError"]],template:function(i,s){i&1&&(fe(0,"div",0)(1,"div",1)(2,"div")(3,"div")(4,"h3"),xe(5),ge(),tl(6,hH,3,0,"div",2)(7,fH,2,0,"span",3),fe(8,"form",4),An("ngSubmit",function(){return s.ejecucion()}),fe(9,"div",5),$t(10,"input",6)(11,"input",7),ge(),fe(12,"div",8),$t(13,"input",9),ge(),fe(14,"div",8),$t(15,"input",10),ge(),fe(16,"div",11)(17,"button",12),xe(18,"Volver"),ge(),fe(19,"button",13),xe(20),ge()()()()()()()),i&2&&(Ft(5),Tr(s.title),Ft(),Qr("ngIf",s.loading),Ft(),Qr("ngIf",s.submitted&&s.createEmpleado.invalid),Ft(),Qr("formGroup",s.createEmpleado),Ft(12),Tr(s.action))},dependencies:[XR,$f,N0,WR,$R,P0,F0,ou,io],styles:[".crearEmpleado[_ngcontent-%COMP%]{background:#f5f5f5;width:40%;height:100hv;margin:2.5% auto auto;padding:1%;border-radius:15px}.contendedorFormulario[_ngcontent-%COMP%]{width:95%;margin:auto;border-radius:10px}.botones[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;justify-content:center}.botones[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:0 10px}.spanError[_ngcontent-%COMP%]{background-color:red;color:#000;padding:2px 3px}.campos[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;justify-content:space-evenly}.campos[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:49%}.campo[_ngcontent-%COMP%]{width:100%;margin:1% 0%}.campo[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:100%;margin:auto}input[_ngcontent-%COMP%]{border:1px solid #727272;border-radius:3px;margin:auto;padding:5px 8px}@media screen and (max-width:800px){.crearEmpleado[_ngcontent-%COMP%]{width:95%}.campos[_ngcontent-%COMP%]{flex-direction:column;padding:0%}.campos[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:99%;margin:1%}.campo[_ngcontent-%COMP%]{margin-top:1%;margin-bottom:2%}.campo[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{width:99.5%;margin:auto}}"]});let n=e;return n})();var nx=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Kn({type:e,selectors:[["app-home"]],decls:3,vars:0,consts:[["data-aos","fade-up","data-aos-duration","800",1,"home"]],template:function(i,s){i&1&&(fe(0,"div",0)(1,"h1"),xe(2,"Gesti\xF3n de informaci\xF3n de Empleados"),ge()())},styles:[".home[_ngcontent-%COMP%]{width:95%;margin:auto;height:650px;display:flex;align-items:center;color:#fff}.home[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{font-size:90px;width:65%;text-shadow:7px 4px 7px rgb(10,10,10)}@media screen and (max-width:800px){.home[_ngcontent-%COMP%]{width:98%}.home[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{width:100%;font-size:55px;text-shadow:7px 4px 7px rgb(10,10,10)}}"]});let n=e;return n})();var pH=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"lista-empleados",component:bR},{path:"home",component:nx},{path:"crear-empleados",component:L0},{path:"editar-empleados/:id",component:L0},{path:"**",redirectTo:"lista-empleados",pathMatch:"full"}],rx=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Wt({type:e}),e.\u0275inj=Ht({imports:[Tp.forRoot(pH),Tp]});let n=e;return n})();var ix=(()=>{let e=class e{constructor(){this.ubicacionPrincipal=0,this.semaforo=!0}ngOnInit(){}onWindowScroll(){let r=window.pageYOffset,i=document.getElementsByTagName("nav")[0];i&&(r<=this.ubicacionPrincipal?i.style.top="0px":i.style.top="-100px"),this.ubicacionPrincipal=r}toggleMenu(){let r=document.querySelector(".hamburguesa"),i=document.querySelector(".enlaces");this.semaforo?(r.style.color="#fff",this.semaforo=!1):(r.style.color="#fff",this.semaforo=!0),i.classList.toggle("menudos")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Kn({type:e,selectors:[["app-navbar"]],hostBindings:function(i,s){i&1&&An("scroll",function(){return s.onWindowScroll()},!1,G_)},decls:16,vars:0,consts:[[1,"NavBar"],[1,"titulo"],[1,"fa-solid","fa-database"],[1,"enlaces"],["routerLink","/home"],["routerLink","/crear-empleados"],["routerLink","/lista-empleados"],[1,"hamburguesa",3,"click"],[1,"fa-solid","fa-bars"]],template:function(i,s){i&1&&(fe(0,"nav",0)(1,"div",1)(2,"h3"),xe(3,"Gestion de Empleados"),ge(),fe(4,"p"),$t(5,"i",2),xe(6,"Firebase"),ge()(),fe(7,"div",3)(8,"a",4),xe(9,"Home"),ge(),fe(10,"a",5),xe(11,"Registrar"),ge(),fe(12,"a",6),xe(13,"Listado"),ge()(),fe(14,"div",7),An("click",function(){return s.toggleMenu()}),$t(15,"i",8),ge()())},dependencies:[io],styles:[".NavBar[_ngcontent-%COMP%]{padding:2px 20px;background-color:#153448;color:#f5f5f5;box-shadow:0 4px 8px #0003;border-bottom:1px solid transparent;height:85px;line-height:85px;font-size:35px;font-weight:100;display:flex;justify-content:space-evenly}.titulo[_ngcontent-%COMP%]{flex-basis:60%;display:flex;flex-direction:column;height:65px}.titulo[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:35px}.titulo[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:18px;line-height:18px}.titulo[_ngcontent-%COMP%] > p[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{margin-right:5px}.enlaces[_ngcontent-%COMP%]{flex-basis:38%;margin:auto;display:flex;justify-content:space-evenly}.enlaces[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;font-size:25px;font-weight:300;width:100px;text-align:center}.enlaces[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{background-color:#fff;color:#153448;text-decoration:underline solid #153448}.hamburguesa[_ngcontent-%COMP%]{width:80px;height:80px;text-align:center;display:none;z-index:100;cursor:pointer;color:#f5f5f5}.hamburguesa[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{font-size:25px;line-height:80px}@media screen and (max-width:800px){.NavBar[_ngcontent-%COMP%]{width:100%}.titulo[_ngcontent-%COMP%]{padding-top:1%;flex-basis:90%}.titulo[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{font-size:22px}.titulo[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{font-size:13px;line-height:13px}.titulo[_ngcontent-%COMP%] > p[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{margin-right:4px}.hamburguesa[_ngcontent-%COMP%]{display:block}.hamburguesa[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{font-size:25px;line-height:75px}.enlaces[_ngcontent-%COMP%]{display:none;position:fixed;background:#153448;top:0;right:0;width:100%;height:100vh;align-items:center;flex-direction:column;justify-content:space-evenly;clip-path:polygon(100% 0%,100% 48%,100% 100%,100% 100%,100% 48%,100% 0%)}.menudos[_ngcontent-%COMP%]{display:flex;clip-path:polygon(41% 0%,100% 0%,100% 100%,41% 100%,23% 51%)}}"]});let n=e;return n})();var Qf=(()=>{let e=class e{constructor(){this.title="empleados"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Kn({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,s){i&1&&$t(0,"app-navbar")(1,"router-outlet")},dependencies:[tS,ix]});let n=e;return n})();var sx={firebase:{apiKey:"AIzaSyBf-oPQLhmtX2TcE32C8O2-b37YuF2bxrQ",authDomain:"empleados-1dc32.firebaseapp.com",projectId:"empleados-1dc32",storageBucket:"empleados-1dc32.appspot.com",messagingSenderId:"676489750423",appId:"1:676489750423:web:6a60fe6cf070adb81fc6d2"},production:!1};var ox=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Wt({type:e,bootstrap:[Qf]}),e.\u0275inj=Ht({providers:[X_()],imports:[tx,J_,rx,ES.initializeApp(sx.firebase),vR]});let n=e;return n})();var gH=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Wt({type:e,bootstrap:[Qf]}),e.\u0275inj=Ht({imports:[ox,Z_]});let n=e;return n})();export{gH as a};
